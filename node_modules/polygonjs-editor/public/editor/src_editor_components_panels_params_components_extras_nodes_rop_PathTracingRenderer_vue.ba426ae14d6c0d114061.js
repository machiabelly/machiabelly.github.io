(self["webpackChunk"] = self["webpackChunk"] || []).push([["src_editor_components_panels_params_components_extras_nodes_rop_PathTracingRenderer_vue"],{

/***/ 46965:
/***/ (function(module, __unused_webpack_exports, __webpack_require__) {

const { createElementVNode: _createElementVNode, openBlock: _openBlock, createElementBlock: _createElementBlock } = __webpack_require__(61043)

module.exports = function render(_ctx, _cache) {
  return (_openBlock(), _createElementBlock("svg", {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 24 24",
    "stroke-width": "1.5",
    stroke: "currentColor",
    "aria-hidden": "true"
  }, [
    _createElementVNode("path", {
      "stroke-linecap": "round",
      "stroke-linejoin": "round",
      d: "M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"
    })
  ]))
}

/***/ }),

/***/ 85231:
/***/ (function(module, __unused_webpack_exports, __webpack_require__) {

const { createElementVNode: _createElementVNode, openBlock: _openBlock, createElementBlock: _createElementBlock } = __webpack_require__(61043)

module.exports = function render(_ctx, _cache) {
  return (_openBlock(), _createElementBlock("svg", {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 24 24",
    "stroke-width": "1.5",
    stroke: "currentColor",
    "aria-hidden": "true"
  }, [
    _createElementVNode("path", {
      "stroke-linecap": "round",
      "stroke-linejoin": "round",
      d: "M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"
    })
  ]))
}

/***/ }),

/***/ 29403:
/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {

// ESM COMPAT FLAG
__webpack_require__.r(__webpack_exports__);

// EXPORTS
__webpack_require__.d(__webpack_exports__, {
  "default": function() { return /* binding */ PathTracingRenderer; }
});

// EXTERNAL MODULE: ../node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.js
var runtime_core_esm_bundler = __webpack_require__(88917);
// EXTERNAL MODULE: ../node_modules/@vue/runtime-dom/dist/runtime-dom.esm-bundler.js + 1 modules
var runtime_dom_esm_bundler = __webpack_require__(90996);
// EXTERNAL MODULE: ../node_modules/@vue/runtime-core/node_modules/@vue/shared/dist/shared.esm-bundler.js
var shared_esm_bundler = __webpack_require__(13053);
;// CONCATENATED MODULE: ../node_modules/esbuild-loader/dist/index.cjs??clonedRuleSet-2.use[0]!../node_modules/vue-loader/dist/templateLoader.js??ruleSet[1].rules[2]!../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[14].use[0]!../src/editor/components/panels/params/components/extras/nodes/rop/PathTracingRenderer.vue?vue&type=template&id=60d5d56b&ts=true

const _hoisted_1 = {
  id: "pathtracing-extra",
  class: "w-full"
};
const _hoisted_2 = /* @__PURE__ */ (0,runtime_core_esm_bundler/* createElementVNode */._)(
  "div",
  { class: "m-2 h-1 bg-bg-light" },
  null,
  -1
  /* HOISTED */
);
const _hoisted_3 = { class: "flex space-x-2 items-center mb-2" };
const _hoisted_4 = /* @__PURE__ */ (0,runtime_core_esm_bundler/* createElementVNode */._)(
  "label",
  {
    for: "spare-param-numeric-default-value",
    class: "block text-xs font-medium text-text"
  },
  "frame",
  -1
  /* HOISTED */
);
const _hoisted_5 = { class: "" };
const _hoisted_6 = ["min", "max"];
const _hoisted_7 = { class: "flex-1 flex slider_container px-2" };
const _hoisted_8 = ["min", "max"];
const _hoisted_9 = { class: "grow-0 whitespace-nowrap select-none flex items-center justify-center" };
const _hoisted_10 = { class: "flex space-x-2" };
const _hoisted_11 = { class: "mb-8 mt-2" };
const _hoisted_12 = ["src"];
const _hoisted_13 = ["href"];
const _hoisted_14 = { key: 0 };
function render(_ctx, _cache, $props, $setup, $data, $options) {
  const _component_ChevronLeftIcon = (0,runtime_core_esm_bundler/* resolveComponent */.up)("ChevronLeftIcon");
  const _component_ChevronRightIcon = (0,runtime_core_esm_bundler/* resolveComponent */.up)("ChevronRightIcon");
  const _component_ArrowPathIcon = (0,runtime_core_esm_bundler/* resolveComponent */.up)("ArrowPathIcon");
  const _component_ArrowDownTrayIcon = (0,runtime_core_esm_bundler/* resolveComponent */.up)("ArrowDownTrayIcon");
  const _component_EmptyState = (0,runtime_core_esm_bundler/* resolveComponent */.up)("EmptyState");
  return (0,runtime_core_esm_bundler/* openBlock */.wg)(), (0,runtime_core_esm_bundler/* createElementBlock */.iD)("div", _hoisted_1, [
    _hoisted_2,
    (0,runtime_core_esm_bundler/* createElementVNode */._)("div", _hoisted_3, [
      _hoisted_4,
      (0,runtime_core_esm_bundler/* createElementVNode */._)("div", _hoisted_5, [
        (0,runtime_core_esm_bundler/* withDirectives */.wy)((0,runtime_core_esm_bundler/* createElementVNode */._)("input", {
          type: "number",
          name: "spare-param-numeric-default-value",
          id: "pathtracing-extra-frame-input-field",
          class: "shadow appearance-none border border-black rounded w-full py-2 px-3 bg-black focus:outline-none focus:ring-0 focus:border-blue-500 text-gray-100 leading-6 transition-colors duration-200 ease-in-out border-transparent number required text-sm h-8",
          "onUpdate:modelValue": _cache[0] || (_cache[0] = ($event) => _ctx.frame = $event),
          min: _ctx.frameRange[0],
          max: _ctx.frameRange[1]
        }, null, 8, _hoisted_6), [
          [runtime_dom_esm_bundler.vModelText, _ctx.frame]
        ])
      ]),
      (0,runtime_core_esm_bundler/* createElementVNode */._)("div", _hoisted_7, [
        (0,runtime_core_esm_bundler/* withDirectives */.wy)((0,runtime_core_esm_bundler/* createElementVNode */._)("input", {
          id: "pathtracing-extra-frame-input-slider",
          class: "w-full",
          type: "range",
          min: _ctx.frameRange[0],
          max: _ctx.frameRange[1],
          step: 1,
          "onUpdate:modelValue": _cache[1] || (_cache[1] = ($event) => _ctx.frame = $event)
        }, null, 8, _hoisted_8), [
          [runtime_dom_esm_bundler.vModelText, _ctx.frame]
        ])
      ]),
      (0,runtime_core_esm_bundler/* createElementVNode */._)("div", _hoisted_9, [
        (0,runtime_core_esm_bundler/* createVNode */.Wm)(_component_ChevronLeftIcon, {
          class: (0,shared_esm_bundler/* normalizeClass */.C_)([
            "inline-block h-4 w-6 px-1",
            _ctx.decrementFrameAllowed ? "cursor-pointer hover:opacity-80" : "opacity-30"
          ]),
          onClick: _ctx.decrementFrame
        }, null, 8, ["class", "onClick"]),
        (0,runtime_core_esm_bundler/* createVNode */.Wm)(_component_ChevronRightIcon, {
          class: (0,shared_esm_bundler/* normalizeClass */.C_)([
            "inline-block h-4 w-6 px-1",
            _ctx.incrementFrameAllowed ? "cursor-pointer hover:opacity-80" : "opacity-30"
          ]),
          onClick: _ctx.incrementFrame
        }, null, 8, ["class", "onClick"])
      ])
    ]),
    (0,runtime_core_esm_bundler/* createElementVNode */._)("div", _hoisted_10, [
      (0,runtime_core_esm_bundler/* createElementVNode */._)("button", {
        class: "max-w-full md:w-full px-1 py-1 md:px-3 md:py-2 text-text-light text-xs lg:text-base bg-blue-700 hover:bg-blue-800 hover:text-white cursor-pointer rounded truncate",
        onClick: _cache[2] || (_cache[2] = (0,runtime_dom_esm_bundler.withModifiers)(
          //@ts-ignore
          (...args) => _ctx.reload && _ctx.reload(...args),
          ["self", "prevent"]
        ))
      }, [
        (0,runtime_core_esm_bundler/* createVNode */.Wm)(_component_ArrowPathIcon, {
          class: (0,shared_esm_bundler/* normalizeClass */.C_)(["inline-block h-4 w-6 px-1"]),
          onClick: _ctx.incrementFrame
        }, null, 8, ["onClick"]),
        (0,runtime_core_esm_bundler/* createTextVNode */.Uk)(" Reload ")
      ]),
      (0,runtime_core_esm_bundler/* createElementVNode */._)("button", {
        class: "max-w-full md:w-full px-1 py-1 md:px-3 md:py-2 text-text-light text-xs lg:text-base bg-green-700 hover:bg-green-800 hover:text-white cursor-pointer rounded truncate",
        onClick: _cache[3] || (_cache[3] = (0,runtime_dom_esm_bundler.withModifiers)(
          //@ts-ignore
          (...args) => _ctx.downloadImagesZip && _ctx.downloadImagesZip(...args),
          ["self", "prevent"]
        ))
      }, [
        (0,runtime_core_esm_bundler/* createVNode */.Wm)(_component_ArrowDownTrayIcon, {
          class: (0,shared_esm_bundler/* normalizeClass */.C_)(["inline-block h-4 w-6 px-1"]),
          onClick: _ctx.incrementFrame
        }, null, 8, ["onClick"]),
        (0,runtime_core_esm_bundler/* createTextVNode */.Uk)(" Download Images Zip ")
      ])
    ]),
    (0,runtime_core_esm_bundler/* withDirectives */.wy)((0,runtime_core_esm_bundler/* createElementVNode */._)(
      "div",
      _hoisted_11,
      [
        (0,runtime_core_esm_bundler/* createCommentVNode */.kq)(' <canvas ref="canvasElement" class="mx-auto block" :style="canvasStyleObject" /> '),
        _ctx.imageUrlWithTimestamp ? ((0,runtime_core_esm_bundler/* openBlock */.wg)(), (0,runtime_core_esm_bundler/* createElementBlock */.iD)("img", {
          key: 0,
          class: "mx-auto block",
          style: (0,shared_esm_bundler/* normalizeStyle */.j5)(_ctx.canvasStyleObject),
          src: _ctx.imageUrlWithTimestamp
        }, null, 12, _hoisted_12)) : (0,runtime_core_esm_bundler/* createCommentVNode */.kq)("v-if", true),
        _ctx.imageUrl && _ctx.displayImageUrlLink ? ((0,runtime_core_esm_bundler/* openBlock */.wg)(), (0,runtime_core_esm_bundler/* createElementBlock */.iD)("a", {
          key: 1,
          class: "block text-xs text-faded text-center my-2 cursor-pointer hover:text-white",
          href: _ctx.imageUrl
        }, (0,shared_esm_bundler/* toDisplayString */.zw)(_ctx.imageUrl), 9, _hoisted_13)) : (0,runtime_core_esm_bundler/* createCommentVNode */.kq)("v-if", true)
      ],
      512
      /* NEED_PATCH */
    ), [
      [runtime_dom_esm_bundler.vShow, _ctx.imageLoaded]
    ]),
    !_ctx.imageLoaded ? ((0,runtime_core_esm_bundler/* openBlock */.wg)(), (0,runtime_core_esm_bundler/* createElementBlock */.iD)("div", _hoisted_14, [
      (0,runtime_core_esm_bundler/* createVNode */.Wm)(_component_EmptyState, {
        displayEmoji: true,
        title: "No render found",
        subtitle: _ctx.emptyStateMessage
      }, null, 8, ["subtitle"])
    ])) : (0,runtime_core_esm_bundler/* createCommentVNode */.kq)("v-if", true)
  ]);
}

;// CONCATENATED MODULE: ../src/editor/components/panels/params/components/extras/nodes/rop/PathTracingRenderer.vue?vue&type=template&id=60d5d56b&ts=true

// EXTERNAL MODULE: ../node_modules/@vue/reactivity/dist/reactivity.esm-bundler.js + 1 modules
var reactivity_esm_bundler = __webpack_require__(61334);
// EXTERNAL MODULE: ../src/editor/store/controllers/StoreController.ts + 44 modules
var StoreController = __webpack_require__(72555);
// EXTERNAL MODULE: ../src/editor/components/widgets/EmptyState.vue + 4 modules
var EmptyState = __webpack_require__(21842);
// EXTERNAL MODULE: ../node_modules/@heroicons/vue/24/solid/ChevronRightIcon.js
var ChevronRightIcon = __webpack_require__(23421);
// EXTERNAL MODULE: ../node_modules/@heroicons/vue/24/solid/ChevronLeftIcon.js
var ChevronLeftIcon = __webpack_require__(66959);
// EXTERNAL MODULE: ../node_modules/@heroicons/vue/24/outline/ArrowPathIcon.js
var ArrowPathIcon = __webpack_require__(85231);
// EXTERNAL MODULE: ../node_modules/@heroicons/vue/24/outline/ArrowDownTrayIcon.js
var ArrowDownTrayIcon = __webpack_require__(46965);
// EXTERNAL MODULE: ../src/editor/Editor.ts + 11 modules
var Editor = __webpack_require__(90192);
// EXTERNAL MODULE: ../src/editor/types.ts
var types = __webpack_require__(10837);
// EXTERNAL MODULE: ../src/editor/core/render/PBRUtils.ts
var PBRUtils = __webpack_require__(74121);
// EXTERNAL MODULE: ../src/editor/core/capture/CanvasToWebmCommon.ts + 1 modules
var CanvasToWebmCommon = __webpack_require__(62461);
// EXTERNAL MODULE: ../src/editor/core/FileUtils.ts
var FileUtils = __webpack_require__(78079);
;// CONCATENATED MODULE: ../node_modules/esbuild-loader/dist/index.cjs??clonedRuleSet-2.use[0]!../node_modules/vue-loader/dist/index.js??ruleSet[1].rules[14].use[0]!../src/editor/components/panels/params/components/extras/nodes/rop/PathTracingRenderer.vue?vue&type=script&lang=ts
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};










/* harmony default export */ var PathTracingRenderervue_type_script_lang_ts = ((0,runtime_core_esm_bundler/* defineComponent */.aZ)({
  name: "extras-nodes-rop-PathTracingRenderer",
  components: { EmptyState: EmptyState/* default */.Z, ChevronRightIcon: ChevronRightIcon, ChevronLeftIcon: ChevronLeftIcon, ArrowPathIcon: ArrowPathIcon, ArrowDownTrayIcon: ArrowDownTrayIcon },
  props: {
    nodeId: {
      type: Number,
      default: null
    }
  },
  setup(props) {
    const node = StoreController/* StoreController.engine.node */.F.engine.node(props.nodeId);
    const imageUrl = (0,reactivity_esm_bundler/* ref */.iH)(null);
    const timestamp = (0,reactivity_esm_bundler/* ref */.iH)(0);
    const imageLoaded = (0,reactivity_esm_bundler/* ref */.iH)(false);
    const sceneSaved = (0,reactivity_esm_bundler/* ref */.iH)(true);
    const frame = (0,reactivity_esm_bundler/* ref */.iH)(0);
    const frameRange = (0,runtime_core_esm_bundler/* computed */.Fl)(() => {
      const paramId = node.p.f.graphNodeId();
      const jsonParam = StoreController/* StoreController.engine.json_param */.F.engine.json_param(paramId);
      return jsonParam == null ? void 0 : jsonParam.value;
    });
    const fileName = (0,runtime_core_esm_bundler/* computed */.Fl)(() => {
      return (0,PBRUtils/* pathTracingRendererFileNameSync */.jp)({ node, frame: frame.value });
    });
    const resolution = (0,runtime_core_esm_bundler/* computed */.Fl)(() => {
      const paramId = node.p.resolution.graphNodeId();
      const jsonParam = StoreController/* StoreController.engine.json_param */.F.engine.json_param(paramId);
      return jsonParam == null ? void 0 : jsonParam.value;
    });
    const emptyStateMessage = (0,runtime_core_esm_bundler/* computed */.Fl)(() => {
      return imageUrl.value ? `the image '${imageUrl.value}' is not found` : `no image found for file name ${fileName.value}`;
    });
    const decrementFrameAllowed = (0,runtime_core_esm_bundler/* computed */.Fl)(() => frame.value > frameRange.value[0]);
    const incrementFrameAllowed = (0,runtime_core_esm_bundler/* computed */.Fl)(() => frame.value < frameRange.value[1]);
    const decrementFrame = function() {
      if (decrementFrameAllowed.value) {
        frame.value--;
      }
    };
    const incrementFrame = function() {
      if (incrementFrameAllowed.value) {
        frame.value++;
      }
    };
    const displayImageUrlLink = (0,runtime_core_esm_bundler/* computed */.Fl)(() => Editor/* Editor.instance */.M.instance().type() == types/* EditorType.LOCAL */.gg.LOCAL);
    const imageUrlWithTimestamp = (0,runtime_core_esm_bundler/* computed */.Fl)(() => {
      if (Editor/* Editor.instance */.M.instance().type() == types/* EditorType.WEB */.gg.WEB) {
        return imageUrl.value;
      } else {
        return `${imageUrl.value}?t=${timestamp.value}`;
      }
    });
    const canvasStyleObject = () => {
      return {
        width: `${resolution.value[0]}px`,
        height: `${resolution.value[1]}px`,
        maxWidth: `${resolution.value[0]}px`,
        maxHeight: `${resolution.value[1]}px`
      };
    };
    const DEBUG = false;
    const debugPath = (0,runtime_core_esm_bundler/* computed */.Fl)(() => {
      const f4 = `${frame.value}`.padStart(4, "0");
      return `/clients/me/pbr/pathTracingRenderer1.${f4}.png`;
    });
    function loadImage() {
      return __async(this, null, function* () {
        const image = yield loadImageForFrame();
        if (image) {
          imageLoaded.value = true;
        } else {
          imageLoaded.value = false;
        }
      });
    }
    function loadImageForFrame() {
      return new Promise((resolve) => __async(this, null, function* () {
        const scene = StoreController/* StoreController.scene */.F.scene;
        const sceneName = scene.name();
        sceneSaved.value = sceneName != null;
        if (!sceneName) {
          return;
        }
        const currentFrame = frame.value;
        const _isCurrentFrame = () => currentFrame == frame.value;
        const callback = Editor/* Editor.instance */.M.instance().callback(types/* EditorEvent.VIEWER_CAPTURE_ANIMATION_FRAME_LOAD */.ed.VIEWER_CAPTURE_ANIMATION_FRAME_LOAD);
        if (!callback) {
          return;
        }
        if (!fileName.value) {
          return;
        }
        const json = yield callback({
          rendererNodePath: node.path(),
          fileName: fileName.value
        });
        if (!json) {
          return;
        }
        imageUrl.value = DEBUG ? debugPath.value : json.filePath;
        timestamp.value++;
        const image = new Image();
        image.onload = () => {
          resolve(image);
        };
        image.onabort = () => {
          if (!_isCurrentFrame()) {
            return;
          }
          resolve(void 0);
        };
        image.onerror = () => {
          if (!_isCurrentFrame()) {
            return;
          }
          resolve(void 0);
        };
        const _src = imageUrlWithTimestamp.value;
        if (_src) {
          image.src = _src;
        }
      }));
    }
    function reload() {
      loadImage();
    }
    function downloadImagesZip() {
      return __async(this, null, function* () {
        const recordedFrames = [];
        for (let f = frameRange.value[0]; f <= frameRange.value[1]; f++) {
          frame.value = f;
          const image = yield loadImageForFrame();
          if (image) {
            const blob = yield FileUtils/* CoreFileUtils.imageToBlob */.w.imageToBlob(image);
            if (blob) {
              recordedFrames.push({
                sceneFrame: f,
                blob
              });
            }
          }
        }
        yield (0,CanvasToWebmCommon/* zipFrames */.Pg)(recordedFrames);
      });
    }
    (0,runtime_core_esm_bundler/* watch */.YP)(frame, loadImage);
    (0,runtime_core_esm_bundler/* onMounted */.bv)(loadImage);
    return {
      // canvasElement,
      imageLoaded,
      imageUrl,
      imageUrlWithTimestamp,
      frame,
      frameRange,
      reload,
      // createVideo,
      emptyStateMessage,
      displayImageUrlLink,
      canvasStyleObject,
      decrementFrameAllowed,
      incrementFrameAllowed,
      decrementFrame,
      incrementFrame,
      downloadImagesZip
    };
  }
}));

;// CONCATENATED MODULE: ../src/editor/components/panels/params/components/extras/nodes/rop/PathTracingRenderer.vue?vue&type=script&lang=ts
 
// EXTERNAL MODULE: ../node_modules/vue-loader/dist/exportHelper.js
var exportHelper = __webpack_require__(6959);
;// CONCATENATED MODULE: ../src/editor/components/panels/params/components/extras/nodes/rop/PathTracingRenderer.vue




;
const __exports__ = /*#__PURE__*/(0,exportHelper/* default */.Z)(PathTracingRenderervue_type_script_lang_ts, [['render',render]])

/* harmony default export */ var PathTracingRenderer = (__exports__);

/***/ })

}])
//# sourceMappingURL=src_editor_components_panels_params_components_extras_nodes_rop_PathTracingRenderer_vue.ba426ae14d6c0d114061.js.map