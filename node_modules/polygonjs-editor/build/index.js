#!/usr/bin/env node

(()=>{var e={697:e=>{e.exports="//\n// learn more about this file on https://polygonjs.com/docs/editor/config\n//\n\nimport {\n\tEditorApiOptions,\n\tConfigureEditor\n// @ts-ignore (this ts-ignore necessary for yarn build or npm run build when using vite)\n} from 'polygonjs-editor/public/editor/api';\n// import {ProgressBarTop} from '@polygonjs/polygonjs/src/engine/viewers/progressBars/Top';\n\nexport const configureEditor: ConfigureEditor = (options: EditorApiOptions) => {\n\t// we have a `console.log` here to avoid errors like 'options is declared but its value is never read' at build time\n\tconsole.log(options);\n\n\t//\n\t// Add custom javascript to the editor\n\t//\n\t// options.api.html.head.addScript({\n\t// \tid: 'my-script',\n\t// \tcontent: `alert('this is running my custom script')`,\n\t// });\n\n\t// // setup a post-export command,\n\t// // this is typically used to publish your files online\n\t// options.api.export.setPostExportCommand((args)=>{\n\t// \tconst {exportFolder, sceneName} = args; \n\t// \t// This command uses aws cli (https://docs.aws.amazon.com/cli/index.html)\n\t// \t// to copy the exported files on an s3 bucket and making them publicly available.\n\t// \t// This is used to easily export for sites builder like: Webflow, Squarespace, Wix, Bubble.\n\t// \tconst awsS3Config = {\n\t// \t\tbucket: 'my-s3-bucket',\n\t// \t\tregion: 'eu-west-2',\n\t// \t\tfolder: 'my-project/polygonjs/scenes',\n\t// \t\tversion: '01'\n\t// \t}\n\t// \treturn {\n\t// \t\t// this is the command that is run once the export is completed\n\t// \t\tcommand: `aws s3 cp '${exportFolder}' 's3://${awsS3Config.bucket}/${awsS3Config.folder}/${sceneName}/v${awsS3Config.version}' --acl public-read --recursive`,\n\t// \t\t// publicPath is needed when importscript the javascript from another site, so it knows where all other files can be fetched from\n\t// \t\tpublicPath: `https://${awsS3Config.bucket}.s3.${awsS3Config.region}.amazonaws.com/${awsS3Config.folder}/${sceneName}/v${awsS3Config.version}/` \n\t// \t}\n\t// });\n\n\n\t//\n\t// Start A Multiplayer Session\n\t//\n\t// learn more https://polygonjs.com/docs/multiplayer\n\t//\n\t// options.api.multiplayer.remote.ngrok.setAuthToken(\"YOUR-AUTHTOKEN\");\n\t// options.api.multiplayer.remote.ngrok.setCloseExistingTunnelsOnCreate(true);\n\t//\n};\n"},4813:e=>{e.exports="export function configurePolygonjs(poly) {\n\t// You can configure the engine,\n\t// which for instance could allow you to create your own nodes.\n\t// See https://github.com/polygonjs/plugins_tutorials\n}\nexport function configureScene(scene) {\n\t// see scene and node API:\n\t// https://polygonjs.com/docs/api\n}\n"},6402:e=>{e.exports="import {PolyEngine} from '@polygonjs/polygonjs/src/engine/Poly';\nimport {PolyScene} from '@polygonjs/polygonjs/src/engine/scene/PolyScene';\n\nexport function configurePolygonjs(poly: PolyEngine) {\n\t// we have a `console.log` here to avoid errors like 'poly is declared but not used' at build time\n\tconsole.log('poly', poly);\n\t//\n\t//\n\t// You can configure Polygonjs here:\n\t//\n\t//\n\t//\n\t// # 1. Import plugins\n\t//\n\t// Plugins are a way to add your own nodes to Polygonjs,\n\t// which allow you to extend its capabilities.\n\t// See https://github.com/polygonjs/plugins_tutorials\n\t//\n\t//\n\t//\n\t// # 2. Configure Mapbox:\n\t//\n\t// If you use Mapbox nodes, you need to add your Mapbox token. Follow those steps:\n\t// 1. Find your mapbox token from your account at: https://account.mapbox.com/\n\t// 2. replace the 'XXXXXX' below by your token and uncomment the line.\n\t//\n\t// poly.thirdParty.mapbox().setToken('XXXXXX');\n\t//\n\t//\n\t//\n}\n\nexport function configureScene(scene: PolyScene) {\n\t// we have a `console.log` here to avoid errors like 'scene is declared but not used' at build time\n\tconsole.log('scene', scene);\n\t//\n\t//\n\t// You can configure the scene here:\n\t// https://polygonjs.com/docs/api\n\t//\n\t// ensure frame is set to 0 at start time:\n\t// scene.setFrame(0);\n}\n"},3120:e=>{e.exports="Created with [Polygonjs](https://polygonjs.com)\n\n# Open Polygonjs Editor\n\n- 1: install dependencies, with `yarn` or `npm install`\n- 2: run: `yarn polygon` or `npm run polygon`\n- 3: open your browser on `http://localhost:8091`\n\nIf you have any trouble installing it, the docs may be able to help: [https://polygonjs.com/docs/](https://polygonjs.com/docs/)"},1362:e=>{e.exports="import {LoadSceneOptions, LoadedData} from './loadScene';\n\ntype CreateSceneAndMount_<%= sceneName %> = (options?: LoadSceneOptions) => Promise<LoadedData>;\n\nexport const createSceneAndMount_<%= sceneName %>: CreateSceneAndMount_<%= sceneName %>;\n"},208:e=>{e.exports="import {loadScene_<%= sceneName %>} from './loadScene.js';\nimport {sceneData} from './scene.js'\n\nexport const createSceneAndMount_<%= sceneName %> = async function (options={}) {\n\tif(options && options.createViewer == null){\n\t\toptions.createViewer = true;\n\t}\n\toptions.sceneData = sceneData;\n\treturn loadScene_<%= sceneName %>(options);\n};\n"},4287:e=>{e.exports="import {LoadSceneOptions, LoadedData} from './loadScene';\n\ntype CreateSceneAndMountNoChunk_<%= sceneName %> = (options?: LoadSceneOptions) => Promise<LoadedData>;\n\nexport const createSceneAndMountNoChunk_<%= sceneName %>: CreateSceneAndMountNoChunk_<%= sceneName %>;\n"},6303:e=>{e.exports="import {sceneData} from './scene.js'\nimport {loadSceneData_<%= sceneName %>} from './loadSceneData.js';\nimport {ScenePlayerImporter} from '@polygonjs/polygonjs/src/engine/io/player/Scene';\nimport {PolyNodeController} from '@polygonjs/polygonjs/src/engine/nodes/utils/poly/PolyNodeController';\nimport {configureScene, configurePolygonjs} from '../PolyConfig';\nimport {Poly} from '@polygonjs/polygonjs/src/engine/Poly';\nimport {AllExpressionsRegister} from '@polygonjs/polygonjs/src/engine/poly/registers/expressions/All';\nimport {requiredImports_<%= sceneName %>} from './requiredImports';\n\n\nconst loadSceneFromSceneData_<%= sceneName %> = async function (options) {\n\tconst {\n\t\tdomElement,\n\t\tsceneData,\n\t\tonProgress,\n\t\tautoPlay,\n\t\tcreateViewer,\n\t\tassetsRoot,\n\t\tlibsRootPrefix,\n\t\tprintWarnings,\n\t\trenderer,\n\t\tcameraMaskOverride\n\t} = options;\n\tconst runRegister = options.runRegister != null ? options.runRegister : true;\n\n\tif( runRegister ){\n\t\t// registers nodes required for this scene\n\t\tfor (const node of requiredImports_<%= sceneName %>.nodes) {\n\t\t\tPoly.registerNode(node, undefined, {printWarnings});\n\t\t}\n\t\tfor (const operation of requiredImports_<%= sceneName %>.operations) {\n\t\t\tPoly.registerOperation(operation, {printWarnings});\n\t\t}\n\t\tfor(const jsFunction of requiredImports_<%= sceneName %>.jsFunctions){\n\t\t\tPoly.registerNamedFunction(jsFunction, {printWarnings});\n\t\t}\n\t\tconst polyNodesData = <%= polyNodesData %>;\n\t\tfor (let polyNodeData of polyNodesData) {\n\t\t\tPolyNodeController.createNodeClassAndRegister(polyNodeData);\n\t\t}\n\t\tAllExpressionsRegister.run(Poly);\n\t\tconfigurePolygonjs(Poly);\n\t}\n\n\tPoly.libs.setRoot('<%= libsRoot %>');<%= displayLogoFunctionCall %>\n\n\tfunction configureSceneAndOverrideAssetsRootIfRequired(scene){\n\t\tconfigureScene(scene);\n\t\tif(assetsRoot){\n\t\t\tscene.assets.setRoot(assetsRoot);\n\t\t}\n\t\tif(libsRootPrefix){\n\t\t\tPoly.libs.setRootPrefix(libsRootPrefix);\n\t\t}\n\t}\n\n\t// load the scene and create a viewer\n\tconst sceneName = '<%= sceneName %>';\n\tconst {scene, viewer} = await ScenePlayerImporter.loadSceneData({\n\t\tdomElement,\n\t\tsceneName,\n\t\tconfigureScene: configureSceneAndOverrideAssetsRootIfRequired,\n\t\tsceneData,\n\t\tonProgress,\n\t\tautoPlay,\n\t\tcreateViewer,\n\t\trenderer,\n\t\tcameraMaskOverride,\n\t});\n\treturn {\n\t\tscene,\n\t\tviewer,\n\t};\n};\n\n\nexport const createSceneAndMountNoChunk_<%= sceneName %> = async function (options={}) {\n\tif(options && options.createViewer == null){\n\t\toptions.createViewer = true;\n\t}\n\toptions.sceneData = sceneData;\n\treturn loadSceneFromSceneData_<%= sceneName %>(options);\n};\n"},4369:e=>{e.exports="import {LoadSceneOptions, LoadedData} from './loadScene';\n\ntype FetchSceneAndMount_<%= sceneName %> = (options?: LoadSceneOptions) => Promise<LoadedData>;\n\nexport const fetchSceneAndMount_<%= sceneName %>: FetchSceneAndMount_<%= sceneName %>;\n"},8595:e=>{e.exports="import {loadScene_<%= sceneName %>} from './loadScene.js';\n\nexport const fetchSceneAndMount_<%= sceneName %> = async function (options={}) {\n\tif(options && options.createViewer == null){\n\t\toptions.createViewer = true;\n\t}\n\treturn loadScene_<%= sceneName %>(options);\n};\n"},9537:e=>{e.exports="node_modules/\nbuild/\npublic/polygonjs/backup\npublic/polygonjs/js\npublic/polygonjs/build\n<%= logFileName %>\n# When more than one person is working on a scene,\n# it may be useful to also ignore the editor.json\n# to avoid any merge conflict\n# public/polygonjs/scenes/[a-z0-9\\_]*/editor.json"},542:e=>{e.exports="import {LoadedData} from './loadScene';\n\ninterface LoadSceneAndMountOptions {\n\tdomElement?:string|undefined;\n\tpublicPath:string;\n\tonProgress: (progress:number)=>void\n}\n\ntype LoadSceneAndMount_<%= sceneName %> = (options: LoadSceneAndMountOptions) => Promise<LoadedData>;\n\nexport const loadSceneAndMount_<%= sceneName %>: LoadSceneAndMount_<%= sceneName %>;\n"},7275:e=>{e.exports="import {<%= functionName %>_<%= sceneName %>} from './<%= functionName %>.js';\n\nexport async function loadSceneAndMount_<%= sceneName %>(options) {\n\tconst {publicPath, onProgress} = options;\n\tconst domElement = options.domElement || 'polygonjs-app-<%= sceneName %>';\n\tconst loadedData = await <%= functionName %>_<%= sceneName %>({\n\t\tdomElement,\n\t\tautoPlay: true,\n\t\tonProgress,\n\t\tsceneDataRoot: publicPath + '/polygonjs/scenes',\n\t\tassetsRoot: publicPath,\n\t\tlibsRootPrefix: publicPath,\n\t});\n\treturn loadedData;\n}\n"},1230:e=>{e.exports="<!DOCTYPE html>\n<html lang=\"en\">\n\t<head>\n\t\t<meta charset=\"utf-8\" />\n\t\t<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\" />\n\t\t<%= EditorApi.html.head.tags() %>\n\t</head>\n\t<body>\n\t\t<div id=\"<%= EditorApi.html.body.polygonjsId('___SCENE_NAME___') %>\" class='polygonjs-app'></div>\n\t\t<%= EditorApi.html.body.tags('loader') %>\n\t</body>\n\t<script>\n\t\tdocument.addEventListener('POLYSceneReady', (event)=>{\n\t\t\twindow.scene = event.detail.scene;\n\t\t})\n\t\t// you can uncomment the following to have access to the viewer globally\n\t\t// document.addEventListener('POLYViewerMounted', (event)=>{\n\t\t// \twindow.viewer = event.detail.viewer;\n\t\t// })\n\t<\/script>\n</html>\n"},2663:e=>{e.exports="import {SceneJsonExporterData} from '@polygonjs/polygonjs/src/engine/io/json/export/Scene';\nimport {BaseViewerType} from '@polygonjs/polygonjs/src/engine/viewers/_Base';\nimport {PolySceneWithNodeMap_<%= sceneName %>} from './PolySceneWithNodeMap';\nimport {WebGLRenderer} from 'three';\n\nexport type OnProgressCallback = (ratio: number, args: any) => void;\nexport type ConfigureSceneData = (sceneData: SceneJsonExporterData) => void;\n\nexport interface LoadSceneOptions {\n\tsceneData?: SceneJsonExporterData;\n\tonProgress?: OnProgressCallback;\n\tdomElement?: HTMLElement|string;\n\tloadModules?: boolean;\n\trunRegister?: boolean;\n\tconfigureSceneData?: ConfigureSceneData;\n\t//\n\tbaseUrl?: string;\n\tsceneDataRoot?: string;\n\tassetsRoot?: string;\n\tlibsRootPrefix?: string;\n\t//\n\tautoPlay?: boolean;\n\tcreateViewer?: boolean;\n\tprintWarnings?: boolean;\n\trenderer?: WebGLRenderer;\n\tcameraMaskOverride?: string;\n}\nexport interface LoadedData {\n\tscene: PolySceneWithNodeMap_<%= sceneName %>;\n\tviewer: BaseViewerType | undefined;\n}\nexport type LoadScene_<%= sceneName %> = (options?: LoadSceneOptions) => Promise<LoadedData>;\n\nexport const loadScene_<%= sceneName %>: LoadScene_<%= sceneName %>;\n"},9869:e=>{e.exports="import {loadSceneData_<%= sceneName %>} from './loadSceneData.js';\n\nexport const loadScene_<%= sceneName %> = async function (options={}) {\n\tconst {\n\t\tonProgress,\n\t\tdomElement,\n\t\tconfigureSceneData,\n\t\tautoPlay,\n\t\tcreateViewer,\n\t\tprintWarnings,\n\t\trenderer,\n\t\tcameraMaskOverride\n\t} = options;\n\tlet sceneData = options.sceneData;\n\n\tconst baseUrl = options.baseUrl != null ? options.baseUrl : \"./\";\n\tconst sceneDataRoot = options.sceneDataRoot != null ? options.sceneDataRoot : baseUrl + '/polygonjs/scenes';\n\tconst assetsRoot = options.assetsRoot != null ? options.assetsRoot : baseUrl;\n\tconst libsRootPrefix = options.libsRootPrefix != null ? options.libsRootPrefix : baseUrl;\n\n\tconst runRegister = options.runRegister != null ? options.runRegister : true;\n\tconst loadModules = options.loadModules != null ? options.loadModules : true;\n\n\tconst moduleNames = loadModules ? <%= moduleNamesStr %> : [];\n\t<%= promisesLine %>\n\tconst results = await Promise.all(promises);\n\tconst {Poly, loadSceneFromSceneData_<%= sceneName %>} = results[0];\n\tif(sceneData == null){\n\t\tsceneData = results[1];\n\t}\n\tif(configureSceneData){\n\t\tconfigureSceneData(sceneData);\n\t}\n\n\tconst loadedModules = [];\n\tfor (let i = 2; i < results.length; i++) {\n\t\tloadedModules.push(results[i]);\n\t}\n\t// register modules\n\tlet i = 0;\n\tfor (let moduleName of moduleNames) {\n\t\tconst moduleNameContainer = moduleName + 'Module';\n\t\tPoly.registerModule(loadedModules[i][moduleNameContainer], printWarnings);\n\t\ti++;\n\t}\n\n\tconst loadedData = await loadSceneFromSceneData_<%= sceneName %>({\n\t\tonProgress,\n\t\tsceneData,\n\t\tdomElement,\n\t\trunRegister,\n\t\tautoPlay,\n\t\tcreateViewer,\n\t\tassetsRoot,\n\t\tlibsRootPrefix,\n\t\tprintWarnings,\n\t\trenderer,\n\t\tcameraMaskOverride\n\t});\n\treturn loadedData;\n};\n"},5339:e=>{e.exports="import {SceneJsonExporterData} from '@polygonjs/polygonjs/src/engine/io/json/export/Scene';\n\nexport type OnProgressCallback = (ratio: number, args: any) => void;\n\ninterface LoadManifestOptions {\n\tonProgress?: OnProgressCallback;\n\tsceneDataRoot?: string;\n}\n\ntype LoadSceneData_<%= sceneName %> = (options?: LoadManifestOptions) => Promise<SceneJsonExporterData>;\n\nexport const loadSceneData_<%= sceneName %>: LoadSceneData_<%= sceneName %>;\n"},6037:e=>{e.exports="import {SceneDataManifestImporter} from '@polygonjs/polygonjs/src/engine/io/manifest/import/SceneData';\nconst manifest = <%= manifestJSON %>;\n\nexport const loadSceneData_<%= sceneName %> = async (options={}) => {\n\tconst sceneDataRoot = options.sceneDataRoot || './polygonjs/scenes'\n\treturn await SceneDataManifestImporter.importSceneData({\n\t\tsceneName: '<%= sceneName %>',\n\t\turlPrefix: sceneDataRoot + '/<%= sceneName %>',\n\t\tmanifest: manifest,\n\t\tonProgress: options.onProgress,\n\t});\n};\n"},868:e=>{e.exports="import {Poly} from '@polygonjs/polygonjs/src/engine/Poly';\nimport {SceneJsonExporterData} from '@polygonjs/polygonjs/src/engine/io/json/export/Scene';\nimport {OnProgressCallback} from './loadSceneData';\nimport {PolySceneWithNodeMap_<%= sceneName %>} from './PolySceneWithNodeMap';\nimport {BaseViewerType} from '@polygonjs/polygonjs/src/engine/viewers/_Base';\nimport {WebGLRenderer} from 'three';\n\nexport interface loadSceneOptions {\n\tsceneData: SceneJsonExporterData;\n\tonProgress?: OnProgressCallback;\n\tautoPlay?:boolean;\n\tcreateViewer?:boolean;\n\tdomElement?: HTMLElement|string;\n\trunRegister?: boolean;\n\tassetsRoot?: string;\n\tlibsRootPrefix?: string;\n\tprintWarnings?: boolean;\n\trenderer?: WebGLRenderer;\n\tcameraMaskOverride?: string;\n}\ninterface LoadedData {\n\tscene: PolySceneWithNodeMap_<%= sceneName %>,\n\tviewer: BaseViewerType|undefined\n}\nexport type LoadSceneMethod = (options: loadSceneOptions) => Promise<LoadedData|undefined>;\n\ndeclare const loadSceneFromSceneData_<%= sceneName %>: LoadSceneMethod;\n\nexport {Poly, loadSceneFromSceneData_<%= sceneName %>};"},2032:e=>{e.exports="import {ScenePlayerImporter} from '@polygonjs/polygonjs/src/engine/io/player/Scene';\nimport {PolyNodeController} from '@polygonjs/polygonjs/src/engine/nodes/utils/poly/PolyNodeController';\nimport {configureScene, configurePolygonjs} from '../PolyConfig';\nimport {Poly} from '@polygonjs/polygonjs/src/engine/Poly';\nimport {AllExpressionsRegister} from '@polygonjs/polygonjs/src/engine/poly/registers/expressions/All';\nimport {requiredImports_<%= sceneName %>} from './requiredImports';\n\n\nconst loadSceneFromSceneData_<%= sceneName %> = async function (options) {\n\tconst {\n\t\tdomElement,\n\t\tsceneData,\n\t\tonProgress,\n\t\tautoPlay,\n\t\tcreateViewer,\n\t\tassetsRoot,\n\t\tlibsRootPrefix,\n\t\tprintWarnings,\n\t\trenderer,\n\t\tcameraMaskOverride\n\t} = options;\n\tconst runRegister = options.runRegister != null ? options.runRegister : true;\n\n\tif( runRegister ){\n\t\t// registers nodes required for this scene\n\t\tfor (const node of requiredImports_<%= sceneName %>.nodes) {\n\t\t\tPoly.registerNode(node, undefined, {printWarnings});\n\t\t}\n\t\tfor (const operation of requiredImports_<%= sceneName %>.operations) {\n\t\t\tPoly.registerOperation(operation, {printWarnings});\n\t\t}\n\t\tfor(const jsFunction of requiredImports_<%= sceneName %>.jsFunctions){\n\t\t\tPoly.registerNamedFunction(jsFunction, {printWarnings});\n\t\t}\n\t\tconst polyNodesData = <%= polyNodesData %>;\n\t\tfor (let polyNodeData of polyNodesData) {\n\t\t\tPolyNodeController.createNodeClassAndRegister(polyNodeData);\n\t\t}\n\t\tAllExpressionsRegister.run(Poly);\n\t\tconfigurePolygonjs(Poly);\n\t}\n\n\tPoly.libs.setRoot('<%= libsRoot %>');<%= displayLogoFunctionCall %>\n\n\tfunction configureSceneAndOverrideAssetsRootIfRequired(scene){\n\t\tconfigureScene(scene);\n\t\tif(assetsRoot){\n\t\t\tscene.assets.setRoot(assetsRoot);\n\t\t}\n\t\tif(libsRootPrefix){\n\t\t\tPoly.libs.setRootPrefix(libsRootPrefix);\n\t\t}\n\t}\n\n\t// load the scene and create a viewer\n\tconst sceneName = '<%= sceneName %>';\n\tconst {scene, viewer} = await ScenePlayerImporter.loadSceneData({\n\t\tdomElement,\n\t\tsceneName,\n\t\tconfigureScene: configureSceneAndOverrideAssetsRootIfRequired,\n\t\tsceneData,\n\t\tonProgress,\n\t\tautoPlay,\n\t\tcreateViewer,\n\t\trenderer,\n\t\tcameraMaskOverride,\n\t});\n\treturn {\n\t\tscene,\n\t\tviewer,\n\t};\n};\n\nexport {Poly, loadSceneFromSceneData_<%= sceneName %>};\n"},7746:e=>{e.exports='{\n\t"engines": {\n\t\t"node": ">=16.13.1",\n\t\t"yarn": ">=1.22.7"\n\t},\n\t"scripts": {\n\t\t"polygon": "polygonjs-editor"\n\t},\n\t"dependencies": {\n\t\t"polygonjs-editor": "<%= editorVersion %>"\n\t}\n}\n'},8160:(e,t,n)=>{t.__esModule=!0,t.MainController=void 0;var o=n(2992),r=n(8215),i=n(5579),s=n(1939),a=n(1873),l=n(3),c=n(8846),u=n(8320),p=n(9476),d=n(1353),f=n(4239),h=n(3174),_=n(9820),m=n(3405),g=n(6380),v=n(8566),y=n(6356),S=n(7762),b=n(5147),A=n(705),C=n(4354),w=n(31),E=n(4401),P=n(6563),O=n(290),j=n(1827),x=n(1240),T=function(){this.project_config=new _.ProjectConfigController(this),this.scene_config=new m.SceneConfigController(this),this.file_writer=new o.FileWriterController(this),this.file_reader=new r.FileReaderController(this),this.authentication=new i.AuthenticationController(this),this.poly_config=new a.PolyConfigController(this),this.editor_config=new l.EditorConfigController(this),this.bundle=new c.BundleController(this),this.libs=new p.LibrariesController(this),this.publicAssets=new u.PublicAssetsController(this),this.manifest=new d.ManifestController(this),this.sceneLoader=new f.SceneLoaderController(this),this.sceneExport=new g.SceneExportController(this),this.sceneSaver=new h.SceneSaverController(this),this.polyNodes=new b.PolyNodesController(this),this.marketplacePolyNodes=new A.MarketplacePolyNodesController(this),this.capture=new v.CaptureController(this),this.cli=new s.CliController(this),this.tests=new y.TestsController(this),this.status=new S.StatusController(this),this.editorPage=new C.EditorPageController(this),this.nodeDownloadedFiles=new w.NodeDownloadedFilesController(this),this.socket=new E.SocketIOController(this),this.filesWatch=new P.FilesWatchController(this),this.share=new O.ShareController(this),this.multiPlayer=new j.MultiPlayerController(this),this.plugins=new x.PluginsController(this)};t.MainController=T},5579:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.AuthenticationController=void 0;var s=n(8010),a=i(n(4809)),l=n(6497),c=n(3970),u=n(4859),p=function(){function e(e){this.mainController=e,this.localToken=new l.LocalTokenController(this.mainController)}return e.prototype.createToken=function(e,t){return o(this,void 0,void 0,(function(){var n,o,i,l,p,d,f,h,_;return r(this,(function(r){switch(r.label){case 0:return n=e.body,o=n.email,i=n.password,l=c.SystemController.hostname(),[4,c.SystemController.hardware_id()];case 1:return p=r.sent(),d={user:{email:o,password:i},token:{hostname:l,hardware_id:p}},f=u.RemoteApiController.createTokenUrl(),[4,(0,a.default)(f,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(d)})];case 2:return[4,(h=r.sent()).json()];case 3:return _=r.sent(),h.status==s.StatusCodes.OK&&this.mainController.authentication.localToken.removeSecrets(_.destroyed_tokens),t.status(h.status),t.json(_),[2,h]}}))}))},e.prototype.showToken=function(e,t){return o(this,void 0,void 0,(function(){var n,o,i,a;return r(this,(function(r){switch(r.label){case 0:if(n=e.query,o=n.browserId,!(i=n.secret))return t.status(s.StatusCodes.UNAUTHORIZED),t.json({error:"unauthorized"}),[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.fetchTokenInfo(i)];case 2:return(a=r.sent())?(this.localToken.markBrowserInUse({browserId:o,secret:i}),t.status(a.response.status),t.json(a.json)):(t.status(s.StatusCodes.UNAUTHORIZED),t.json({error:"could not connect with the server, please try again"})),[3,4];case 3:return r.sent(),t.status(s.StatusCodes.UNAUTHORIZED),t.json({error:"could not connect with the server, please try again"}),[3,4];case 4:return[2]}}))}))},e.prototype.fetchTokenInfo=function(e){return o(this,void 0,void 0,(function(){var t,n,o,i,s,l;return r(this,(function(r){switch(r.label){case 0:return t=c.SystemController.hostname(),[4,c.SystemController.hardware_id()];case 1:return n=r.sent(),o={secret:e,token:{hostname:t,hardware_id:n}},i=u.RemoteApiController.tokenUrl(),[4,(0,a.default)(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(o)})];case 2:s=r.sent(),r.label=3;case 3:return r.trys.push([3,5,,6]),[4,s.json()];case 4:return l=r.sent(),this.mainController.authentication.localToken.removeSecrets(l.destroyed_tokens),[2,{json:l,response:s}];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},e.prototype.logout=function(e,t){return o(this,void 0,void 0,(function(){var n,o,i,s,l,p,d,f,h;return r(this,(function(r){switch(r.label){case 0:return n=e.body,(o=n.secret)?(i=c.SystemController.hostname(),[4,c.SystemController.hardware_id()]):(console.log("no secret"),t.json({error:"no secret"}),[2]);case 1:return s=r.sent(),l={secret:o,token:{hostname:i,hardware_id:s}},p=u.RemoteApiController.tokenUrl(),[4,(0,a.default)(p,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(l)})];case 2:d=r.sent(),r.label=3;case 3:return r.trys.push([3,5,,6]),[4,d.json()];case 4:return h=r.sent(),this.mainController.authentication.localToken.removeSecrets(h.destroyed_tokens),t.json(h),[3,6];case 5:return f=r.sent(),h={destroyed_tokens:[],error:"failed to logout"},console.log("failed to logout",f.message),t.json(h),[3,6];case 6:return[2]}}))}))},e}();t.AuthenticationController=p},6497:(e,t)=>{t.__esModule=!0,t.LocalTokenController=void 0;var n=function(){function e(e){this.mainController=e,this._browserIdsInUseBySecret=new Map}return e.prototype.markBrowserInUse=function(e){var t=this._browserIdsInUseBySecret.get(e.secret);t||(t=new Set,this._browserIdsInUseBySecret.set(e.secret,t)),t.add(e.browserId),t.size>1&&this.mainController.socket.emitAuthSessionDestroyed({browserIds:this._browserIds(e.secret).filter((function(t){return t!=e.browserId}))})},e.prototype.removeBrowser=function(e){var t=this._browserIdsInUseBySecret.get(e.secret);t&&t.delete(e.browserId)},e.prototype.removeSecrets=function(e){for(var t=new Set,n=0,o=e;n<o.length;n++){var r=o[n],i=this._browserIdsInUseBySecret.get(r);i&&i.forEach((function(e){return t.add(e)}))}var s=[];t.forEach((function(e){return s.push(e)})),0!=s.length&&this.mainController.socket.emitAuthSessionDestroyed({browserIds:s})},e.prototype._browserIds=function(e){var t=[],n=this._browserIdsInUseBySecret.get(e);return n&&n.forEach((function(e){return t.push(e)})),t},e}();t.LocalTokenController=n},731:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.BackupZipController=void 0;var l=n(2456),c=n(5849),u=n(5898),p=n(7129),d=i(n(1017)),f=n(4302),h=n(4783),_=function(){function e(e){this._filesToZip=new Set,this._fileContents=new Set,this.publicFolder=e.publicFolder,this.backupFolder=e.backupFolder,this.backupName=e.backupName}return e.prototype.createZip=function(){return s(this,void 0,void 0,(function(){var e,t,n,o,r,i,s,p,_,m,g,v,y,S,b,A,C,w,E,P,O,j;return a(this,(function(a){switch(a.label){case 0:if(t=(e=this).publicFolder,n=e.backupFolder,o=e.backupName,r=d.join(n,"".concat(o,".zip")),l.FsWrapped.existsSync(r))return c.Logger.log("zip archive ".concat(r," already exist")),[2];for(i=u.FileHelper.getFilesFromDir(t),s=0,p=i;s<p.length;s++)_=p[s],this.addFilePath(d.join(t,_));for(m={},g=[],this._filesToZip.forEach((function(e){g.push(e)})),v=0,y=g;v<y.length;v++)S=y[v],"/"==(b=S.replace(t,""))[0]&&(b=b.slice(1,b.length)),m[b]=l.FsWrapped.readFileSync(S);A=[],this._fileContents.forEach((function(e){A.push(e)})),C=0,w=A,a.label=1;case 1:return C<w.length?(E=w[C],P=m,O=E.path,[4,(0,h.stringToUint8Array)(E.content)]):[3,4];case 2:P[O]=a.sent(),a.label=3;case 3:return C++,[3,1];case 4:return this._zipped=(0,f.zipSync)(m),j=d.dirname(r),l.FsWrapped.existsSync(j)||l.FsWrapped.mkdirSync(j,{recursive:!0}),l.FsWrapped.writeFileSync(r,this._zipped),c.Logger.log("written zip archive: ".concat(r)),[2]}}))}))},e.prototype.addFilePath=function(e){var t=decodeURI(e);if(l.FsWrapped.existsSync(t)){var n=p.UrlHelper.sanitize(t);this._filesToZip.add(n)}else c.Logger.warn("file not found on disk: ".concat(t))},e}();t.BackupZipController=_},7301:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.BinaryController=void 0;var l=n(2456),c=n(5849),u=i(n(7147)),p=n(4302),d="fileDataURL",f=new TextEncoder,h=new TextDecoder,_=function(){function e(){}return e.write=function(e){var t,n=e.filePath,o=e.fileDataURL,r=(0,p.zipSync)(((t={})[d]=f.encode(o),t));l.FsWrapped.writeFileSync(n,r)},e.read=function(e){return s(this,void 0,void 0,(function(){var t,n,o,r;return a(this,(function(i){if(t=e.filePath,!l.FsWrapped.existsSync(t))return[2];try{return n=u.readFileSync(t),o=(0,p.unzipSync)(n),r=o[d],[2,h.decode(r)]}catch(e){c.Logger.error("fail to read ".concat(t))}return[2]}))}))},e}();t.BinaryController=_},8566:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.CaptureController=void 0;var l=n(2456),c=n(7126),u=i(n(7147)),p=i(n(1017)),d=n(5849),f="poster.".concat("png"),h="poster.".concat("webm"),_=function(){function e(e){this.mainController=e}return e.prototype.debug=function(e){d.Logger.log(this.fullFolderStaticCaptures()),d.Logger.log(this._videoFullFilePath()),d.Logger.log(this._staticFullFilePath())},e.prototype.saveAnimation=function(e,t){return s(this,void 0,void 0,(function(){var n,o,r,i;return a(this,(function(s){switch(s.label){case 0:return n=e.body,this.mainController.project_config.resetWithSceneName(n.sceneName),o=this._videoFullFilePath(),[4,this._saveBlob(n,o)];case 1:return s.sent(),i={filePath:r=o,url:this._videoUrl()},d.Logger.log("video saved to ".concat(r)),t.json(i),[2]}}))}))},e.prototype.saveStatic=function(e,t){return s(this,void 0,void 0,(function(){var n,o,r,i;return a(this,(function(s){switch(s.label){case 0:return n=e.body,this.mainController.project_config.resetWithSceneName(n.sceneName),o=this._staticFullFilePath(),r=this._staticUrl(),[4,this._saveBlob(n,o)];case 1:return s.sent(),i={filePath:o,url:r},d.Logger.log("image saved to ".concat(o)),t.json(i),[2]}}))}))},e.prototype.saveAnimationFrame=function(e,t){return s(this,void 0,void 0,(function(){var n,o,r,i,s;return a(this,(function(a){switch(a.label){case 0:return n=e.body,o=n.sceneName,r=n.fileName,this.mainController.project_config.resetWithSceneName(o),i=p.join(this.fullFolderRenders(),r),[4,this._saveBlob(n,i)];case 1:return a.sent(),s={filePath:i},d.Logger.log("animation frame saved to ".concat(i)),t.json(s),[2]}}))}))},e.prototype.loadAnimationFrame=function(e,t){return s(this,void 0,void 0,(function(){var n,o,r,i,s;return a(this,(function(a){return n=e.body,o=n.sceneName,r=n.fileName,this.mainController.project_config.resetWithSceneName(o),i=p.join(this._relativeFolderRenders(),r),s={filePath:i},d.Logger.log("loading animation frame ".concat(i)),t.json(s),[2]}))}))},e.prototype.requestStatus=function(e,t){return s(this,void 0,void 0,(function(){var n,o;return a(this,(function(r){return n=e.body,this.mainController.project_config.resetWithSceneName(n.sceneName),o={staticThumbnailExists:l.FsWrapped.existsSync(this._staticFullFilePath()),animationExists:l.FsWrapped.existsSync(this._videoFullFilePath())},t.json(o),[2]}))}))},e.prototype.loadStatic=function(e,t){return s(this,void 0,void 0,(function(){var n,o,r;return a(this,(function(i){return n=e.query,this.mainController.project_config.resetWithSceneName(n.sceneName),o=this._staticFullFilePath(),d.Logger.log("loading image from ".concat(o)),l.FsWrapped.existsSync(o)?t.sendFile(o):(r={error:"no image saved on path '".concat(o,"'")},t.status(500).send(r)),[2]}))}))},e.prototype._saveBlob=function(e,t){return s(this,void 0,void 0,(function(){var n,o;return a(this,(function(r){n=c.CoreFileUtils.dataURItoBuffer(e.fileDataURL),o=p.dirname(t),l.FsWrapped.existsSync(o)||l.FsWrapped.mkdirSync(o,{recursive:!0});try{u.writeFileSync(t,Buffer.from(n),"binary")}catch(e){d.Logger.error("failed to write to file '".concat(t,"'"))}return[2]}))}))},e.prototype._publicStaticCapturesFolder=function(){var e=this.mainController.project_config.config().sceneName;return p.join("polygonjs","screenshots","scenes",e)},e.prototype._publicRenderCapturesFolder=function(){var e=this.mainController.project_config.config().sceneName;return p.join("polygonjs","renders","scenes",e)},e.prototype.staticPublicFilePath=function(){return p.join(this._publicStaticCapturesFolder(),f)},e.prototype.fullFolderStaticCaptures=function(){var e=this.mainController.project_config.config();return p.join(e.public_root,this._publicStaticCapturesFolder())},e.prototype.fullFolderRenders=function(){var e=this.mainController.project_config.config();return p.join(e.public_root,this._publicRenderCapturesFolder())},e.prototype._relativeFolderRenders=function(){return this._publicRenderCapturesFolder()},e.prototype._staticFullFilePath=function(){return p.join(this.fullFolderStaticCaptures(),f)},e.prototype._staticUrl=function(){return p.join(this._publicStaticCapturesFolder(),f)},e.prototype._videoFullFilePath=function(){return p.join(this.fullFolderStaticCaptures(),h)},e.prototype._videoUrl=function(){return p.join(this._publicStaticCapturesFolder(),h)},e}();t.CaptureController=_},1939:(e,t)=>{t.__esModule=!0,t.CliController=void 0;var n=function(){function e(e){this.mainController=e}return e.prototype.run=function(e){this.mainController.sceneExport.createWithArgs(e)},e.prototype.testCompiledExports=function(){},e}();t.CliController=n},2822:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.CurrentPathController=void 0;var s=process.cwd(),a=i(n(1017)),l=function(){function e(){}var t;return t=e,e.CURRENT_PATH=s,e.NODE_MODULES_PATH=a.resolve(s,"node_modules"),e.LOG_FILE_NAME=".polygonjs-editor.log",e.LOG_FILE_PATH=a.resolve(s,t.LOG_FILE_NAME),e}();t.CurrentPathController=l},3:function(e,t,n){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.EditorConfigController=void 0;var c=n(2456),u=n(5849),p=n(6231),d=s(n(1017)),f=n(9659),h=n(6629),_=n(5205),m=function(){function e(e){this.mainController=e}return e.prototype.load=function(){return a(this,void 0,void 0,(function(){var e,t,n,r,i,s,a,p,m,g,v,y,S,b;return l(this,(function(l){switch(l.label){case 0:for(e=this.mainController.project_config.config().src_polygon_folder,t=d.join(e,".polygonjs_compile_editor.entry_file.ts"),n=d.join(e,".polygonjs_compile_editor.out.js"),r="./EditorConfig",i=!1,s=0,a=["ts","js"];s<a.length;s++)p=a[s],m=d.resolve(t,"../".concat(r,".").concat(p)),c.FsWrapped.existsSync(m)&&(i=!0);if(!i)return[2,this.emptyConfigureEditor("EditorConfig file not found")];g=this.mainController.sceneExport.finalZipHandler.publicBuildFolder(),v="\n\t\timport {configureEditor} from '".concat(r,"';\n\t\tconst exportFolder = '").concat(g,"';\n\t\texport {configureEditor, exportFolder}\n\t\t"),y=v,c.FsWrapped.writeFileSync(t,y),l.label=1;case 1:return l.trys.push([1,3,,4]),b=o(o({entryPoints:[t],bundle:!0,minify:!1,outfile:n,format:"esm",target:"esnext"},h.EsbuildOptions),{plugins:[_.threeImportMapsOnResolve]}),[4,(0,f.build)(b)];case 2:return l.sent(),S=c.FsWrapped.readFileSync(n,"utf-8"),c.FsWrapped.unlinkSync(n),[3,4];case 3:return l.sent(),u.Logger.error("fail to create bundle"),[3,4];case 4:return c.FsWrapped.unlinkSync(t),S?[2,S]:[2,this.emptyConfigureEditor("could not compile EditorConfig")]}}))}))},e.prototype.emptyConfigureEditor=function(e){return'\n\t\tfunction configureEditor(){ console.log("'.concat(e,'") }\n\t\texport {configureEditor}\n\t')},e.prototype.error=function(){return"\n\t\tconsole.log('".concat(p.ResponseMessageFromLocalServer.NO_EDITOR_CONFIG,"');\n\t\twindow.__POLYGONJS_EDITOR__CONFIG_LOADED = true;\n\t\t")},e}();t.EditorConfigController=m},4354:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.EditorPageController=void 0;var i=n(5849),s=n(2456),a=n(8708),l=function(){function e(e){this.mainController=e}return e.prototype.pageWithEditorConfig=function(e){return o(this,void 0,void 0,(function(){var t;return r(this,(function(n){t=s.FsWrapped.readFileSync(e,"utf-8");try{return[2,this._applyEditorApi(t)]}catch(e){i.Logger.error("fail to load pageWithEditorConfig")}return[2,t]}))}))},e.prototype._applyEditorApi=function(e){return o(this,void 0,void 0,(function(){var t,n,o,i,s,l,c,u;return r(this,(function(r){switch(r.label){case 0:return t=this.mainController.project_config.config(),n=t.sceneName,o=new a.EditorApi,[4,this.mainController.sceneExport.evalConfigureEditor({api:o,sceneName:n})];case 1:return r.sent(),i="<head>",s=e.indexOf(i),l=e.substring(0,s+i.length),c=e.substring(s+i.length),u=o.html.head.scripts(),[2,"".concat(l).concat(u).concat(c)]}}))}))},e}();t.EditorPageController=l},6563:function(e,t,n){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.FilesWatchController=void 0;var i=n(2456),s=n(5849),a=n(8320),l=r(n(1490)),c=function(){function e(e){this.mainController=e,this._watchersByFilePath=new Map}return e.prototype.watchFile=function(e){var t=this,n=e.fullFilePath,r=e.requestedUrl,c=this._watchersByFilePath.get(n);if(c&&(c.requestedUrl=r),!c){var u=null,p=!1;try{var d=i.FsWrapped.watch(n,(function(r,c){try{if(c){if(p)return;if(p=setTimeout((function(){p=!1}),100),!i.FsWrapped.existsSync(n))return void t._terminateWatcher(n);var d=i.FsWrapped.readFileSync(n),f=(0,l.default)(d);if(f===u)return;u=f;var h=t._watchersByFilePath.get(n);if(!h)return;var _=(0,a.getFilePathTimestamp)(e.fullFilePath);if(null==_)return;var m=o(o({},h),{newTimestamp:_});t.mainController.socket.emitFileChanged(m)}}catch(e){s.Logger.error("cannot react to filewatch change for '".concat(n,"'. It may be a windows related issue (see https://github.com/nodejs/node/issues/31702)"))}}));d&&this._watchersByFilePath.set(n,{fullFilePath:n,requestedUrl:r,watcher:d})}catch(e){s.Logger.error("cannot start filewatcher for '".concat(n,"'. It may be a windows related issue (see https://github.com/nodejs/node/issues/31702)"))}}},e.prototype._terminateWatcher=function(e){var t=this._watchersByFilePath.get(e);t&&(t.watcher.close(),this._watchersByFilePath.delete(e))},e}();t.FilesWatchController=c},9476:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.LibrariesController=void 0;var s=n(2456),a=i(n(1017)),l=n(5898),c=n(6231),u=n(5849),p=n(9898);function d(e,t){var n=a.extname(e);return t.includes(n)}function f(e,t){var n=t.fileNameContains;return null==n||a.basename(e).includes(n)}function h(e){var t=e.srcFolderPath,n=e.destFolderPath,o=e.reInstallIfOutOfDate,r=e.onlyExtensions,i=e.fileNameContains;if(1==o){if(!s.FsWrapped.existsSync(n))return;u.Logger.log("updating folder ".concat(n))}u.Logger.log("copy folder ".concat(t," -> ").concat(n));for(var c=0,p=l.FileHelper.getFilesFromDir(t);c<p.length;c++){var h=p[c],_=!0;if(null!=r&&(_=d(h,r)),null!=i&&(_=f(h,e)),_){var m=a.join(t,h),g=a.join(n,h),v=a.dirname(g);s.FsWrapped.existsSync(v)||(u.Logger.log("mkdir -p ".concat(v)),s.FsWrapped.mkdirSync(v,{recursive:!0})),u.Logger.log("cp ".concat(m," ").concat(g)),s.FsWrapped.copyFileSync(m,g)}else{var y="not installing file '".concat(h,"'");null!=r&&(y+=", since it does not have one of the required extensions '".concat(r.join(","),"'")),null!=r&&u.Logger.log(y)}}}var _=function(){function e(e){this.mainController=e}return e.prototype.installDraco=function(e,t){this._installThreejsLib({strFolderName:"draco",destFolderName:"draco"},e,t)},e.prototype.installKTX2=function(e,t){this._installThreejsLib({strFolderName:"basis",destFolderName:"ktx2"},e,t)},e.prototype.installXAtlas=function(e,t){this._installXAtlasLib({destFolderName:"xatlas"},e,t)},e.prototype.installOCCT=function(e,t){this._installOCCTLib({destFolderName:"occt"},e,t)},e.prototype.installManifold=function(e,t){this._installManifoldLib({destFolderName:"manifold"},e,t)},e.prototype._installThreejsLib=function(e,t,n){var o=t.body;if(o.libsRoot){var r=(0,p.threejsFolder)(e);if(r&&u.Logger.log("checking folder exists '".concat(r,"': ").concat(s.FsWrapped.existsSync(r)?"OK":"NOT OK")),null==r||!s.FsWrapped.existsSync(r))return u.Logger.error("'".concat(r,"' not found")),void n.json({error:c.ResponseMessageFromLocalServer.THREEJS_NOT_INSTALLED});for(var i=this.mainController.project_config.read_local_config_file().assets||this.mainController.project_config.defaultAssetsFolder(),l=0,d=o.libsRoot.split("/");l<d.length;l++){var f=d[l];i=a.join(i,f)}h({srcFolderPath:r,destFolderPath:i=a.join(i,e.destFolderName),reInstallIfOutOfDate:o.reInstallIfAlreadyPresent}),n.json({})}else n.json({error:c.ResponseMessageFromLocalServer.NO_LIBS_ROOT})},e.prototype._installXAtlasLib=function(e,t,n){var o=t.body;if(o.libsRoot){for(var r=this.mainController.project_config.read_local_config_file().assets||this.mainController.project_config.defaultAssetsFolder(),i=0,l=o.libsRoot.split("/");i<l.length;i++){var u=l[i];r=a.join(r,u)}r=a.join(r,e.destFolderName);var p=a.join(process.cwd(),"node_modules","@polygonjs","polygonjs","dist","src","core","thirdParty","xatlasjs");s.FsWrapped.existsSync(p)?(h({srcFolderPath:p,destFolderPath:r,reInstallIfOutOfDate:o.reInstallIfAlreadyPresent}),n.json({})):n.json({error:c.ResponseMessageFromLocalServer.XATLAS_NOT_INSTALLED})}else n.json({error:c.ResponseMessageFromLocalServer.NO_LIBS_ROOT})},e.prototype._installOCCTLib=function(e,t,n){var o=t.body;if(o.libsRoot){for(var r=this.mainController.project_config.read_local_config_file().assets||this.mainController.project_config.defaultAssetsFolder(),i=0,l=o.libsRoot.split("/");i<l.length;i++){var u=l[i];r=a.join(r,u)}r=a.join(r,e.destFolderName);var p=a.join(process.cwd(),"node_modules","@polygonjs","polygonjs","dist","src","core","geometry","modules","cad","build");s.FsWrapped.existsSync(p)?(h({srcFolderPath:p,destFolderPath:r,reInstallIfOutOfDate:o.reInstallIfAlreadyPresent,onlyExtensions:[".wasm"]}),n.json({})):n.json({error:c.ResponseMessageFromLocalServer.POLYGONJS_NOT_INSTALLED})}else n.json({error:c.ResponseMessageFromLocalServer.NO_LIBS_ROOT})},e.prototype._installManifoldLib=function(e,t,n){var o=t.body;if(o.libsRoot){for(var r=this.mainController.project_config.read_local_config_file().assets||this.mainController.project_config.defaultAssetsFolder(),i=0,l=o.libsRoot.split("/");i<l.length;i++){var u=l[i];r=a.join(r,u)}r=a.join(r,e.destFolderName);var p=a.join(process.cwd(),"node_modules","manifold-3d");s.FsWrapped.existsSync(p)?(h({srcFolderPath:p,destFolderPath:r,reInstallIfOutOfDate:o.reInstallIfAlreadyPresent,onlyExtensions:[".wasm"]}),n.json({})):n.json({error:c.ResponseMessageFromLocalServer.POLYGONJS_NOT_INSTALLED})}else n.json({error:c.ResponseMessageFromLocalServer.NO_LIBS_ROOT})},e}();t.LibrariesController=_},8877:(e,t)=>{t.__esModule=!0,t.POLYGONJS_LOGO_DATAURI=void 0,t.POLYGONJS_LOGO_DATAURI="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gIoSUNDX1BST0ZJTEUAAQEAAAIYAAAAAAQwAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANv/bAEMAAwICAgICAwICAgMDAwMEBgQEBAQECAYGBQYJCAoKCQgJCQoMDwwKCw4LCQkNEQ0ODxAQERAKDBITEhATDxAQEP/bAEMBAwMDBAMECAQECBALCQsQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEP/AABEIAEAAQAMBIgACEQEDEQH/xAAbAAEAAgMBAQAAAAAAAAAAAAAABggEBQcDAf/EAC8QAAEDAwQBAgQFBQAAAAAAAAECAwQABREGByExEiJBEzJCUQgUFVJhIzRTYnP/xAAZAQACAwEAAAAAAAAAAAAAAAAABwIDBAj/xAApEQABAQcDAwQDAAAAAAAAAAABAgADBAURITEGIlEyQXFCYoHwI1Jh/9oADAMBAAIRAxEAPwDoFKUrjpuwGUpW10zpXUGsbqmy6atjk6YpBcKElKQhA7UpSiEpAyBkkckAZJANjp08frDp0kqUbAAVJPAAy1b167cILx6oJSLkk0AHJJw2qpWbebNddPXSRZb3Bdhzoi/B5lzGUnvscEEEEEEggggkHNYVRWhTtRQsUIsQbEHgtJC0vEhaDUG4IuCOQylKVFpMpSlDDbrSGkL7ri+saf0/F+NJe9S1qyG2WwR5OOK+lIyOeySAASQDczbzbzT+2OnzbrcUreWA7PnugJXIWAfUf2oTk+Kc4SCeSSpR1Oylh0Zp3b2Hc9NyWXkTmEyZ89RAU46kesLP0Bs+SQj6cHOVFRPE98d8HNZuu6T0rIUiwoV4Pvp4VPVnr/lnofV2eMCnLKoWXaElqZrGEPIh4NgB7EYSfB3L+B7k7NIqY65mKpVBgu4d2d5I4OVDmo2o+TT09v3b2ktW5lqC0FuJe4iCIcwjgjv4TuOS2TnnkpJyM5UlVOb1Zbrp26ybJe4TkSbEX8N5lwcpPYII4IIwQRkEEEEg13XYjff8t+W0Tradlg+LVuuLqvk9ktOqPt7JUeujxg1L/wAS+nNIzNFq1Hd3G4t4hFDNveTj4kgqVywR2tOPJX+uCrryBp1BAS3V8tVPpcQh6gVWDatBg+6nSr1C3i2QR8x0lMkyGYArdLNEEXpU5Ht/ZPpN/NTqUpSgZuspSlDDbC3T9QFhenbTPuXwLm4lC4EZ5zwlOHCUgtJOFqPpABBJwB9qtTsnsnH0FHRqLUTTb+on0cDIUiAhQ5Qg9Fwg4UsfylPGSvx2H2dt+kbZF1heA1Lvk9hLrJHqRCaWnPig+6yk+pf8lKePIrwt8t9E6VS9pHR0pKr0oeMqUnCkwgfpGeC6ft0ns84FOLT8khdLwaZ7PTvA/GjNK3FB3UcgYTk3qQoJ/O4rU8YZHIxsJ3rxWljU9kjBOVYFrHE322JF8EjWmi4Q/UuXJ8BtP9393Gx/l+6fr7Hq+euFwvN5uyY7d2u86amGgtR0yZC3Qyjj0oCifEcDgY6H2FWz2W3ph7hQ02W9LajahjIytA9KJaB242Pv+5Pt2OOol+IfZ23rhTNx9PBqLIZ/q3ON8qHwSAXk+wcyfUOlcn5s+efU+n4acwap/IlbVCrxItWlyadlDKh3yL5v0zqCJk8YmQzxO5Jo7Ub0rYCvdJwk9sG2K20pSlKzYZSlKGGn2nt8dwtM6VXpG2XFgxvAtx33myuREQR8rSvLAA9vIK8ehgAAQJa1uLU44tS1rJUpSiSVEnJJJ5JJ96+UrXEzCKjEIdxDwqSgUSCa0H8+8cNkhoCFhFreOHYSpZqogUqeT955b2hTZltmM3C3ynY0qMsOsvNK8VtrHRBqZ643m1xuDao1lvkmM1DYIU63EaU0JSxjxU7lRzgjIAwnPOMhOINShxHxUM5XDuXhShfUAbHyw+gIWIfIiHrsKWjpJFx4ZSlKyNrb/9k="},1353:(e,t,n)=>{t.__esModule=!0,t.ManifestController=void 0;var o=n(2992),r=n(7633),i=function(){function e(e){this.mainController=e}return e.prototype.load=function(){var e=this.mainController.file_reader.readJSON(r.OutFileName.MANIFEST,o.JsonDestFolder.SRC,{displayError:!1});e||(e=this.mainController.file_reader.readJSON(r.OutFileName.MANIFEST_LEGACY,o.JsonDestFolder.SRC,{displayError:!1})),this._currentContent=e},e.prototype.content=function(){return this._currentContent},e}();t.ManifestController=i},705:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.MarketplacePolyNodesController=void 0;var s=n(5849),a=n(8010),l=n(4859),c=n(3970),u=n(8941),p=i(n(4809)),d=n(7310),f=function(){function e(e){this.mainController=e}return e.prototype.index=function(e,t){return o(this,void 0,void 0,(function(){var n,o,i,s,a,l,c,u,p,d,f,h,_,m,g;return r(this,(function(r){switch(r.label){case 0:return n=e.body,o=n.secret,i=n.skip_token_with_username,o?(s=this.mainController.polyNodes.installed(),[4,this._indexRemote(o,{skip_token_with_username:i})]):(t.json({}),[2]);case 1:for(a=r.sent(),l=new Map,c=0,u=s;c<u.length;c++)p=u[c],_="".concat(p.node_context,"/").concat(p.node_type),l.set(_,{node_context:p.node_context,node_type:p.node_type,username:p.username,online:!1,local:!0,localVersion:p.localVersion,thumbnail_url:void 0});if(a&&a.polyNodes)for(d=0,f=a.polyNodes;d<f.length;d++)h=f[d],_="".concat(h.node_context,"/").concat(h.node_type),(m=l.get(_))?(m.online=!0,m.version=h.version,m.thumbnail_url=h.thumbnail_url):l.set(_,{node_context:h.node_context,node_type:h.node_type,username:h.username,local:!1,online:!0,version:h.version,thumbnail_url:h.thumbnail_url});return g={polyNodes:[]},l.forEach((function(e,t){g.polyNodes=g.polyNodes||[],g.polyNodes.push(e)})),t.json(g),[2]}}))}))},e.prototype._indexRemote=function(e,t){return o(this,void 0,void 0,(function(){var n,o,i,s;return r(this,(function(r){switch(r.label){case 0:return n=l.RemoteApiController.marketplacePolyNodesIndex(),o=new d.URLSearchParams,[4,this._appendCredentials(o,e,t)];case 1:r.sent(),i="".concat(n,"?").concat(o.toString()),r.label=2;case 2:return r.trys.push([2,7,,8]),[4,(0,p.default)(i)];case 3:return(s=r.sent()).ok?[4,s.json()]:[3,5];case 4:return[2,{polyNodes:r.sent().polyNodes}];case 5:return[2,{error:"failed to get polynodes"}];case 6:return[3,8];case 7:return r.sent(),[2,{error:"failed to get polynodes"}];case 8:return[2]}}))}))},e.prototype.search=function(e,t){return o(this,void 0,void 0,(function(){var n,i,s,a,c,u,f,h=this;return r(this,(function(_){switch(_.label){case 0:return n=e.body,i=n.q,s=l.RemoteApiController.marketplacePolyNodesSearch(),(a=new d.URLSearchParams).append("q",i||""),c="".concat(s,"?").concat(a.toString()),u=function(){return o(h,void 0,void 0,(function(){var e,t,n,o,i,s;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),[4,(0,p.default)(c)];case 1:return(e=r.sent()).ok?[4,e.json()]:[3,3];case 2:if(t=r.sent(),n=t.polyNodes){for(o=0,i=n;o<i.length;o++)(s=i[o]).installedVersion=this.mainController.polyNodes.marketplacePolyNodeInstalledVersion(s);return[2,{polyNodes:n}]}return[2,{error:"failed to get polynodes"}];case 3:return[2,{error:"failed to get polynodes"}];case 4:return[3,6];case 5:return r.sent(),[2,{error:"failed to get polynodes"}];case 6:return[2]}}))}))},[4,u()];case 1:return f=_.sent(),t.json(f),[2]}}))}))},e.prototype.upload=function(e,t){return o(this,void 0,void 0,(function(){var n,i,s,a,c,p,d,f,h=this;return r(this,(function(_){switch(_.label){case 0:return n=e.body,i=n.secret,s=this.mainController.polyNodes.fileContent(n.node_context,n.node_type),a={node_context:n.node_context,node_type:n.node_type,data:JSON.stringify(s)},c=l.RemoteApiController.marketplacePolyNodesUpload(),(p=new u).append("poly_node[node_context]",a.node_context),p.append("poly_node[node_type]",a.node_type),p.append("poly_node[data]",a.data),d=function(){return o(h,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),[4,this._postRequest(c,p,i,{skip_token_with_username:n.skip_token_with_username})];case 1:return(e=t.sent())?e.ok?[4,e.json()]:[3,3]:[2,{}];case 2:return t.sent(),[2,{}];case 3:return[2,{error:"failed to upload"}];case 4:return[3,6];case 5:return t.sent(),[2,{error:"failed to upload"}];case 6:return[2]}}))}))},[4,d()];case 1:return f=_.sent(),t.json(f),[2]}}))}))},e.prototype.download=function(e,t){return o(this,void 0,void 0,(function(){var n,i,c,u,f,h,_,m,g,v=this;return r(this,(function(y){switch(y.label){case 0:return n=e.body,i=n.secret,c=n.username,u=n.node_context,f=n.node_type,h=n.version,_=n.skip_token_with_username,m=function(){return o(v,void 0,void 0,(function(){var e,t,n,o,m,g;return r(this,(function(r){switch(r.label){case 0:return e={username:c,node_context:u,node_type:f,version:h},t=l.RemoteApiController.marketplacePolyNodesData(),n=new d.URLSearchParams,null==i?[3,2]:[4,this._appendCredentials(n,i,{skip_token_with_username:_})];case 1:r.sent(),r.label=2;case 2:n.append("username",e.username),n.append("node_context",e.node_context),n.append("node_type",e.node_type),n.append("version","".concat(e.version)),o="".concat(t,"?").concat(n.toString()),r.label=3;case 3:return r.trys.push([3,7,,8]),[4,(0,p.default)(o)];case 4:return(m=r.sent())?m.status!=a.StatusCodes.OK?(s.Logger.error("response status not ok (".concat(m.status,")")),[2,{error:"error response from marketplate"}]):[4,m.json()]:(s.Logger.error("no response from marketplate"),[2,{error:"no response from marketplate"}]);case 5:return g=r.sent(),[4,this.mainController.polyNodes.writePolyNodeData({username:e.username,node_context:e.node_context,node_type:e.node_type,data:g})];case 6:return r.sent(),[2,{polyNodeDefinition:g}];case 7:return r.sent(),[2,{error:"failed to download"}];case 8:return[2]}}))}))},[4,m()];case 1:return g=y.sent(),t.json(g),[2]}}))}))},e.prototype._postRequest=function(e,t,n,i){return o(this,void 0,void 0,(function(){var o,s;return r(this,(function(r){switch(r.label){case 0:return[4,c.SystemController.hardware_id()];case 1:return o=r.sent(),s=c.SystemController.hostname(),(null==i?void 0:i.skip_token_with_username)&&t.append("skip_token_with_username",i.skip_token_with_username),t.append("secret",n),t.append("token[hardware_id]",o),t.append("token[hostname]",s),[4,(0,p.default)(e,{method:"POST",body:t})];case 2:return[2,r.sent()]}}))}))},e.prototype._appendCredentials=function(e,t,n){return o(this,void 0,void 0,(function(){var o,i;return r(this,(function(r){switch(r.label){case 0:return[4,c.SystemController.hardware_id()];case 1:return o=r.sent(),i=c.SystemController.hostname(),(null==n?void 0:n.skip_token_with_username)&&e.append("skip_token_with_username",n.skip_token_with_username),e.append("secret",t),e.append("token[hardware_id]",o),e.append("token[hostname]",i),[2]}}))}))},e}();t.MarketplacePolyNodesController=f},31:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.NodeDownloadedFilesController=void 0;var l=n(2456),c=n(7126),u=n(5849),p=i(n(7147)),d=i(n(1017)),f=function(){function e(e){this.mainController=e}return e.prototype.download=function(e,t){return s(this,void 0,void 0,(function(){var n,o,r;return a(this,(function(i){switch(i.label){case 0:return n=e.body,[4,this._saveBlob(n,this._staticFullFilePath(n.fileName))];case 1:return o=i.sent(),r={filePath:o},u.Logger.log("file saved to ".concat(o)),t.json(r),[2]}}))}))},e.prototype._saveBlob=function(e,t){return s(this,void 0,void 0,(function(){var n,o;return a(this,(function(r){n=c.CoreFileUtils.dataURItoBuffer(e.fileDataURL),o=d.dirname(t),l.FsWrapped.existsSync(o)||l.FsWrapped.mkdirSync(o,{recursive:!0});try{p.writeFileSync(t,Buffer.from(n),"binary")}catch(e){u.Logger.error("failed to write to file '".concat(t,"'"))}return[2,t]}))}))},e.prototype._staticFullFilePath=function(e){return d.join(this._publicFolder(),e)},e.prototype._publicFolder=function(){return this.mainController.project_config.config().public_root},e}();t.NodeDownloadedFilesController=f},1240:(e,t,n)=>{t.__esModule=!0,t.PluginsController=void 0;var o=n(3672),r=function(e){this.mainController=e,this.figma=new o.PluginFigmaController(this)};t.PluginsController=r},1873:function(e,t,n){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.PolyConfigController=void 0;var c=n(2456),u=n(9659),p=s(n(1017)),d=n(6231),f=n(6629),h=n(5205),_=function(){function e(e){this.mainController=e}return e.prototype.fileNameWithoutExt=function(){return"PolyConfig"},e.prototype.filePath=function(){for(var e=this.mainController.project_config.config(),t=["ts","js"],n=0,o=[e.src_scene_folder,e.src_polygon_folder];n<o.length;n++)for(var r=o[n],i=0,s=t;i<s.length;i++){var a=s[i],l=p.join(r,"".concat(this.fileNameWithoutExt(),".").concat(a));if(c.FsWrapped.existsSync(l))return l}},e.prototype.importLine=function(){var e=null!=this.filePath(),t=this.errorWithoutExport(),n="import {configurePolygonjs, configureScene} from '".concat("./PolyConfig","';");return e?n:t},e.prototype.wrapWithExport=function(e){return"\n\t\t".concat(e,"\n\t\texport {configurePolygonjs, configureScene};\n\t\t")},e.prototype.load=function(e,t){return a(this,void 0,void 0,(function(){var n,o;return l(this,(function(r){switch(r.label){case 0:return n=e.query,this.mainController.project_config.resetWithSceneName(n.sceneName),[4,this._fileContent()];case 1:return o=r.sent(),t.type(".js"),t.send(o),[2]}}))}))},e.prototype._fileContent=function(){return a(this,void 0,void 0,(function(){var e,t,n,r,i,s;return l(this,(function(a){switch(a.label){case 0:return(e=this.filePath())?(t=p.dirname(e),n=p.join(t,".polygonjs_compile_plugins.out.".concat(Math.random(),".ts")),r=p.join(t,".polygonjs_compile_plugins.out.".concat(Math.random(),".js")),i=this.wrapWithExport(this.importLine()),c.FsWrapped.writeFileSync(n,i),[4,(0,u.build)(o(o(o({entryPoints:[n],bundle:!0,minify:!1,outfile:r,format:"esm"},f.EsbuildOptions),f.EsbuildTargetOptions),{plugins:[h.threeImportMapsOnResolve]}))]):[2,this.wrapWithExport(this.errorWithoutExport())];case 1:return a.sent(),s=c.FsWrapped.readFileSync(r,"utf-8"),c.FsWrapped.existsSync(n)&&c.FsWrapped.unlinkSync(n),c.FsWrapped.existsSync(r)&&c.FsWrapped.unlinkSync(r),s?[2,s]:[2,this.wrapWithExport(this.errorWithoutExport())]}}))}))},e.prototype.errorWithoutExport=function(){return"\n\t\tconsole.log('".concat(d.ResponseMessageFromLocalServer.NO_POLY_CONFIG,"');\n\t\tfunction configurePolygonjs(){}\n\t\tfunction configureScene(){}\n\t\t")},e}();t.PolyConfigController=_},5147:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.PolyNodesController=void 0;var l=n(2456),c=n(5849),u=n(5898),p=i(n(1017)),d=n(9250),f="marketplace",h=function(){function e(e){this.mainController=e}return e.prototype.installed=function(){var e=this,t=this._polyNodesRootFolder(),n=u.FileHelper.getFilesFromDir(t,[".json"]);function o(e){for(var o=0,r=n;o<r.length;o++){var i=r[o],s=i.split(p.sep);try{var a=p.join(t,i);e(i,s,JSON.parse(l.FsWrapped.readFileSync(a,"utf-8")))}catch(e){c.Logger.error("failed to parse file '".concat(i,"'"))}}}var r=new Map;o((function(t,n,o){if(2==n.length){var i=n[0],s=n[1].replace(".json",""),a={node_context:i,node_type:s,data:o,localVersion:e._getFileVersion(t)||1,fromMarketplace:!1},l="".concat(i,"/").concat(s);r.set(l,a)}})),o((function(t,n,o){if(n.length>=3){var i=n[n.length-3],s=n[n.length-2],a=n[n.length-1].replace(".json",""),l="".concat(s,"/").concat(a);if(r.has(l))return;var c={node_context:s,node_type:a,data:o,username:i,localVersion:e._getFileVersion(t)||1,fromMarketplace:!0};r.set(l,c)}}));var i=[];return r.forEach((function(e){i.push(e)})),i},e.prototype.index=function(e,t){var n=this.installed();t.json(n)},e.prototype.fileContent=function(e,t){var n,o=this,r=this._polyNodesRootFolder();if(l.FsWrapped.existsSync(r)&&(null===(n=l.FsWrapped.statSync(r))||void 0===n?void 0:n.isDirectory())){var i=function(){var n,o,i=p.join(r,e);if(l.FsWrapped.existsSync(i)&&(null===(n=l.FsWrapped.statSync(i))||void 0===n?void 0:n.isDirectory())){var s=p.join(i,"".concat(t,".json"));if(l.FsWrapped.existsSync(s)&&(null===(o=l.FsWrapped.statSync(s))||void 0===o?void 0:o.isFile()))return s}}(),s=function(){var n,r=o._polyNodesRootFolder();if(l.FsWrapped.existsSync(r)){var i=p.join(r,f);if(l.FsWrapped.existsSync(i))for(var s=0,a=l.FsWrapped.readdirSync(i);s<a.length;s++){var c=a[s],u=p.join(i,c,e,"".concat(t,".json"));if(l.FsWrapped.existsSync(u)&&(null===(n=l.FsWrapped.statSync(u))||void 0===n?void 0:n.isFile()))return u}}}();i&&s&&c.Logger.warn("found multiple files for polyNode '".concat(e,"/").concat(t,"', using '").concat(i,"'"));var a=i||s;if(a)try{var u=l.FsWrapped.readFileSync(a,"utf-8");return JSON.parse(u)}catch(e){return void c.Logger.error("failed to parse file ''")}}},e.prototype.create=function(e,t){return s(this,void 0,void 0,(function(){var n;return a(this,(function(o){switch(o.label){case 0:return n=e.body,[4,this.writePolyNodeData(n)];case 1:return o.sent(),t.json({}),[2]}}))}))},e.prototype.update=function(e,t){return s(this,void 0,void 0,(function(){var n;return a(this,(function(o){switch(o.label){case 0:return n=e.body,[4,this.writePolyNodeData(n)];case 1:return o.sent(),t.json({}),[2]}}))}))},e.prototype.writePolyNodeData=function(e){return s(this,void 0,void 0,(function(){var t,n,o,r,i,s,c,u,h;return a(this,(function(a){return t=this._polyNodesRootFolder(),l.FsWrapped.existsSync(t)||l.FsWrapped.mkdirSync(t,{recursive:!0}),n=e.node_context,o=e.node_type,r=e.username,i=e.data,s=r?p.join(t,f,r):t,l.FsWrapped.existsSync(s)||l.FsWrapped.mkdirSync(s,{recursive:!0}),c=p.join(s,n),l.FsWrapped.existsSync(c)||l.FsWrapped.mkdirSync(c,{recursive:!0}),u=p.join(c,"".concat(o,".json")),h=JSON.stringify(i),h=d.PrettierController.formatJSON(h),l.FsWrapped.writeFileSync(u,h),[2]}))}))},e.prototype._polyNodesRootFolder=function(){var e=this.mainController.project_config.config().src_polygon_folder;return p.join(e,"polyNodes")},e.prototype._getFileVersion=function(e){var t=this._polyNodesRootFolder(),n=p.join(t,e);if(l.FsWrapped.existsSync(n))try{var o=l.FsWrapped.readFileSync(n,"utf-8"),r=JSON.parse(o).metadata;if(!r)return 1;var i=r.version;return i&&i.marketplace||1}catch(e){return}},e.prototype.marketplacePolyNodeInstalledVersion=function(e){var t=e.username,n=e.node_context,o=e.node_type;if(t){var r=p.join("marketplace",t,n,"".concat(o,".json"));return this._getFileVersion(r)}},e.prototype.sceneExportPolyNodesData=function(){var e=this.mainController.scene_config.validConfig();if(e){for(var t=[],n=0,o=e.poly_nodes;n<o.length;n++){var r=o[n].split("/"),i=r[0],s=r[1],a=this.fileContent(i,s);a||c.Logger.error("could not find file for polyNode '".concat(i,"/").concat(s,"'"));var l={node_context:i,node_type:s,data:a};t.push(l)}return t}},e}();t.PolyNodesController=h},9250:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.PrettierController=void 0;var r=n(5849),i=o(n(3920)),s=function(){function e(e){this.mainController=e}return e.formatHTML=function(e){try{return i.default.format(e,{parser:"html",printWidth:120,trailingComma:"es5",tabWidth:4,useTabs:!0,semi:!0,singleQuote:!0,bracketSpacing:!1,arrowParens:"always"})}catch(t){return r.Logger.warn("prettier failed to format the html file, leaving it unformatted"),console.log(t),e}},e.formatAny=function(e,t){try{return i.default.format(t,{filepath:e})}catch(e){return r.Logger.warn("prettier failed to format the javascript file, leaving it unformatted"),console.log(e),t}},e.formatJSON=function(e){try{return i.default.format(e,{parser:"json",printWidth:120,trailingComma:"es5",tabWidth:4,useTabs:!0,semi:!0,singleQuote:!0,bracketSpacing:!1,arrowParens:"always"})}catch(t){return r.Logger.warn("prettier failed to format the json file, leaving it unformatted"),console.log(t),e}},e}();t.PrettierController=s},9820:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.ProjectConfigController=t.DEFAULT_CONFIG=void 0;var s=n(2456),a=n(8949),l=i(n(1017)),c=n(5849),u=n(2822);t.DEFAULT_CONFIG={};var p=u.CurrentPathController.CURRENT_PATH,d=l.join(p,".polygonjs.json"),f=function(){function e(t){this.main_controller=t,this._config=e.default_config("default"),this.states=new a.States}return e.sceneFolders=function(){return{public:l.join(p,"public","polygonjs","scenes"),publicBackup:l.join(p,"public","polygonjs","backup","scenes"),src:l.join(p,"src","polygonjs","scenes")}},e.default_config=function(e){var t=this.sceneFolders();return{sceneName:e,project_root:p,polygonjs_engine_root:l.join(p,"node_modules","@polygonjs/polygonjs"),custom_panels_folder:l.join(p,"src","polygonjs","panels"),src_polygon_folder:l.join(p,"src","polygonjs"),src_scene_folder:l.join(t.src,e),public_root:l.join(p,"public"),public_scene_folder:l.join(t.public,e),public_scene_backup_folder:l.join(t.publicBackup,e),buildRoot:l.join(p,"build")}},e.prototype.isTypescript=function(){var e=l.join(p,"tsconfig.json");return s.FsWrapped.existsSync(e)},e.sanitizeSceneName=function(e){return e=(e=(e=e.replace(/\W+/g,"_")).replace(/^\d/g,"_")).toLowerCase()},e.prototype.resetWithSceneName=function(t){t&&(t=e.sanitizeSceneName(t)),this.load(t)},e.prototype.load=function(t){var n,o=this.read_local_config_file();o&&(n=o.imports),this._config=e.default_config(t||"default"),this._config.imports_type=n},e.prototype.read_local_config_file=function(){var e=d;if(!s.FsWrapped.existsSync(e))return{};try{return JSON.parse(s.FsWrapped.readFileSync(e,"utf-8"))}catch(e){return c.Logger.error("failed to read json file (".concat(e,")")),{}}},e.prototype.defaultAssetsFolder=function(){return"public"},e.prototype.binarySceneFilePath=function(){var e=this._config,t=e.sceneName,n=e.public_scene_folder;return l.join(n,"".concat(t,".poly"))},e.prototype.config=function(){return this._config},e}();t.ProjectConfigController=f},8320:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.PublicAssetsController=t.getFilePathTimestamp=void 0;var s=n(2456),a=n(5898),l=i(n(1017)),c=i(n(3685)),u=i(n(5687)),p=n(8010),d=n(5849),f=["png","jpg","jpeg","exr","hdr","ktx2"];function h(e){return e.split("/")}function _(e){return e.join("/")}function m(e,t){return t.slice(e.length,t.length)}function g(e){return"/"==e[0]?e.slice(1,e.length):e}function v(e){return e.startsWith("polygonjs/scenes/")||e.startsWith("polygonjs/backup/")||e.startsWith("polygonjs/build/")||e.startsWith("polygonjs/screenshots/")}function y(e){var t=e.remoteUrl,n=e.localPath,o=e.callback,r=t.startsWith("https://")?u:c,i=new URL(t);r.get(t,(function(e){if(e.statusCode===p.StatusCodes.OK){var t=s.FsWrapped.createWriteStream(n);if(!t)return;e.pipe(t),t.on("finish",(function(){t.close(),o()}))}else if(302===e.statusCode||301===e.statusCode){var r=e.headers.location;r&&(r.startsWith("https://")||r.startsWith("http://")||(r="".concat(i.origin).concat(r)),y({remoteUrl:r,localPath:n,callback:o}))}else d.Logger.error("Server responded with ".concat(e.statusCode,": ").concat(e.statusMessage))}))}function S(e){var t;return null===(t=s.FsWrapped.statSync(e))||void 0===t?void 0:t.mtime.getTime()}t.getFilePathTimestamp=S;var b=function(){function e(e){this.mainController=e}return e.prototype.index=function(e,t){var n=e.query,o={};if(n.extensionsJoined){var r=n.extensionsJoined;if("string"==typeof r){for(var i=r.split(","),s=this._assets(),c=a.FileHelper.getFilesFromDir("./".concat(s),i.map((function(e){return".".concat(e)}))).map((function(e){return l.join(s,e)})),u=c.filter((function(e){return!v(g(m(s,e)))})),p=[],f=0,h=u;f<h.length;f++){var _=h[f];try{var y=S(_);if(null!=y){var b={filePath:_,timestamp:y};p.push(b)}}catch(e){d.Logger.warn("failed to get file data from:'".concat(_,"'"))}}var A=p.map((function(e){return e.filePath=m(s,e.filePath),e.filePath=g(e.filePath),e.filePath=function(e){return e.replace(/\\/g,"/")}(e.filePath),e.filePath=function(e){return encodeURI(e)}(e.filePath),e})).sort((function(e,t){return e.filePath>t.filePath?1:0}));o.filesData=A,t.json(o)}else t.json(o)}else t.json(o)},e.prototype.download=function(e,t){var n=e.body.remoteUrl,o=n.split("/"),r=o[o.length-1].split("?")[0],i=r.split("."),a=i[i.length-1],c=f.includes(a)?"textures":"models",u=this.mainController.project_config.config(),p=l.join(u.public_root,c);s.FsWrapped.existsSync(p)||(d.Logger.log("creating folder ".concat(p)),s.FsWrapped.mkdirSync(p,{recursive:!0}));var h=l.join(p,r);d.Logger.log("downloading '".concat(n,"' -> '").concat(h,"'")),y({remoteUrl:n,localPath:h,callback:function(){var e,n=null===(e=s.FsWrapped.statSync(h))||void 0===e?void 0:e.mtime.getTime();if(null!=n){var o={localUrl:"".concat(c,"/").concat(r),timestamp:n};t.json(o),d.Logger.log("Download Completed: ".concat(h))}}})},e.prototype.show=function(e,t){var n=e.headers.referer,o=e.url,r=decodeURI(e.path);if(n&&!o.startsWith("/polygonjs/build/")){for(var i=h(new URL(n).pathname),s=h(r),a=h(o);i[0]==s[0];)i.shift(),s.shift(),a.shift();var l=_(a),c=_(s);d.Logger.log("asset redirect '".concat(r,"' -> '").concat(c,"' (referer: '").concat(n,"')")),o=l,r=c}this._readPublicAsset({requestedUrl:o,requestedPath:r,res:t})},e.prototype.favicon=function(e){e.json({})},e.prototype._readPublicAsset=function(e){var t=e.requestedUrl,n=e.requestedPath,o=e.res,r=this.mainController.project_config.config().project_root,i=this._assets()||"public",a=l.join(r,i,n);if(d.Logger.log("'".concat(a,"' exists? ").concat(s.FsWrapped.existsSync(a),": ").concat(s.FsWrapped.existsSync(a))),!s.FsWrapped.existsSync(a))return o.status(p.StatusCodes.UNPROCESSABLE_ENTITY),void o.json();var c=s.FsWrapped.statSync(a);if(!c)return o.status(p.StatusCodes.UNPROCESSABLE_ENTITY),void o.json();(c.isDirectory()&&(a=l.join(a,"index.html")),o.sendFile(a),c.isDirectory())||(v(g(m(i,a)))||this.mainController.filesWatch.watchFile({fullFilePath:a,requestedUrl:t}))},e.prototype._assets=function(){return this.mainController.project_config.read_local_config_file().assets||this.mainController.project_config.defaultAssetsFolder()},e}();t.PublicAssetsController=b},3405:(e,t,n)=>{t.__esModule=!0,t.SceneConfigController=void 0;var o=n(8949),r=function(){function e(e){this.main_controller=e,this.states=new o.States}return e.prototype.setTmpConfig=function(e){this._tmpConfig=e,this._checkConfigValid()},e.prototype.tmpConfig=function(){return this._tmpConfig},e.prototype.validConfig=function(){return this._validConfig},e.prototype._checkConfigValid=function(){this.states.error.reset();var e=this._tmpConfigError();e?this.states.error.setMessage(e):this._validConfig=this._tmpConfig},e.prototype._tmpConfigError=function(){if(!this._tmpConfig)return"no tmp config";var e=this._tmpConfig;return e?e.engine_version?e.name?e.nodes?e.modules?e.assemblers?e.integrations?e.code?e.nodes_map?e.layout_data?e.assets?null==e.libsRoot?"no libsRoot":null==e.assetsRoot?"no assetsRoot":e.scenePropTypes?void 0:"no scenePropTypes":"no assets":"no layout_data":"no nodes_map":"no code":"no integrations":"no assemblers":"no modules":"no nodes":"no name":"no engine_version":"no scene_data"},e}();t.SceneConfigController=r},4239:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.SceneLoaderController=void 0;var l=n(2456),c=n(7301),u=n(6231),p=n(2992),d=n(5849),f=n(7633),h=n(5114),_=n(7381),m=n(9820),g=i(n(1017)),v=function(){function e(e){this.mainController=e}return e.prototype.sceneNames=function(){var e,t=m.ProjectConfigController.sceneFolders();function n(e){var t;return null===(t=l.FsWrapped.lstatSync(e))||void 0===t?void 0:t.isDirectory()}try{return(e=t.public,l.FsWrapped.existsSync(e)?l.FsWrapped.readdirSync(e).map((function(t){return g.join(e,t)})).filter(n):[]).map((function(e){return g.basename(e)})).sort()}catch(e){return[]}},e.prototype.index=function(e,t){var n={error:void 0,scenes:this.sceneNames()};t.json(n)},e.prototype.load=function(e,t){return s(this,void 0,void 0,(function(){var n,o,r,i,s,l,c,u;return a(this,(function(a){switch(a.label){case 0:return n=e.query,o=n.scene,this.mainController.project_config.resetWithSceneName(o),[4,this._getData(o)];case 1:if((r=a.sent()).error)i={error:r.error,scene:{code:h.code,editor:_.editor}},t.json(i),d.Logger.log(r.error);else{if(this.mainController.multiPlayer.sessions.started()&&null==(s=this.mainController.multiPlayer.sceneData.getSceneData(o)).error){for(l=0,c=["root","ui","properties"];l<c.length;l++)null!=s[u=c[l]]&&(r[u]=s[u]);r.multiplayer=!0}t.json(r)}return[2]}}))}))},e.prototype._getData=function(e){return s(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return this.mainController.project_config.resetWithSceneName(e),t=this.mainController.project_config.binarySceneFilePath(),l.FsWrapped.existsSync(t)?[4,this._getDataBinary(e)]:[3,2];case 1:return[2,n.sent()];case 2:return[2,this._getDataJSON(e)]}}))}))},e.prototype._getDataBinary=function(e){return s(this,void 0,void 0,(function(){var t,n;return a(this,(function(o){switch(o.label){case 0:return this.mainController.project_config.resetWithSceneName(e),t=this.mainController.project_config.binarySceneFilePath(),[4,c.BinaryController.read({filePath:t})];case 1:return n=o.sent(),[2,{fileDataURL:n,multiplayer:!1}]}}))}))},e.prototype._getDataJSON=function(e){this.mainController.project_config.resetWithSceneName(e),this.mainController.manifest.load();var t=this.mainController.manifest.content();if(!t)return{error:u.ResponseMessageFromLocalServer.NO_MANIFEST};var n=this.mainController.file_reader,o=n.readJSON(f.OutFileName.EDITOR_DATA,p.JsonDestFolder.PUBLIC)||{};if(!o)return{error:u.ResponseMessageFromLocalServer.NO_EDITOR};var r=n.readJSON(f.OutFileName.ROOT,p.JsonDestFolder.PUBLIC),i=n.readJSON(f.OutFileName.UI,p.JsonDestFolder.PUBLIC),s=n.readJSON(f.OutFileName.PROPERTIES,p.JsonDestFolder.PUBLIC);if(!(r&&i&&s))return{error:"missing file root, ui or properties file"};for(var a={},l=Object.keys(t.nodes||{}),c=0;c<l.length;c++){var d=l[c],h=n.readJSON("/root/".concat(d),p.JsonDestFolder.PUBLIC);if(!h)return{error:"missing file (".concat(d,")")};a[d]=h}return{manifest:t,editor_data:o,root:r,properties:s,ui:i,jsons_by_name:a}},e}();t.SceneLoaderController=v},3174:function(e,t,n){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.SceneSaverController=void 0;var c=n(2456),u=n(8010),p=n(5849),d=n(8949),f=n(2691),h=n(4594),_=s(n(1017)),m=s(n(6517)),g=n(4413),v=(n(8877),n(8479)),y=n(7301),S=function(){function e(e){this.mainController=e,this.npm=new f.SceneNpmSaverController(this),this.saveOptions=new h.SceneSaveOptionsController(this),this.timestamps=new g.TimestampController(this),this.states=new d.States,this._saveInProgress=!1}return e.prototype.updateName=function(e,t){return a(this,void 0,void 0,(function(){var n,o,r,i,s,a,u,p,d,f,h,m,g,v;return l(this,(function(l){n=e.body,o=n.originalSceneName,r=n.newSceneName,i={error:void 0,updatedSceneName:r};try{for(this._setProjectConfig(o),s=this.mainController.project_config.config(),a=s.src_scene_folder,u=s.public_scene_folder,p=this.mainController.capture.fullFolderStaticCaptures(),d=this.mainController.capture.fullFolderRenders(),f=0,h=[a,u,p,d];f<h.length;f++)m=h[f],g=_.dirname(m),v=_.join(g,r),c.FsWrapped.existsSync(m)&&c.FsWrapped.renameSync(m,v)}catch(e){i.error=e.message}return t.json(i),[2]}))}))},e.prototype.delete=function(e,t){return a(this,void 0,void 0,(function(){var n,o,r,i,s,a,u,p,d,f,h;return l(this,(function(l){n=e.body,o=n.sceneName,r={error:void 0};try{for(this._setProjectConfig(o),i=this.mainController.project_config.config(),s=i.src_scene_folder,a=i.public_scene_folder,u=this.mainController.capture.fullFolderStaticCaptures(),p=this.mainController.capture.fullFolderRenders(),d=0,f=[s,a,u,p];d<f.length;d++)h=f[d],c.FsWrapped.existsSync(h)&&c.FsWrapped.rmdirSync(h,{recursive:!0})}catch(e){r.error=e.message}return t.json(r),[2]}))}))},e.prototype.save=function(e,t){return a(this,void 0,void 0,(function(){var n,o,r,i=this;return l(this,(function(s){return this.mainController.status.setStatus("saving..."),this._saveInProgress?(p.Logger.error("save already in progress"),[2]):(n=1==e.body.binary,o=function(){return a(i,void 0,void 0,(function(){var n,o,r;return l(this,(function(i){switch(i.label){case 0:n=e.body.scene_config,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.saveSceneConfig(n)];case 2:return i.sent(),(o=this.states.error.message())?(p.Logger.error(o),t.status(u.StatusCodes.UNAUTHORIZED),t.json({error:o})):t.json({}),[3,4];case 3:return r=i.sent(),console.log(r),p.Logger.error(r instanceof Error?r.message:"error"),t.status(u.StatusCodes.INTERNAL_SERVER_ERROR),t.json({error:r,message:r.message}),[3,4];case 4:return this._endSavingProcess(),[2]}}))}))},r=function(){return a(i,void 0,void 0,(function(){var n,o,r;return l(this,(function(i){switch(i.label){case 0:n=e.body.fileDataURL,o=e.body.sceneName,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._saveSceneDataBinary(n,o)];case 2:return i.sent(),t.json({}),[3,4];case 3:return r=i.sent(),p.Logger.error(r instanceof Error?r.message:"error"),t.status(u.StatusCodes.INTERNAL_SERVER_ERROR),t.json({error:r,message:r.message}),[3,4];case 4:return this._endSavingProcess(),[2]}}))}))},this._saveInProgress=!0,n?r():o(),[2])}))}))},e.prototype.saveSceneConfig=function(e){return a(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return this.mainController.status.setStatus("saving..."),this._setProjectConfig(e.name),[4,this._saveSceneData(e)];case 1:return t.sent(),[2]}}))}))},e.prototype._setProjectConfig=function(e){e&&this.mainController.project_config.load(e),this.mainController.project_config.resetWithSceneName(e||"default")},e.prototype._endSavingProcess=function(){this._saveInProgress=!1},e.prototype._saveSceneData=function(e){return a(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return this._ensureConfigValid(e)?[4,this._callMainExporterController()]:[2];case 1:return t.sent(),[2]}}))}))},e.prototype._clearSceneDataBinary=function(e){var t=this.mainController.project_config.binarySceneFilePath();c.FsWrapped.existsSync(t)&&(p.Logger.log("deleting file ".concat(t)),c.FsWrapped.removeSync(t),p.Logger.log("file ".concat(t," deleted")))},e.prototype._saveSceneDataBinary=function(e,t){return a(this,void 0,void 0,(function(){var n,o;return l(this,(function(r){return this.mainController.scene_config.setTmpConfig({name:t}),this.npm.clearAutogeneratedFolder(),this.mainController.file_writer.clear_scene_data(),n=this.mainController.project_config.binarySceneFilePath(),o=_.dirname(n),c.FsWrapped.existsSync(o)||c.FsWrapped.mkdirSync(o,{recursive:!0}),y.BinaryController.write({filePath:n,fileDataURL:e}),p.Logger.log("saved '".concat(n,"'")),[2]}))}))},e.prototype._ensureConfigValid=function(e){return this.states.error.reset(),this.mainController.scene_config.setTmpConfig(e),this.mainController.scene_config.states.error.errored()?(this.states.error.setMessage("SceneSaverController: config is invalid: ".concat(this.mainController.scene_config.states.error.message())),!1):(this.timestamps.init(),!0)},e.prototype._callMainExporterController=function(){return a(this,void 0,void 0,(function(){var e,t,n,o,r,i,s,a;return l(this,(function(l){switch(l.label){case 0:return(e=this.mainController.scene_config.validConfig())?(t=this.mainController.project_config.config(),n={scene:e,project:t},o=new v.MainExporterController(n),(r=o.run())?(i=r.error,s=r.register,a=r.scene_node_types,i?(console.error(i),[2]):[4,this._save_scene_data({register:s,scene_node_types:a})]):(console.error("failed to save scene"),[2])):(console.error("failed to save scene"),[2]);case 1:return l.sent(),this._clearSceneDataBinary(e.name),[2]}}))}))},e.prototype._save_scene_data=function(e){return a(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return[4,this.npm.saveCommon()];case 1:return t.sent(),this.npm.saveDetails(e),[2]}}))}))},e.prototype.replaceVariables=function(e,t){void 0===t&&(t={});var n=this.mainController.project_config.config().sceneName,r=this.mainController.scene_config.validConfig();if(!r)return e;var i=r.libsRoot,s=r.assetsRoot,a=r.modules,l="[".concat(a.map((function(e){return'"'.concat(e,'"')})).join(", "),"]"),c=this.timestamps.timestampQueryParam(),u=this.mainController.polyNodes.sceneExportPolyNodesData(),p=JSON.stringify(u||[]);return m.template(e)(o({sceneName:n,libsRoot:i,assetsRoot:s,moduleNamesStr:l,timestampQueryParam:c,polyNodesData:p,displayLogoFunctionCall:""},t))},e}();t.SceneSaverController=S},7099:(e,t,n)=>{t.__esModule=!0,t.ServerVersionController=void 0;var o=n(4147).i8,r=function(){function e(){}return e.version=function(){return o},e}();t.ServerVersionController=r},290:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},l=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.ShareController=void 0;var u=n(2456),p=n(5849),d=n(5898),f=n(7129),h=n(8010),_=n(4859),m=n(3970),g=c(n(4809)),v=n(8941),y=i(n(1017)),S=n(4302),b=n(4783),A=function(){function e(e){this.mainController=e}return e.prototype.createZip=function(e,t){var n;return s(this,void 0,void 0,(function(){var o,r,i,s,l,c,p,d,f;return a(this,(function(a){switch(a.label){case 0:for(p in o=e.body,r=o.name,i=this.mainController.project_config.config(),s=i.project_root,l=new C(this.mainController,r),c=u.FsWrapped.readdirSync(s))d=c[p],f=y.join(s,d),(null===(n=u.FsWrapped.statSync(f))||void 0===n?void 0:n.isFile())?l.addFilePath(f):"node_modules"!=d&&l.addDirectory(f);return[4,l.createZip()];case 1:return a.sent(),t.json({url:l.zipFilePathShortElements().join("/")}),[2]}}))}))},e.prototype.uploadScene=function(e,t){return s(this,void 0,void 0,(function(){var n,o,r,i,s,l;return a(this,(function(a){switch(a.label){case 0:n=e.body,o=n.secret,r=_.RemoteApiController.sceneCreate(),(i=new v).append("scene[name]",n.name),i.append("scene[code]",n.code),i.append("scene[code_editor]",n.code_editor),i.append("scene[js_version]",n.js_version),a.label=1;case 1:return a.trys.push([1,4,,5]),[4,this._postRequest(r,i,o)];case 2:return(s=a.sent())?[4,s.json()]:[2,t.json({error:"failed to fetch server"})];case 3:return l=a.sent(),s.status==h.StatusCodes.OK?t.json(l):t.json({error:"failed to create scene"}),[3,5];case 4:return a.sent(),t.json({error:"failed to create scene"}),[3,5];case 5:return[2]}}))}))},e.prototype._postRequest=function(e,t,n){return s(this,void 0,void 0,(function(){var o,r;return a(this,(function(i){switch(i.label){case 0:return[4,m.SystemController.hardware_id()];case 1:return o=i.sent(),r=m.SystemController.hostname(),t.append("secret",n),t.append("token[hardware_id]",o),t.append("token[hostname]",r),[4,(0,g.default)(e,{method:"POST",body:t})];case 2:return[2,i.sent()]}}))}))},e}();t.ShareController=A;var C=function(){function e(e,t){this.mainController=e,this._fileName=t,this._filesToZip=new Set,this._fileContents=new Set}return e.prototype.zipped=function(){return this._zipped},e.prototype.start=function(){this._filesToZip.clear(),this._fileContents.clear()},e.prototype.addFilePath=function(e){var t=decodeURI(e);if(u.FsWrapped.existsSync(t)){var n=f.UrlHelper.sanitize(t);this._filesToZip.add(n)}else p.Logger.warn("file not found on disk: ".concat(t))},e.prototype.addDirectory=function(e){for(var t=0,n=d.FileHelper.getFilesFromDir(e);t<n.length;t++){var o=n[t];this.addFilePath(y.join(e,o))}},e.prototype.createZip=function(){return s(this,void 0,void 0,(function(){var e,t,n,o,r,i,s,l,c,d,f,h,_,m,g,v;return a(this,(function(a){switch(a.label){case 0:for(e={},t=this.mainController.project_config.config(),n=t.project_root,o=[],this._filesToZip.forEach((function(e){o.push(e)})),r=0,i=o;r<i.length;r++)s=i[r],"/"==(l=s.replace(n,""))[0]&&(l=l.slice(1,l.length)),e[l]=u.FsWrapped.readFileSync(s);c=[],this._fileContents.forEach((function(e){c.push(e)})),d=0,f=c,a.label=1;case 1:return d<f.length?(h=f[d],_=e,m=h.path,[4,(0,b.stringToUint8Array)(h.content)]):[3,4];case 2:_[m]=a.sent(),a.label=3;case 3:return d++,[3,1];case 4:return this._zipped=(0,S.zipSync)(e),g=this.zipFilePath(),v=y.dirname(g),u.FsWrapped.existsSync(v)||u.FsWrapped.mkdirSync(v,{recursive:!0}),u.FsWrapped.writeFileSync(g,this._zipped),p.Logger.log("written zip archive: ".concat(g)),[2]}}))}))},e.prototype.zipFilePath=function(){var e=this.mainController.project_config.config().public_root,t=this.zipFilePathShortElements();return y.join.apply(y,l([e],t,!1))},e.prototype.zipFilePathShortElements=function(){var e=this._fileName;return["polygonjs","build",e,"".concat(e,"_full_project_src.zip")]},e}()},4401:(e,t,n)=>{t.__esModule=!0,t.SocketIOController=void 0;var o=n(5849),r=n(6231),i=n(3952),s=function(){function e(e){this.mainController=e,this._sockets=[]}return e.prototype.setInitData=function(e){this._initData=e},e.prototype.setTunnelUrl=function(e){this._tunnelUrl=e,this.start()},e.prototype.start=function(){var e=this;if(this._initData){this._io&&(this._initData.server.close(),this._io.close(),this._initData.server=this._initData.express.listen(this._initData.port));var t=["http://localhost:5000","http://localhost:".concat(this._initData.port)];this._tunnelUrl&&t.push(this._tunnelUrl),this._io=new i.Server(this._initData.server,{cors:{origin:t}}),this._io.on("connection",(function(t){e._sockets.push(t),t.on("disconnect",(function(n){var o=e._sockets.indexOf(t);e._sockets.splice(o,1)}))}))}else o.Logger.error("socket has no server to start from")},e.prototype.emitFileChanged=function(e){for(var t=0,n=this._sockets;t<n.length;t++){n[t].emit(r.SocketEvent.FILE_CHANGED,e)}},e.prototype.emitAuthSessionDestroyed=function(e){for(var t=0,n=this._sockets;t<n.length;t++){n[t].emit(r.SocketEvent.AUTH_SESSION_DESTROYED,e)}},e.prototype.emitMultiplayerSessionDestroyed=function(e){for(var t=0,n=this._sockets;t<n.length;t++){n[t].emit(r.SocketEvent.MULTIPLAYER_SESSION_DESTROYED,e)}},e.prototype.emitMultiplayerUsersUpdated=function(){if(this.mainController.multiPlayer.started())for(var e={users:this.mainController.multiPlayer.users.users(),requests:this.mainController.multiPlayer.userRequests.requests()},t=0,n=this._sockets;t<n.length;t++){n[t].emit(r.SocketEvent.MULTIPLAYER_USERS_UPDATED,e)}},e.prototype.emitAwarenessUpdated=function(e){for(var t=0,n=this._sockets;t<n.length;t++){n[t].emit(r.SocketEvent.MULTIPLAYER_AWARENESS_UPDATED,e)}},e.prototype.emitMultiplayerCommandConfirmed=function(e){for(var t=0,n=this._sockets;t<n.length;t++){n[t].emit(r.SocketEvent.MULTIPLAYER_COMMAND_CONFIRMED,e)}},e.prototype.emitMultiplayerUndoConfirmed=function(e){for(var t=0,n=this._sockets;t<n.length;t++){n[t].emit(r.SocketEvent.MULTIPLAYER_UNDO_CONFIRMED,e)}},e.prototype.emitMultiplayerRedoConfirmed=function(e){for(var t=0,n=this._sockets;t<n.length;t++){n[t].emit(r.SocketEvent.MULTIPLAYER_REDO_CONFIRMED,e)}},e}();t.SocketIOController=s},7762:(e,t,n)=>{t.__esModule=!0,t.StatusController=void 0;var o=n(5849),r=function(){function e(e){this.mainController=e,this._status="waiting..."}return e.prototype.setStatus=function(e){this._status!=e&&(o.Logger.log("setStatus: '".concat(e,"'")),this._status=e)},e.prototype.status=function(){return this._status},e.prototype.processStatusRequest=function(e,t){var n=this._status;o.Logger.log("respond with status: '".concat(n,"'"));var r={status:n};t.json(r)},e}();t.StatusController=r},6356:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.TestsController=void 0;var i=n(5849),s=n(9199),a=function(){function e(e){this.mainController=e}return e.prototype.testSave=function(){return o(this,void 0,void 0,(function(){var e,t;return r(this,(function(n){switch(n.label){case 0:return i.Logger.log("-------------- TEST START ---------------"),e=s,[4,this.mainController.sceneSaver.saveSceneConfig(e)];case 1:return n.sent(),(t=this.mainController.sceneSaver.states.error.message())?i.Logger.error("ERROR: ".concat(t)):i.Logger.log("SAVE OK"),[2]}}))}))},e}();t.TestsController=a},8846:(e,t,n)=>{t.__esModule=!0,t.BundleController=void 0;var o=n(4576),r=n(935),i=function(e){this.mainController=e,this.esbuild=new o.EsBuildController(e,this),this.webpack=new r.WebpackController(e,this)};t.BundleController=i},9938:(e,t)=>{t.__esModule=!0,t.BaseBundleController=void 0;var n=function(e,t){this.mainController=e,this.bundleController=t};t.BaseBundleController=n},4576:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},i.apply(this,arguments)},s=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return a(t,e),t},c=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},u=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.EsBuildController=void 0;var p=n(2456),d=l(n(1017)),f=n(9659),h=n(6629),_=n(5205),m=n(5849),g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._compilationId=0,t}return r(t,e),t.prototype.build=function(e,t){return c(this,void 0,void 0,(function(){var n,o,r,s,a;return u(this,(function(l){switch(l.label){case 0:return n=this._compilationId++,m.Logger.log("esbuild START ".concat(n)),o=this.mainController.project_config.config().project_root,r=d.join(o,"entry.".concat(Math.random(),".ts")),s=d.join(o,"out.".concat(Math.random(),".js")),p.FsWrapped.writeFileSync(r,e),m.Logger.log("writing to ' ".concat(r," '")),[4,(0,f.build)(i(i({entryPoints:[r],bundle:!0,minify:t.minify,outfile:s,format:"esm"},h.EsbuildOptions),{plugins:[_.threeImportMapsOnResolve]}))];case 1:return l.sent(),a=p.FsWrapped.readFileSync(s,"utf-8"),p.FsWrapped.existsSync(r)&&p.FsWrapped.unlinkSync(r),p.FsWrapped.existsSync(s)&&p.FsWrapped.unlinkSync(s),m.Logger.log("esbuild END ".concat(n)),[2,a]}}))}))},t.prototype.buildSTDIN=function(e,t){return c(this,void 0,void 0,(function(){var n,o,r;return u(this,(function(s){switch(s.label){case 0:return n=this._compilationId++,m.Logger.log("esbuild START ".concat(n)),[4,(0,f.build)(i(i({stdin:{contents:e},bundle:!0,minify:t.minify,write:!1,format:"esm"},h.EsbuildOptions),{plugins:[_.threeImportMapsOnResolve]}))];case 1:return o=s.sent(),m.Logger.log("esbuild END ".concat(n)),o.outputFiles?(r=o.outputFiles[0].contents,[2,(new TextDecoder).decode(r)]):[2]}}))}))},t}(n(9938).BaseBundleController);t.EsBuildController=g},935:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t},l=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.WebpackController=void 0;var u=n(2456),p=n(5898),d=n(5849),f=n(9938),h=n(5056),_=a(n(1017)),m=n(9354),g=n(6380),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.build=function(e){return l(this,void 0,void 0,(function(){var t,n,o,r,i,s,a,l,f,v,y,S,b,A,C,w;return c(this,(function(c){switch(c.label){case 0:return t=e.entryPoints,n=e.outdir,o=e.publicPath,r=_.resolve(__dirname,"../"),i={contextPath:r,entryPoints:t,outdir:n,publicPath:o},s=(0,h.createConfig)(i),a=(0,m.webpack)(s),[4,this._runCompiler(a)];case 1:if(l=c.sent(),f=l.res,v=l.err,f&&f.hasErrors())throw console.log(f.compilation.errors),new Error(g.ExportError.ESBUILD_FAIL);if(v)throw d.Logger.error("webpack error:"),console.log(v),new Error(g.ExportError.ESBUILD_FAIL);for(y=p.FileHelper.getFilesFromDir(n,[".mjs",".js.mjs"]),S=0,b=y;S<b.length;S++)A=b[S],C=_.join(n,A),w=C.replace(/\.js\.mjs/,".js").replace(/\.mjs/,".js"),u.FsWrapped.renameSync(C,w);return d.Logger.log("webpack compilation successful"),[2]}}))}))},t.prototype._runCompiler=function(e){return new Promise((function(t,n){e.run((function(e,n){t({err:e,res:n})}))}))},t}(f.BaseBundleController);t.WebpackController=v},5056:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.createConfig=void 0;var s=i(n(1017)),a=n(1580),l=n(6191);var c=n(591),u=n(9354).optimize.AggressiveMergingPlugin;t.createConfig=function(e){for(var t=e.entryPoints,o=e.outdir,r=e.contextPath,i=e.publicPath,p={},d=0,f=t;d<f.length;d++){var h=f[d];p[s.basename(h)]=h}var _=function(){try{return n(7166)}catch(e){return null}}();return{mode:"production",devtool:!1,experiments:{outputModule:!0,asyncWebAssembly:!0},context:r,entry:p,plugins:[new u,new c({test:/\.(js)$/}),new c({filename:"[file].br",algorithm:"brotliCompress",test:/\.(js|css|html|svg)$/,compressionOptions:{level:11},threshold:10240,minRatio:.8})],output:{clean:!0,path:o,publicPath:i,library:{type:"module"}},resolve:{extensions:[".ts",".js"],fallback:{fs:!1}},module:{rules:[(0,l.ts)(true),a.glsl]},optimization:{splitChunks:{cacheGroups:{defaultVendors:{filename:"[name].polygonjs-bundle.js"}}},minimize:true,minimizer:_?[new _({extractComments:!0,parallel:!0})]:[]}}}},1580:(e,t)=>{t.__esModule=!0,t.glsl=void 0,t.glsl={test:/\.glsl$/,use:[{loader:"ts-shader-loader"}]}},6191:(e,t)=>{t.__esModule=!0,t.ts=void 0;t.ts=function(e){return{test:/\.ts?$/,exclude:/node_modules/,use:[{loader:"ts-loader",options:{transpileOnly:e}}]}}},8186:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.PostExportCommandController=void 0;var i=n(5849),s=n(2081),a=function(){function e(e,t){this.mainController=e,this.exportController=t}return e.prototype.run=function(e){return o(this,void 0,void 0,(function(){var t;return r(this,(function(n){return t=e.command,i.Logger.log("========= running post export command =========="),i.Logger.log("START command: '".concat(t,"'")),[2,new Promise((function(e){var n,o,r=(0,s.exec)(t);null===(n=r.stdout)||void 0===n||n.on("data",(function(e){i.Logger.log("stdout: ".concat(e))})),null===(o=r.stderr)||void 0===o||o.on("data",(function(e){i.Logger.log("stderr: ".concat(e))})),r.on("exit",(function(n){0==n?i.Logger.log("COMPLETED command: '".concat(t,"'")):i.Logger.log("ERROR command: '".concat(t,"'")),e()}))}))]}))}))},e}();t.PostExportCommandController=a},6380:function(e,t,n){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},c=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};t.__esModule=!0,t.SceneExportController=t.ExportError=void 0;var u,p,d=n(2456),f=n(8186),h=s(n(1017)),_=n(9659),m=n(6629),g=n(7633),v=n(5849),y=n(9795),S=n(8708),b=s(n(6517)),A=n(7129),C=n(9250),w=n(6231),E=n(5898),P=n(4611),O=n(4425),j=n(5205),x=n(7249),T=n(4249);!function(e){e.ESBUILD_FAIL="esbuild fail"}(u=t.ExportError||(t.ExportError={})),function(e){e.INDEX="index",e.FETCH_SCENE_AND_MOUNT="fetchSceneAndMount",e.CREATE_SCENE_AND_MOUNT="createSceneAndMount",e.CREATE_SCENE_AND_MOUNT_NO_CHUNK="createSceneAndMountNoChunk",e.LOAD_SCENE_DATA="loadSceneData",e.LOAD_SCENE_FROM_SCENE_DATA="loadSceneFromSceneData",e.LOAD_SCENE="loadScene"}(p||(p={}));var L=function(){function e(e){this.mainController=e,this.finalZipHandler=new O.FinalZipHandler(this),this.postExportCommand=new f.PostExportCommandController(e,this)}return e.prototype.create=function(e,t){return a(this,void 0,void 0,(function(){var e,n,o,r;return l(this,(function(i){switch(i.label){case 0:v.Logger.log("export start"),this.mainController.status.setStatus("export start"),e=this.mainController.project_config.config().sceneName,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.createWithArgs(e)];case 2:return i.sent(),this.mainController.status.setStatus("export completed"),t.json({}),[3,4];case 3:return n=i.sent(),v.Logger.error("export failed"),o=n.message,v.Logger.error(o),o===u.ESBUILD_FAIL?(r={warning:w.ResponseMessageFromLocalServer.NO_NODE_MODULES},[2,t.json(r)]):(t.json({error:"export failed",message:"".concat(o)}),[2]);case 4:return[2]}}))}))},e.prototype.createWithArgs=function(e){return a(this,void 0,void 0,(function(){var t,n,o,r,i,s,a,c,u,p;return l(this,(function(l){switch(l.label){case 0:return this.finalZipHandler.start(),this.mainController.project_config.resetWithSceneName(e),t=this.mainController.project_config.config(),n=t.public_root,o=h.join("polygonjs","js",e),r=h.join(n,o),d.FsWrapped.existsSync(r)||d.FsWrapped.mkdirSync(r,{recursive:!0}),i=new S.EditorApi,s={api:i,sceneName:e},[4,this._prepareEditorApi(s)];case 1:return l.sent(),a=this.finalZipHandler.publicBuildFolder(),c=i.export.postExportCommand({sceneName:e,exportFolder:a}),u="polygonjs/js/".concat(t.sceneName,"/"),p=c?A.UrlHelper.sanitize("".concat(c.publicPath,"/").concat(u)):"./".concat(u),[4,this._compileLoadSceneJs({outLoadSceneJsFolder:r,editorApi:i,publicRelativeFolder:o,publicPath:p})];case 2:return l.sent(),this._preloadManifestEntries(e,i),[4,this._compileIndexHTML(s)];case 3:return l.sent(),[2]}}))}))},e.prototype._prepareEditorApi=function(e){var t;return a(this,void 0,void 0,(function(){var n,o,r,i,s,a,c,u,p,d,f,h,_,m,g,v,y,S,b,C;return l(this,(function(l){switch(l.label){case 0:return n=e.api,o=e.sceneName,r=n,[4,this.evalConfigureEditor(e)];case 1:for(l.sent(),i=r.html.viewer.progressBar()||new x.ProgressBarTop,s="./".concat(this.mainController.capture.staticPublicFilePath()),a=i.templates({CSS:{posterUrl:s},HTML:{},JS:{}}),c=this._loadSceneJsContent(r,o,a),r.html.head.addScript({id:"load-scene-".concat(o),type:"module",content:c}),a&&(r.html.head.addStylesheet({id:"polygonjs-progress-bar-stylesheet",content:a.CSS}),r.html.body.addTag("loader",{id:"polygonjs-progress-bar-loader",content:a.HTML})),u=r.html.head.title(),p=r.html.head.description(),d=r.html.head.siteUrl(),f=r.html.head.twitter(),r.html.head.addMetaTag('<meta property="og:title" content="'.concat(u,'">')),r.html.head.addMetaTag('<meta property="og:type" content="website" />'),r.html.head.addMetaTag('<meta property="og:image" content="'.concat(s,'">')),r.html.head.addMetaTag('<meta property="og:url" content="'.concat(d,'">')),r.html.head.addMetaTag('<meta name="twitter:card" content="summary_large_image">'),r.html.head.addMetaTag('<meta property="og:description" content="'.concat(p,'">')),r.html.head.addMetaTag('<meta property="og:site_name" content="'.concat(p,'">')),r.html.head.addMetaTag('<meta name="twitter:image:alt" content="'.concat(p,'">')),r.html.head.addMetaTag('<meta name="twitter:site" content="'.concat(f,'">')),r.html.head.addPreloadUrl(s),h=this._assetsManifestContent(),_=this.mainController.scene_config,m=null===(t=_.validConfig())||void 0===t?void 0:t.libsRoot,g=0,v=h;g<v.length;g++)C=v[g],C=A.UrlHelper.sanitize(C),y={crossorigin:!0},m&&C.includes(m)&&(y.as="fetch"),r.html.head.addPreloadUrl(C,y);for(this.finalZipHandler.addPublicUrl(s),S=0,b=h;S<b.length;S++)C=b[S],this.finalZipHandler.addPublicUrl(C),this.mainController.status.setStatus("addPublicUrl '".concat(C,"'"));return[2,r]}}))}))},e.prototype._assetsManifestContent=function(){var e=this.mainController.project_config.config().src_scene_folder,t=h.join(e,"".concat(g.OutFileName.MANIFEST_ASSETS,".json")),n=d.FsWrapped.readFileSync(t,"utf-8");return JSON.parse(n)},e.prototype._preloadManifestEntries=function(e,t){var n=this.mainController.project_config.config(),o=n.src_scene_folder,r=h.join(o,"".concat(g.OutFileName.MANIFEST,".json")),i=d.FsWrapped.readFileSync(r,"utf-8"),s=JSON.parse(i),a={crossorigin:!0},l=h.join("polygonjs","scenes",e),c=h.join(l,"root.json");t.html.head.addPreloadUrl("".concat(c,"?t=").concat(s.root),a);var u=h.join(l,"properties.json");t.html.head.addPreloadUrl("".concat(u,"?t=").concat(s.properties),a),function(){for(var e=0,n=Object.keys(s.nodes);e<n.length;e++){var o=n[e],r=s.nodes[o],i=h.join(l,"root","".concat(o,".json"));t.html.head.addPreloadUrl("".concat(i,"?t=").concat(r),a)}}(),function(){for(var e=s.shaders,n=0,o=Object.keys(e);n<o.length;n++)for(var r=o[n],i=e[r],c=0,u=Object.keys(i);c<u.length;c++){var p=u[c],d=i[p],f=h.join(l,"root",(0,T.shaderUrl)({nodePath:r,shaderName:p}));t.html.head.addPreloadUrl("".concat(f,"?t=").concat(d),a)}}(),this.mainController.sceneSaver.saveOptions.minimizeFilesCount()||(this.finalZipHandler.addPublicUrl(c),this.finalZipHandler.addPublicUrl(u),this.finalZipHandler.addDirectory(h.join(n.public_root,l,"root")),this.mainController.status.setStatus("addDirectory '".concat(h.join(n.public_root,l,"root"),"'")))},e.prototype.entryPointName=function(){return this.mainController.sceneSaver.saveOptions.minimizeFilesCount()?[p.CREATE_SCENE_AND_MOUNT,p.CREATE_SCENE_AND_MOUNT_NO_CHUNK][0]:p.FETCH_SCENE_AND_MOUNT},e.prototype._loadSceneJsContent=function(e,t,n){var o="updateProgressBar",r=n.JS.replace("export ","const ".concat(o," = ")),i="\n\t\t".concat(r,"\n\t\tfunction onProgress(progress){\n\t\t\tif(window.POLY && window.POLY.onLoadingProgress_").concat(t,"){\n\t\t\t\twindow.POLY.onLoadingProgress_").concat(t,"(progress);\n\t\t\t}\n\t\t\t").concat(o,"(progress);\n\t\t}\n\t\t"),s=e.html.body.polygonjsId(t),a="loadSceneAndMount_".concat(t);return"\n\t\timport {".concat(a,"} from './polygonjs/js/").concat(t,"/index.js';\n\t\t").concat(i,"\n\t\tdocument.addEventListener('DOMContentLoaded', async () => {\n\t\t\tconst domElement = document.getElementById('").concat(s,"');\n\t\t\tif(!domElement){\n\t\t\t\tconsole.error(\"element '").concat(s,"' not found\");\n\t\t\t\treturn\n\t\t\t}\n\t\t\tconst loadedData = await ").concat(a,"({\n\t\t\t\tautoPlay: <%= autoPlay %>,\n\t\t\t\tonProgress,\n\t\t\t\tdomElement,\n\t\t\t\tpublicPath: './'\n\t\t\t});\n\t\t\tif(window.POLY && window.POLY.onSceneReady_").concat(t,"){\n\t\t\t\twindow.POLY.onSceneReady_").concat(t,"(loadedData);\n\t\t\t}\n\t\t});\n\t\t")},e.prototype._moduleNames=function(){var e=this.mainController.sceneSaver.npm.modulesFolder();if(!e)return v.Logger.log("modules folder not found (".concat(e,")")),[];if(!d.FsWrapped.existsSync(e))return[];var t=d.FsWrapped.readdirSync(e);return v.Logger.log("modules:'".concat(t.join(","),"' (").concat(t.length,")")),t.filter((function(e){return"."!=e&&".."!=e})).map((function(e){return e.split(".")[0]}))},e.prototype._compileLoadSceneJs=function(e){return a(this,void 0,void 0,(function(){var t,n,r,i,s,a,f,y,S,b,A,C,w,P,O,x,T,L,N,F,M,D,R,k,I,U=this;return l(this,(function(l){switch(l.label){case 0:for(this.mainController.status.setStatus("compiling js start"),t=e.outLoadSceneJsFolder,n=e.editorApi,r=e.publicRelativeFolder,i=e.publicPath,v.Logger.log("deleting folder ".concat(t)),d.FsWrapped.removeSync(t),v.Logger.log("folder ".concat(t," deleted")),s=this.mainController.project_config.config(),a=s.src_scene_folder,f=function(){var e=U.mainController.sceneSaver.npm.modulesFolder();return e?U._moduleNames().map((function(t){var n=h.join(e,"".concat(t,".js"));return d.FsWrapped.existsSync(n)?n:h.join(e,"".concat(t,".ts"))})):(v.Logger.log("modules folder not found (".concat(e,")")),[])},y=h.join(a,g.AUTOGENERATED),S=c([h.join(y,"".concat(p.INDEX,".js"))],f(),!0),b=0,A=S;b<A.length;b++)C=A[b],I=C.replace(y,r).replace(".ts",".js"),w=I.includes("/modules/"),P=this.mainController.sceneSaver.timestamps,O=w?P.polygonjsVersionQueryParam():P.timestampQueryParam(),n.html.head.addPreloadUrl("".concat(I,"?").concat(O),{crossorigin:!0});x=t,v.Logger.log("compile load js start"),l.label=1;case 1:return l.trys.push([1,3,,8]),[4,(0,_.build)(o(o(o({entryPoints:S,bundle:!0,splitting:!0,minify:!0,outdir:x,format:"esm"},m.EsbuildOptions),m.EsbuildTargetOptions),{plugins:[j.threeImportMapsOnResolve]}))];case 2:return l.sent(),v.Logger.log("compile load js done"),[3,8];case 3:l.sent(),v.Logger.log("esbuild fails, trying with webpack..."),this.mainController.status.setStatus("esbuild fails, trying with webpack..."),T=0,L=function(){var e="";T>5&&(e="We're still on it!"),T>10&&(e="Getting close..."),T>15&&(e="So so close!"),U.mainController.status.setStatus("Physics nodes require a longer export method, it may take 20-30 more seconds... (".concat(T,") ").concat(e))},N=setInterval((function(){T++,L()}),1e3),l.label=4;case 4:return l.trys.push([4,6,,7]),[4,this.mainController.bundle.webpack.build({entryPoints:S,outdir:x,publicPath:i})];case 5:return l.sent(),clearInterval(N),[3,7];case 6:throw F=l.sent(),clearInterval(N),console.log(F),v.Logger.error("wepack compilation failed"),new Error(u.ESBUILD_FAIL);case 7:return[3,8];case 8:for(this.mainController.status.setStatus("compiling js completed"),this.finalZipHandler.addDirectory(t),M=E.FileHelper.getFilesFromDir(t),D=0,R=M;D<R.length;D++)(k=R[D]).match(/chunk-.*\.js$/)&&(I=h.join(r,k),n.html.head.addPreloadUrl(I,{crossorigin:!0}));return[2]}}))}))},e.prototype._createCompressedJsFiles=function(e){return a(this,void 0,void 0,(function(){var t,n,o,r,i;return l(this,(function(s){switch(s.label){case 0:t=E.FileHelper.getFilesFromDir(e),v.Logger.log("compressing files:"),v.Logger.log(t.join(", ")),n=0,o=t,s.label=1;case 1:return n<o.length?(r=o[n],".js"!=h.extname(r)?[3,3]:(i=h.join(e,r),[4,this._createCompressedJsFile(i)])):[3,4];case 2:s.sent(),s.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype._createCompressedJsFile=function(e){return a(this,void 0,void 0,(function(){var t,n,o,r,i;return l(this,(function(s){switch(s.label){case 0:return this.mainController.status.setStatus("compressing file: ".concat(e)),t=d.FsWrapped.readFileSync(e),n="".concat(e,".gz"),o=(0,y.gzipBuffer)(t),d.FsWrapped.writeFileSync(n,o),[4,P.CoreSleep.sleep(5)];case 1:return s.sent(),r="".concat(e,".br"),i=(0,y.brotliBuffer)(t),d.FsWrapped.writeFileSync(r,i),[4,P.CoreSleep.sleep(5)];case 2:return s.sent(),[2]}}))}))},e.prototype.evalConfigureEditor=function(e){return a(this,void 0,void 0,(function(){var t,n,o,r;return l(this,(function(i){switch(i.label){case 0:return v.Logger.log("_evalConfigureEditor START"),t=this.mainController.project_config.config(),n=t.src_polygon_folder,o=h.join(n,"EditorConfig.ts"),[4,this._compileFile({entryFilePath:o,minify:!1})];case 1:return(r=i.sent())?(r=this._removeLastExport(r),r+="controller._configureEditor = configureEditor;",new Function("controller",r)(this),this._configureEditor&&this._configureEditor(e),v.Logger.log("_evalConfigureEditor DONE"),[2]):[2]}}))}))},e.prototype._compileIndexHTML=function(e){return a(this,void 0,void 0,(function(){var t,n,o,r,i,s,a,c,u,p;return l(this,(function(l){this.mainController.status.setStatus("compiling HTML"),t=this.mainController.project_config.config(),n=e.api,o=t.public_root,r=t.src_scene_folder,i=h.join(r,"index.html"),s=d.FsWrapped.readFileSync(i,"utf-8");try{a=b.template(s)({EditorApi:n}),c="index.html",u=h.join(o,c),p=C.PrettierController.formatHTML(a),v.Logger.log("adding html file '".concat(u,"'")),this.mainController.status.setStatus("adding html file '".concat(u,"'")),this.finalZipHandler.addFileContent({path:c,content:p})}catch(e){throw console.log(e),console.log("there was an error parsing the html file. Could it be that you have use backticks? Those are currently not supported."),new Error(e.message)}return[2]}))}))},e.prototype._compileFile=function(e){return a(this,void 0,void 0,(function(){var t,n,r,i,s;return l(this,(function(a){switch(a.label){case 0:return t=this.mainController.project_config.config().src_polygon_folder,n=e.outFilePath||h.join(t,".tmp.out.js"),r=null!=e.minify&&e.minify,i=e.entryFilePath,d.FsWrapped.existsSync(i)?[4,(0,_.build)(o(o(o({entryPoints:[i],bundle:!0,minify:r,outfile:n,format:"esm"},m.EsbuildOptions),m.EsbuildTargetOptions),{plugins:[j.threeImportMapsOnResolve]}))]:(v.Logger.log("file '".concat(i,"' not found, cannot compile")),[2]);case 1:return a.sent(),s=d.FsWrapped.readFileSync(n,"utf-8"),e.outFilePath||d.FsWrapped.unlinkSync(n),[2,s]}}))}))},e.prototype._removeLastExport=function(e){for(var t=[],n=!1,o=0,r=e.split("\n");o<r.length;o++){var i=r[o];i.includes("export {")&&(n=!0),n||t.push(i)}return t.join("\n")},e}();t.SceneExportController=L},9898:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.threejsFolder=void 0;var s=i(n(4470)),a=i(n(1017));function l(){var e=function(){var e=a.join(process.cwd(),"node_modules","@polygonjs","polygonjs","package.json");if(s.existsSync(e)){var t=s.readFileSync(e,"utf-8");try{return JSON.parse(t)}catch(e){return}}}();if(e){var t=e.dependencies;if(t)return t.three}}function c(e,t){return e.find((function(e){return function(e,t){var n=a.join(e,"package.json");if(!s.existsSync(n))return!1;try{return JSON.parse(s.readFileSync(n,"utf-8")).version==t}catch(e){return!1}}(e,t)}))}t.threejsFolder=function(e){var t=l();if(t){var n,o,r=c((o=[],n=a.join(process.cwd(),"node_modules","three"),s.existsSync(n)&&o.push(n),function(){var e=a.join(process.cwd(),"node_modules","@polygonjs","polygonjs","node_modules","three");s.existsSync(e)&&o.push(e)}(),function(){for(var e=a.join(process.cwd(),"node_modules"),t=0,n=s.readdirSync(e);t<n.length;t++){var r=n[t];if("@polygonjs"!=r){var i=a.join(process.cwd(),"node_modules",r,"node_modules","three");s.existsSync(i)&&o.push(i)}}}(),o),t);if(r){var i=a.join(r,"examples","jsm","libs",e.strFolderName);return s.existsSync(i),i}}}},6437:(e,t,n)=>{t.__esModule=!0,t.AwarenessController=void 0;var o=n(5849),r=function(){function e(e){this.multiPlayer=e,this._updatedAt=-1,this._broadcastedAt=-1,this._awarenessDataByUsernameByScene={},this._broadcastIfRequiredBound=this._broadcastIfRequired.bind(this)}return e.prototype.start=function(){this._interval=setInterval(this._broadcastIfRequiredBound,50)},e.prototype.stop=function(){null!=this._interval&&clearInterval(this._interval)},e.prototype.setPath=function(e,t){try{var n=e.body,r=n.sceneName,i=n.username,s=n.path;this._awarenessForUser({sceneName:r,username:i}).path=s,this._updatedAt=performance.now()}catch(e){o.Logger.error("failed to update awareness setPath"),console.log(e)}t.json({})},e.prototype.setPosition=function(e,t){try{var n=e.body,r=n.sceneName,i=n.username,s=n.cursor,a=this._awarenessForUser({sceneName:r,username:i});a.cursor.x=s.x,a.cursor.y=s.y,this._updatedAt=performance.now()}catch(e){o.Logger.error("failed to update awareness setPosition"),console.log(e)}t.json({})},e.prototype.setCamera=function(e,t){try{var n=e.body,r=n.sceneName,i=n.username,s=n.camera,a=this._awarenessForUser({sceneName:r,username:i});a.camera.position.x=s.position.x,a.camera.position.y=s.position.y,a.camera.zoom=s.zoom,this._updatedAt=performance.now()}catch(e){o.Logger.error("failed to update awareness setCamera"),console.log(e)}t.json({})},e.prototype._awarenessForUser=function(e){var t=e.sceneName,n=e.username,o=this._awarenessDataByUsernameByScene[t];o||(o={},this._awarenessDataByUsernameByScene[t]=o);var r=o[n];return r||(r={path:"",cursor:{x:0,y:0},camera:{position:{x:0,y:0},zoom:1}},o[n]=r),r},e.prototype._broadcastIfRequired=function(){this._broadcastedAt>=this._updatedAt||(this.multiPlayer.mainController.socket.emitAwarenessUpdated(this._awarenessDataByUsernameByScene),this._broadcastedAt=performance.now())},e}();t.AwarenessController=r},2991:function(e,t){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},n.apply(this,arguments)};t.__esModule=!0,t.CommandsController=void 0;var o=function(){function e(e){this.multiPlayer=e}return e.prototype.requestCommand=function(e,t){var o=e.body,r=o.command,i=o.sceneName,s=o.username;if(this._requestAllowed(s)){var a=this.multiPlayer.subControllers(i).historyStack,l=a.pushCommand(r),c=n(n({command:o.command,stackIndex:a.index()},this.emitData()),{uuid:l,sceneName:i});this.multiPlayer.mainController.socket.emitMultiplayerCommandConfirmed(c),t.json(c)}else t.json({})},e.prototype.updateCommand=function(e,t){var n=e.body;this.multiPlayer.subControllers(n.sceneName).historyStack.updateCommand(n.uuid,n.command),t.json({})},e.prototype.requestUndo=function(e,t){var o=e.body,r=o.sceneName,i=o.username;if(this._requestAllowed(i)){var s=this.multiPlayer.subControllers(r).historyStack,a=s.undo(),l=n(n({command:a,commandFound:null!=a,stackIndex:s.index()},this.emitData()),{sceneName:r});this.multiPlayer.mainController.socket.emitMultiplayerUndoConfirmed(l),t.json(l)}else t.json({})},e.prototype.requestRedo=function(e,t){var o=e.body,r=o.sceneName,i=o.username;if(this._requestAllowed(i)){var s=this.multiPlayer.subControllers(r).historyStack,a=s.redo(),l=n(n({command:a,commandFound:null!=a,stackIndex:s.index()},this.emitData()),{sceneName:r});this.multiPlayer.mainController.socket.emitMultiplayerRedoConfirmed(l),t.json(l)}else t.json({})},e.prototype.emitData=function(){return{stackUpdateConfirmedAt:performance.now()}},e.prototype._requestAllowed=function(e){return!this.multiPlayer.started()||null!=e&&this.multiPlayer.users.existsAndIsNotBanned(e)},e}();t.CommandsController=o},1827:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.MultiPlayerController=void 0;var i=n(2766),s=n(2991),a=n(5480),l=n(2427),c=n(4570),u=n(357),p=n(2746),d=n(3916),f=n(6437),h=function(){function e(e){this.mainController=e,this.awareness=new f.AwarenessController(this),this.commands=new s.CommandsController(this),this.sceneData=new i.SceneDataController(this),this.sessions=new u.SessionsController(this),this.tunnel=new a.TunnelController(this.mainController),this.userRequests=new d.UserRequestsController(this),this.users=new p.UsersController(this),this._subControllers=new Map,this.sceneDataBySceneName=new Map,this._port=-1}return e.prototype.setPort=function(e){this._port=e},e.prototype.port=function(){return this._port},e.prototype.start=function(e){this.mainController.socket.setTunnelUrl(e),this.awareness.start()},e.prototype.started=function(){return this.sessions.started()},e.prototype.close=function(e){return o(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return this._subControllers.clear(),this.awareness.stop(),this.mainController.socket.emitMultiplayerSessionDestroyed(e),[4,this.tunnel.close()];case 1:return t.sent(),[2]}}))}))},e.prototype.subControllers=function(e){var t=this._subControllers.get(e);return t||(t={historyStack:new l.BySceneNameHistoryStackController(this),sceneData:new c.BySceneNameSceneDataController(this)},this._subControllers.set(e,t)),t},e}();t.MultiPlayerController=h},2766:(e,t)=>{t.__esModule=!0,t.SceneDataController=void 0;var n=function(){function e(e){this.multiPlayer=e}return e.prototype.save=function(e,t){var n=e.body,o=n.sceneName,r=n.username;this.multiPlayer.users.existsAndIsNotBanned(r)&&this.multiPlayer.subControllers(o).sceneData.confirmSceneData(n),t.json({})},e.prototype.getSceneData=function(e){if(null==e)return{error:"scene name not given"};var t=this.multiPlayer.subControllers(e).sceneData._getSceneData();return t||{error:"scene data not found"}},e}();t.SceneDataController=n},357:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.SessionsController=void 0;var r=function(){function e(e){this.multiPlayer=e}return e.prototype.startedBy=function(){return this._startedBy},e.prototype.started=function(){return null!=this._startedBy},e.prototype.checkCreationAllowed=function(e,t){return n(this,void 0,void 0,(function(){var n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return n=e.body,r=n.secret,[4,this.multiPlayer.mainController.authentication.fetchTokenInfo(r)];case 1:return i=o.sent(),s={sessionCreationAllowed:!1},i?[4,this.multiPlayer.tunnel.checkCreationAllowed()]:[3,3];case 2:return(a=o.sent()).error?s.error=a.error:a.authtoken?s.sessionCreationAllowed=!0:s.error="auththen not found",[3,4];case 3:s.error="login required",o.label=4;case 4:return t.json(s),[2]}}))}))},e.prototype.create=function(e,t){return n(this,void 0,void 0,(function(){var n,r,i,s,a,l;return o(this,(function(o){switch(o.label){case 0:return n=e.body,r=n.secret,[4,this.multiPlayer.mainController.authentication.fetchTokenInfo(r)];case 1:return i=o.sent(),s={started:!1},i?(a=this.multiPlayer.port(),[4,this.multiPlayer.tunnel.start(a)]):[3,3];case 2:return o.sent(),(l=this.multiPlayer.tunnel.data()).error?s.error=l.error:l.url?(this._shareUrl=l.url,this._startedBy=i.json.username,this.multiPlayer.start(this._shareUrl),this.multiPlayer.users._create({secret:r,user:{username:this._startedBy,banned:!1}}),s.shareUrl=this._shareUrl,s.startedBy=this._startedBy,s.started=!0):s.error="unknown error",[3,4];case 3:s.error="login required",o.label=4;case 4:return t.json(s),[2]}}))}))},e.prototype.show=function(e,t){return n(this,void 0,void 0,(function(){var e;return o(this,(function(n){return e={shareUrl:this._shareUrl,startedBy:this._startedBy,started:null!=this._startedBy},t.json(e),[2]}))}))},e.prototype.destroy=function(e,t){return n(this,void 0,void 0,(function(){var n,r,i,s,a;return o(this,(function(o){switch(o.label){case 0:return n=e.body,r=n.secret,i=n.browserIdToKeep,[4,this.multiPlayer.mainController.authentication.fetchTokenInfo(r)];case 1:return s=o.sent(),a={destroyed:!1},s?null!=this._startedBy&&s.json.username==this._startedBy?(this._shareUrl=void 0,this.multiPlayer.close({browserIdToKeep:i,ejectAll:!1}),this._startedBy=void 0,a.destroyed=!0):a.error="session can only be stopped by the person who initiated it (username: ".concat(this._startedBy,")"):a.error="login required",t.json(a),[2]}}))}))},e}();t.SessionsController=r},5480:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.TunnelController=void 0;var s=n(5849),a=i(n(732)),l=n(8708),c=function(){function e(e){this.mainController=e}return e.prototype.data=function(){return{url:this._url,error:this._error}},e.prototype.checkCreationAllowed=function(){return o(this,void 0,void 0,(function(){var e,t,n;return r(this,(function(o){switch(o.label){case 0:return e=new l.EditorApi,[4,this.mainController.sceneExport.evalConfigureEditor({api:e,sceneName:"any"})];case 1:return o.sent(),t=e.multiplayer.remote.ngrok.authToken(),n=e.multiplayer.remote.ngrok.closeExistingTunnelsOnCreate(),t?[2,{authtoken:t,closeExistingTunnelsOnCreate:n}]:[2,{error:"no authtoken found"}]}}))}))},e.prototype.start=function(e){return o(this,void 0,void 0,(function(){var t,n,o,i,l;return r(this,(function(r){switch(r.label){case 0:return[4,this.checkCreationAllowed()];case 1:return t=r.sent(),n=t.authtoken,o=t.closeExistingTunnelsOnCreate,this._error=void 0,n?[4,this.close()]:[3,8];case 2:return r.sent(),o?[4,this.closeAll()]:[3,4];case 3:r.sent(),r.label=4;case 4:return r.trys.push([4,6,,7]),i=this,[4,a.default.connect({authtoken:n,port:e})];case 5:return i._url=r.sent(),s.Logger.log("Remote created on ".concat(this._url)),[3,7];case 6:return l=r.sent(),console.log(l),console.log(l.message),this._error="fail to create a remote session on port ".concat(e,", make sure your token is valid ( ").concat(n," )"),[2,null];case 7:return[3,9];case 8:this._error="no authtoken found, make sure to add one in your EditorConfig.ts",r.label=9;case 9:return[2]}}))}))},e.prototype.close=function(){return o(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:if(!this._url)return[2];s.Logger.log("Remote on ".concat(this._url," closing in progress...")),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.default.disconnect(this._url)];case 2:return e.sent(),s.Logger.log("Remote on ".concat(this._url," closed")),[3,4];case 3:return e.sent(),s.Logger.log("Failed to close ".concat(this._url)),[3,4];case 4:return this._url=void 0,[2]}}))}))},e.prototype.closeAll=function(){return o(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,a.default.disconnect()];case 1:return e.sent(),[3,3];case 2:return e.sent(),console.log("failed to disconnect ngrok cleanly (but it's probably okay, not to worry)"),[3,3];case 3:return[2]}}))}))},e}();t.TunnelController=c},3916:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.UserRequestsController=void 0;var r=function(){function e(e){this.multiPlayer=e,this._requestsBySecret=new Map,this._cache={requests:[],requestsByUsername:new Map}}return e.prototype.requests=function(){return this._cache.requests},e.prototype.index=function(e,t){var n={requests:this._cache.requests};t.json(n)},e.prototype.create=function(e,t){return n(this,void 0,void 0,(function(){function n(e){t.json({error:e})}var r,i,s,a,l;return o(this,(function(o){switch(o.label){case 0:return r=e.body,i=r.secret,[4,this.multiPlayer.mainController.authentication.fetchTokenInfo(i)];case 1:return(s=o.sent())?(a=s.json.username,this.multiPlayer.users.isBanned(a)?[2,n("you have been banned")]:this.multiPlayer.users.existsAndIsNotBanned(a)?[2,n("you have already been granted access")]:this._isRejected(a)?[2,n("your request has been rejected")]:(this._saveRequest({secret:i,request:{username:a,rejected:!1}}),l={},t.json(l),[2])):[2,n("user not found")]}}))}))},e.prototype.approve=function(e,t){return n(this,void 0,void 0,(function(){function n(e){t.json({error:e})}var r,i,s,a,l,c;return o(this,(function(o){switch(o.label){case 0:return r=e.body,i=r.username,s=r.secret,[4,this.multiPlayer.mainController.authentication.fetchTokenInfo(s)];case 1:return(a=o.sent())?null!=a.json.username&&a.json.username==this.multiPlayer.sessions.startedBy()?this.multiPlayer.users.isBanned(i)?[2,n("".concat(i," has been banned"))]:(l=this._cache.requestsByUsername.get(i))?(this._approveRequest(l),c={},t.json(c),[2]):[2,n("no request found for '".concat(i,"'"))]:[2,n("only the user who started this session can approve users")]:[2,n("user not found")]}}))}))},e.prototype.reject=function(e,t){return n(this,void 0,void 0,(function(){function n(e){t.json({error:e})}var r,i,s,a,l;return o(this,(function(o){switch(o.label){case 0:return r=e.body,i=r.secret,s=r.username,[4,this.multiPlayer.mainController.authentication.fetchTokenInfo(i)];case 1:return o.sent()?this.multiPlayer.users.isBanned(s)?[2,n("".concat(s," has been banned"))]:(a=this._cache.requestsByUsername.get(s))?(this._rejectRequest(a),l={},t.json(l),[2]):[2,n("no request found for '".concat(s,"'"))]:[2,n("user not found")]}}))}))},e.prototype._isRejected=function(e){var t;return(null===(t=this._cache.requestsByUsername.get(e))||void 0===t?void 0:t.request.rejected)||!1},e.prototype._saveRequest=function(e){var t=e.secret,n=e.request;this._requestsBySecret.set(t,n),this._updateCaches()},e.prototype._rejectRequest=function(e){e.request.rejected=!0,this._updateCaches()},e.prototype._approveRequest=function(e){var t=e.secret,n=e.request;this._requestsBySecret.delete(t),this.multiPlayer.users._create({secret:t,user:{username:n.username,banned:!1}}),this._updateCaches()},e.prototype._updateCaches=function(){var e=this;this._cache.requests.splice(0,this._cache.requests.length),this._cache.requestsByUsername.clear(),this._requestsBySecret.forEach((function(t,n){e._cache.requests.push(t),e._cache.requestsByUsername.set(t.username,{secret:n,request:t})})),this.multiPlayer.mainController.socket.emitMultiplayerUsersUpdated()},e}();t.UserRequestsController=r},2746:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.UsersController=void 0;var r=function(){function e(e){this.multiPlayer=e,this._userDatasBySecret=new Map,this._cache={users:[],usersByUsername:new Map}}return e.prototype.users=function(){return this._cache.users},e.prototype.isBanned=function(e){var t;return(null===(t=this._cache.usersByUsername.get(e))||void 0===t?void 0:t.user.banned)||!1},e.prototype.existsAndIsNotBanned=function(e){var t;return!1===(null===(t=this._cache.usersByUsername.get(e))||void 0===t?void 0:t.user.banned)},e.prototype._create=function(e){var t=e.secret,n=e.user;this.isBanned(n.username)||(this._removeExistingSecretsForUsername(n.username),this._userDatasBySecret.set(t,{secret:t,user:n}),this._updateCaches())},e.prototype.index=function(e,t){var n={users:this._cache.users};t.json(n)},e.prototype.destroy=function(e,t){var n=e.body.secret;this._userDatasBySecret.delete(n),this._updateCaches();t.json({})},e.prototype.ban=function(e,t){return n(this,void 0,void 0,(function(){var n,r,i,s,a,l;return o(this,(function(o){switch(o.label){case 0:return n=e.body,r=n.secret,i=n.username,[4,this.multiPlayer.mainController.authentication.fetchTokenInfo(r)];case 1:return(s=o.sent())&&null!=s.json.username&&s.json.username==this.multiPlayer.sessions.startedBy()&&(a=this._cache.usersByUsername.get(i))&&(a.user.banned=!0),this.multiPlayer.mainController.socket.emitMultiplayerUsersUpdated(),l={},t.json(l),[2]}}))}))},e.prototype.unban=function(e,t){return n(this,void 0,void 0,(function(){var n,r,i,s,a,l;return o(this,(function(o){switch(o.label){case 0:return n=e.body,r=n.secret,i=n.username,[4,this.multiPlayer.mainController.authentication.fetchTokenInfo(r)];case 1:return(s=o.sent())&&null!=s.json.username&&s.json.username==this.multiPlayer.sessions.startedBy()&&(a=this._cache.usersByUsername.get(i))&&(a.user.banned=!1),this.multiPlayer.mainController.socket.emitMultiplayerUsersUpdated(),l={},t.json(l),[2]}}))}))},e.prototype._removeExistingSecretsForUsername=function(e){var t=[];this._userDatasBySecret.forEach((function(n,o){n.user.username==e&&t.push(o)}));for(var n=0,o=t;n<o.length;n++){var r=o[n];this._userDatasBySecret.delete(r)}},e.prototype._updateCaches=function(){var e=this;this._cache.users.splice(0,this._cache.users.length),this._cache.usersByUsername.clear(),this._userDatasBySecret.forEach((function(t,n){e._cache.users.push(t.user),e._cache.usersByUsername.set(t.user.username,t)})),this._cache.users=this._cache.users.sort(),this.multiPlayer.mainController.socket.emitMultiplayerUsersUpdated()},e}();t.UsersController=r},2427:(e,t,n)=>{t.__esModule=!0,t.BySceneNameHistoryStackController=void 0;var o=n(2248),r=function(){function e(e){this.multiPlayer=e,this._commands=[],this._commandsByUuid=new Map,this._index=0,this._indexAtSceneSave=0}return e.prototype.sceneModified=function(){return this._index!=this._indexAtSceneSave},e.prototype.markSceneAsSaved=function(){this._indexAtSceneSave=this._index},e.prototype.index=function(){return this._index},e.prototype.updateCommand=function(e,t){var n=this._commandsByUuid.get(e);n&&(n.c=t)},e.prototype.pushCommand=function(e){var t={c:e};this._commands.push(t),this._commands.length>this._index&&(this._commands=this._commands.splice(0,this._index)),this._commands.push(t);for(var n=o.MathUtils.generateUUID();this._commandsByUuid.has(n);)n=o.MathUtils.generateUUID();for(this._commandsByUuid.set(n,t);this._commands.length>1e4;)this._commands.shift();return this._index=this._commands.length,n},e.prototype.undo=function(){var e=this._commands[this._index-1];if(e)return this._index-=1,e.c},e.prototype.redo=function(){var e=this._commands[this._index];if(e)return this._index+=1,e.c},e}();t.BySceneNameHistoryStackController=r},4570:(e,t)=>{t.__esModule=!0,t.BySceneNameSceneDataController=void 0;var n=function(){function e(e){this.multiPlayer=e,this._sceneDataConfirmedAt=-1}return e.prototype.confirmSceneData=function(e){e.stackUpdateConfirmedAt<=this._sceneDataConfirmedAt||(this._sceneDataConfirmedAt=e.stackUpdateConfirmedAt,this._sceneData=e.sceneData)},e.prototype._getSceneData=function(){return this._sceneData},e}();t.BySceneNameSceneDataController=n},3672:(e,t)=>{t.__esModule=!0,t.PluginFigmaController=void 0;var n=function(){function e(e){this.pluginsControllerController=e}return e.prototype.ping=function(e,t){t.json({})},e}();t.PluginFigmaController=n},4425:function(e,t,n){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},o.apply(this,arguments)},r=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};t.__esModule=!0,t.FinalZipHandler=void 0;var a=n(2456),l=n(7129),c=s(n(1017)),u=n(5898),p=n(5849),d=function(){function e(e){this.sceneExportController=e,this._filesToZip=new Set,this._fileContents=new Set,this.mainController=e.mainController}return e.prototype.zipped=function(){return this._zipped},e.prototype.start=function(){this._filesToZip.clear(),this._fileContents.clear()},e.prototype._addFilePath=function(e){var t=decodeURI(e);if(a.FsWrapped.existsSync(t)){var n=l.UrlHelper.sanitize(t);this._filesToZip.add(n)}else p.Logger.warn("file not found on disk: ".concat(t))},e.prototype.addFileContent=function(e){this._fileContents.add(o({},e))},e.prototype.addPublicUrl=function(e){var t=e.split("?")[0];"."==t[0]&&(t=t.slice(1,t.length));var n=this.mainController.project_config.config().public_root,o=c.join(n,t);this._addFilePath(o)},e.prototype.addDirectory=function(e){for(var t=0,n=u.FileHelper.getFilesFromDir(e);t<n.length;t++){var o=n[t];this._addFilePath(c.join(e,o))}},e.prototype.publicBuildFolder=function(){var e=this.mainController.project_config.config(),t=e.sceneName,n=e.public_root;return c.join(n,"polygonjs","build",t)},e.prototype.zipFilePath=function(){var e=this.mainController.project_config.config(),t=this.publicBuildFolder(),n=e.sceneName;return"".concat(t,"/").concat(n,".zip")},e}();t.FinalZipHandler=d},4594:(e,t)=>{t.__esModule=!0,t.SceneSaveOptionsController=void 0;var n=function(){function e(e){this.saverController=e,this._saveOptions={checkRemoteAssetsUse:!0,minimizeFilesCount:!1},this.mainController=e.mainController}return e.prototype.setEditorData=function(e){this._saveOptions.checkRemoteAssetsUse=e.saveOptions.checkRemoteAssetsUse,this._saveOptions.minimizeFilesCount=e.saveOptions.minimizeFilesCount},e.prototype.minimizeFilesCount=function(){return this._saveOptions.minimizeFilesCount},e}();t.SceneSaveOptionsController=n},2691:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.SceneNpmSaverController=void 0;var l=n(2456),c=n(2992),u=n(9001),p=n(7633),d=n(2992),f=i(n(1017)),h=n(5849),_=n(8324),m=n(7099),g=i(n(6517)),v=n(2822),y=n(9250),S=n(4249),b=n(2355),A={TS:{INDEX_HTML:n(1230),INDEX_JS:{JS:_.ImportsHelper.TStoJS(n(7275)),D_TS:_.ImportsHelper.TStoJS(n(542))},FETCH_SCENE_AND_MOUNT:{JS:_.ImportsHelper.TStoJS(n(8595)),D_TS:_.ImportsHelper.TStoJS(n(4369))},CREATE_SCENE_AND_MOUNT:{JS:_.ImportsHelper.TStoJS(n(208)),D_TS:_.ImportsHelper.TStoJS(n(1362))},CREATE_SCENE_AND_MOUNT_NO_CHUNK:{JS:_.ImportsHelper.TStoJS(n(6303)),D_TS:_.ImportsHelper.TStoJS(n(4287))},LOAD_SCENE_DATA:{JS:_.ImportsHelper.TStoJS(n(6037)),D_TS:_.ImportsHelper.TStoJS(n(5339))},LOAD_SCENE_FROM_SCENE_DATA:{JS:_.ImportsHelper.TStoJS(n(2032)),D_TS:_.ImportsHelper.TStoJS(n(868))},LOAD_SCENE:{JS:_.ImportsHelper.TStoJS(n(9869)),D_TS:_.ImportsHelper.TStoJS(n(2663))},README:n(3120),POLY_CONFIG:{TS:_.ImportsHelper.TStoJS(n(6402)),JS:_.ImportsHelper.TStoJS(n(4813))},EDITOR_CONFIG:n(697),PACKAGE:n(7746),GITIGNORE:n(9537)}},C=function(){function e(e){this.saver_controller=e,this._manifest_nodes_data={},this._shadersData={},this._jsFunctionBodiesData={},this._save_timestamp="".concat(Date.now()),this.mainController=e.mainController,this._sceneDataCache=new u.SceneDataCache(this.saver_controller.mainController)}return e.prototype.clearAutogeneratedFolder=function(){var e=this.mainController.project_config.config(),t=f.join(e.src_scene_folder,p.AUTOGENERATED);h.Logger.log("deleting folder ".concat(t)),l.FsWrapped.removeSync(t),h.Logger.log("folder ".concat(t," deleted"))},e.prototype.saveCommon=function(){return s(this,void 0,void 0,(function(){var e,t,n,o,r,i,s,l,u,d,f,h,_;return a(this,(function(a){switch(a.label){case 0:return this.mainController.status.setStatus("saving common files"),e=this.saver_controller.mainController,(t=e.scene_config.validConfig())?(this._manifest_nodes_data={},this._save_timestamp="".concat(Date.now()),n=this._save_timestamp,o=this._save_timestamp,e.manifest.load(),this._sceneDataCache.load_scene_data(),r=JSON.parse(JSON.stringify(t.code)),i=r.properties,s=r.root,l=r.shaders,u=r.jsFunctionBodies,d=r.ui,f=t.layout_data,this.saver_controller.saveOptions.setEditorData(f),[4,(h=e.file_writer).backupSceneData()]):[2];case 1:return a.sent(),this.clearAutogeneratedFolder(),h.clear_scene_data(),h.write_scene_data({file:p.OutFileName.UI,content:d}),h.write_scene_data({file:p.OutFileName.EDITOR_DATA,content:f}),h.write_scene_data({file:p.OutFileName.PROPERTIES,content:i}),this._saveNodeData(p.OutFileName.ROOT,s),l&&this._saveShaders(l),u&&this._saveJsFunctionBodies(u),h.write_scene_data({file:p.OutFileName.MANIFEST_ASSETS,content:t.assets},c.JsonDestFolder.SRC),_=e.manifest.content(),this._sceneDataCache.hasPropertiesChanged(i)||_&&(n=_.properties),this._sceneDataCache.hasRootChanged(s)||_&&(o=_.root),this._sceneManifestContent={properties:n,root:o,nodes:this._manifest_nodes_data,shaders:this._shadersData,jsFunctionBodies:this._jsFunctionBodiesData},h.write_scene_data({file:p.OutFileName.MANIFEST,content:this._sceneManifestContent},c.JsonDestFolder.SRC),this.savePackageJSON(),this._saveGitIgnore(),[2]}}))}))},e.prototype.savePackageJSON=function(){var e=f.join(v.CurrentPathController.CURRENT_PATH,"package.json");if(!l.FsWrapped.existsSync(e)){var t=m.ServerVersionController.version(),n=g.template(A.TS.PACKAGE)({editorVersion:t});l.FsWrapped.writeFileSync(e,n)}},e.prototype._saveGitIgnore=function(){var e=f.join(v.CurrentPathController.CURRENT_PATH,".gitignore");if(!l.FsWrapped.existsSync(e)){var t=v.CurrentPathController.LOG_FILE_NAME,n=g.template(A.TS.GITIGNORE)({logFileName:t});l.FsWrapped.writeFileSync(e,n)}},e.prototype._saveNodeData=function(e,t,n){var o=this;void 0===n&&(n="");var r=this.saver_controller.mainController,i="".concat(n,"/").concat(e),s=i.substr(6),a=this._save_timestamp;!function(){var e=t.nodes;if(e){for(var l=[],c=0,u=Object.keys(e);c<u.length;c++){(g=e[m=u[c]]).nodes&&(delete e[m],l.push({childName:m,childData:g,nodeFullPath:i}))}var p=r.manifest.content();if(p){var d=p.nodes[s];o._sceneDataCache.hasNodeDataChanged(s,t)||(a=d)}r.file_writer.write_scene_data({file:i,content:t}),""!=n&&(o._manifest_nodes_data[s]=a);for(var f=0,h=l;f<h.length;f++){var _=h[f],m=_.childName,g=_.childData,v=_.nodeFullPath;o._saveNodeData(m,g,v)}}}()},e.prototype._saveShaders=function(e){this._shadersData={};for(var t=this._save_timestamp,n=this.saver_controller.mainController,o=Object.keys(e||{}),r=n.manifest.content(),i=0,s=o;i<s.length;i++)for(var a=s[i],l=e[a],c=0,u=Object.keys(l||{});c<u.length;c++){var p=u[c],d=l[p],f=(0,S.shaderFilePath)({nodePath:a,shaderName:p});if(n.file_writer.writeGLSL({file:f,content:d}),r){var h=(r.shaders||{})[a];if(h){var _=(h||{})[p],m=this._sceneDataCache.hasShaderChanged({nodePath:a,shaderName:p,newShader:d});_&&!m&&(t=_)}this._shadersData[a]=this._shadersData[a]||{},this._shadersData[a][p]=t}}},e.prototype._saveJsFunctionBodies=function(e){var t=this;this._jsFunctionBodiesData={};for(var n=this._save_timestamp,o=this.saver_controller.mainController,r=Object.keys(e||{}),i=o.manifest.content(),s=function(r){var s=e[r],a=i?(i.jsFunctionBodies||{})[r]:null,l=function(e,s){var l=(0,S.jsFunctionBodyFilePath)({nodePath:r,key:s});if(o.file_writer.writeTXT({file:l,content:e}),i){if(a){var c=(0,b.isString)(a)?a:s?(a||{})[s]:null,u=t._sceneDataCache.hasJsFunctionBodyChanged({nodePath:r,newJsFunctionBody:e});c&&!u&&(n=c)}t._jsFunctionBodiesData[r]=n}};if((0,b.isString)(s))l(s);else for(var c=0,u=Object.keys(s);c<u.length;c++){var p=u[c];l(s[p],p)}},a=0,l=r;a<l.length;a++){s(l[a])}},e.prototype.saveDetails=function(e){this.mainController.status.setStatus("saving detail files"),this._save_README(),this._save_index_html(),this._save_index_js(),this._save_fetchSceneAndMount(),this.saver_controller.saveOptions.minimizeFilesCount()&&this._save_createSceneAndMount(),this._save_loadSceneData(),this._save_loadScene(),this._save_loadSceneFromSceneData(),this._save_poly_config(),this._saveModules(),this._save_editor_config(),this._save_register_config_config(e),this._save_scene_node_map(e)},e.prototype.modulesFolder=function(){var e=this.saver_controller.mainController.project_config.config();return f.join(e.src_scene_folder,p.AUTOGENERATED,"modules")},e.prototype._saveModules=function(){var e=this.saver_controller.mainController,t=e.scene_config.validConfig();if(t){var n=t.modules;e.file_writer.write_scene_data({file:p.OutFileName.MODULES,content:n},c.JsonDestFolder.SRC);var o=this.modulesFolder();if(o)for(var r="src"==this.mainController.project_config.config().imports_type?"ts":"js",i=0,s=n;i<s.length;i++){var a=s[i],l=f.join(o,"".concat(a,".").concat(r)),u="\nimport {".concat(a,"Module} from '").concat("@polygonjs/polygonjs/dist/src/engine/poly/registers/modules/entryPoints","/").concat(a,".js'\nexport {").concat(a,"Module}\n");u=this._update_imports_to_dist(u),d.FileWriterController.write_text_file_and_create_folders({file:l,content:u,prettier:!0})}}},e.prototype._save_README=function(){var e=this.saver_controller.mainController.project_config.config(),t=f.join(e.project_root,"README.md");if(!l.FsWrapped.existsSync(t)){var n=A.TS.README;l.FsWrapped.writeFileSync(t,n)}},e.prototype._save_index_html=function(){var e=this.saver_controller.mainController.project_config.config(),t=f.join(e.src_scene_folder,"index.html");if(l.FsWrapped.existsSync(t))h.Logger.log("file ".concat(t," already exists, not replacing"));else{var n=A.TS.INDEX_HTML,o=this.mainController.project_config.config().sceneName;n=n.replace(/___SCENE_NAME___/g,o),d.FileWriterController.write_text_file_and_create_folders({file:t,content:n,prettier:!0})}},e.prototype._save_index_js=function(){var e=this;if(this.mainController.scene_config.validConfig()){var t=this.saver_controller.mainController.project_config.config(),n=A.TS.INDEX_JS,o=function(n,o){var r="".concat(p.OutFileName.INDEX_JS,".").concat(o),i=f.join(t.src_scene_folder,r),s=e._update_imports_to_dist(n);s=e.saver_controller.replaceVariables(s,{functionName:e.saver_controller.mainController.sceneExport.entryPointName()}),s=y.PrettierController.formatAny(i,s),d.FileWriterController.write_text_file_and_create_folders({file:i,content:s,prettier:!0})};o(n.JS,"js"),o(n.D_TS,"d.ts")}},e.prototype._save_loadSceneData=function(){var e=this,t=this.saver_controller.mainController.project_config.config(),n=A.TS.LOAD_SCENE_DATA,o=JSON.stringify(this._sceneManifestContent||{}),r=function(n,r){var i="".concat(p.OutFileName.LOAD_SCENE_DATA_TEMPLATE,".").concat(r),s=f.join(t.src_scene_folder,i),a=e._update_imports_to_dist(n);a=e.saver_controller.replaceVariables(a,{manifestJSON:o}),a=y.PrettierController.formatAny(s,a),d.FileWriterController.write_text_file_and_create_folders({file:s,content:a,prettier:!0})};r(n.JS,"js"),r(n.D_TS,"d.ts")},e.prototype._save_loadSceneFromSceneData=function(){var e=this,t=this.saver_controller.mainController.project_config.config(),n=A.TS.LOAD_SCENE_FROM_SCENE_DATA,o=function(n,o){var r="".concat(p.OutFileName.LOAD_SCENE_FROM_SCENE_DATA_TEMPLATE,".").concat(o),i=f.join(t.src_scene_folder,r),s=e._update_imports_to_dist(n);s=e.saver_controller.replaceVariables(s),s=y.PrettierController.formatAny(i,s),d.FileWriterController.write_text_file_and_create_folders({file:i,content:s,prettier:!0})};o(n.JS,"js"),o(n.D_TS,"d.ts")},e.prototype._save_fetchSceneAndMount=function(){var e=this;if(this.mainController.scene_config.validConfig()){var t=this.saver_controller.mainController.project_config.config(),n=A.TS.FETCH_SCENE_AND_MOUNT,o=function(n,o){var r="".concat(p.OutFileName.FETCH_SCENE_AND_MOUNT_TEMPLATE,".").concat(o),i=f.join(t.src_scene_folder,r),s=e._update_imports_to_dist(n);s=e.saver_controller.replaceVariables(s),s=y.PrettierController.formatAny(i,s),d.FileWriterController.write_text_file_and_create_folders({file:i,content:s,prettier:!0})};o(n.JS,"js"),o(n.D_TS,"d.ts")}},e.prototype._save_createSceneAndMount=function(){var e=this,t=this.mainController.scene_config.validConfig();if(t){var n,o,r,i,s,a=this.saver_controller.mainController.project_config.config(),c=function(n,o,r){var i="".concat(o,".").concat(r),s=f.join(a.src_scene_folder,i),l=e._update_imports_to_dist(n),c=JSON.parse(JSON.stringify(t.code));c.ui=void 0;var u=JSON.stringify(c);l=e.saver_controller.replaceVariables(l,{sceneCode:u}),d.FileWriterController.write_text_file_and_create_folders({file:s,content:l,prettier:!1})};n="".concat(p.OutFileName.SCENE_DATA_SINGLE_FILE,".js"),o=f.join(a.src_scene_folder,n),r=JSON.parse(JSON.stringify(t.code)),i=y.PrettierController.formatAny(o,"export const sceneData = "+JSON.stringify(r,null,"\t")),s=f.dirname(o),l.FsWrapped.existsSync(s)||l.FsWrapped.mkdirSync(s,{recursive:!0}),l.FsWrapped.writeFileSync(o,i),h.Logger.file(o);var u=A.TS.CREATE_SCENE_AND_MOUNT,_=p.OutFileName.CREATE_SCENE_AND_MOUNT_TEMPLATE;c(u.JS,_,"js"),c(u.D_TS,_,"d.ts");var m=A.TS.CREATE_SCENE_AND_MOUNT_NO_CHUNK,g=p.OutFileName.CREATE_SCENE_AND_MOUNT_NO_CHUNK_TEMPLATE;c(m.JS,g,"js"),c(m.D_TS,g,"d.ts")}},e.prototype._save_loadScene=function(){var e=this,t=this.mainController.scene_config.validConfig();if(t){var n=t.name,o=this.saver_controller.mainController.project_config.config(),r=A.TS.LOAD_SCENE,i="./loadSceneFromSceneData.js",s="(sceneData==null ? loadSceneData_".concat(n,"(").concat("{onProgress, sceneDataRoot}",") : ").concat("(()=>{return new Promise(resolve=>resolve())})()",")"),a=t.modules.map((function(e){return"import('./modules/".concat(e,".js')")})).join(","),l="const modulePromises = [".concat(a,"]"),c="const promises = [import('".concat(i,"'), ").concat(s,", ...modulePromises];"),u="".concat(l,"\n\t\t").concat(c),h="const promises = [import('".concat(i,"'), ").concat(s,"];"),_=t.modules.length>0?u:h,m=function(t,n){var r="".concat(p.OutFileName.LOAD_SCENE_TEMPLATE,".").concat(n),i=f.join(o.src_scene_folder,r),s=e._update_imports_to_dist(t);s=e.saver_controller.replaceVariables(s,{promisesLine:_}),s=y.PrettierController.formatAny(i,s),d.FileWriterController.write_text_file_and_create_folders({file:i,content:s,prettier:!0})};m(r.JS,"js"),m(r.D_TS,"d.ts")}},e.prototype._save_poly_config=function(){var e=this,t=this.saver_controller.mainController.project_config.config(),n=A.TS.POLY_CONFIG;!function(){var o="".concat(p.OutFileName.POLY_CONFIG,".js"),r="".concat(p.OutFileName.POLY_CONFIG,".ts"),i=f.join(t.src_scene_folder,o),s=f.join(t.src_scene_folder,r),a=l.FsWrapped.existsSync(i),c=l.FsWrapped.existsSync(s);if(!a&&!c)if(e.saver_controller.mainController.project_config.isTypescript()){var u=y.PrettierController.formatAny(s,e._update_imports_to_dist(n.TS));d.FileWriterController.write_text_file_and_create_folders({file:s,content:u,prettier:!0})}else{u=y.PrettierController.formatAny(i,e._update_imports_to_dist(n.JS));d.FileWriterController.write_text_file_and_create_folders({file:i,content:u,prettier:!0})}}()},e.prototype._save_editor_config=function(){var e=this.saver_controller.mainController.project_config.config(),t=A.TS.EDITOR_CONFIG,n="".concat(p.OutFileName.EDITOR_CONFIG,".").concat("ts"),o=f.join(e.src_polygon_folder,n);if(!l.FsWrapped.existsSync(o)){var r=t,i=y.PrettierController.formatAny(o,r);d.FileWriterController.write_text_file_and_create_folders({file:o,content:i,prettier:!0})}},e.prototype._save_register_config_config=function(e){var t=this,n=this.saver_controller.mainController.file_writer.codeFilesFolder(),o="".concat(p.OutFileName.REQUIRED_IMPORTS,".js"),r=f.join(n,o),i=y.PrettierController.formatAny(r,this._update_imports_to_dist(function(e){var n=t.mainController.project_config.config().sceneName,o="requiredImports_".concat(n);return e=g.template(e)({constantName:o})}(e.register)));this.saver_controller.mainController.file_writer.writeCode({file:o,content:i})},e.prototype._save_scene_node_map=function(e){var t=this.mainController.scene_config.validConfig();if(t){var n=this.mainController.project_config.config().sceneName,o=this._update_imports_to_dist(g.template(e.scene_node_types)({sceneName:n})),r=t.scenePropTypes,i=this.saver_controller.mainController.file_writer.codeFilesFolder(),s="".concat(p.OutFileName.POLY_SCENE_WITH_NODE_MAP,".ts"),a=f.join(i,s),l=y.PrettierController.formatAny(a,"\nimport {ParamValueSerializedTypeMap} from '@polygonjs/polygonjs/dist/src/engine/params/types/ParamValueSerializedTypeMap';\n".concat(o,"\n\nexport interface PolySceneProps_").concat(n," ").concat(r,"\n"));this.saver_controller.mainController.file_writer.writeCode({file:s,content:l})}},e.prototype._update_imports_to_dist=function(e){return"src"==this.mainController.project_config.config().imports_type?_.ImportsHelper.JStoTS(e):e=_.ImportsHelper.TStoJS(e)},e}();t.SceneNpmSaverController=C},4413:(e,t)=>{t.__esModule=!0,t.TimestampController=void 0;var n=function(){function e(e){this.saveController=e,this._timestampQueryParam="",this._polygonjsVersionQueryParam=""}return e.prototype.init=function(){var e=this.saveController.mainController.scene_config.validConfig();if(!e)throw new Error("prepareQueryParams failed");var t=(new Date).getTime();this._timestampQueryParam="t=".concat(t);var n=e.engine_version.replace(/\./g,"_");this._polygonjsVersionQueryParam="polygon=".concat(n)},e.prototype.timestampQueryParam=function(){return this._timestampQueryParam},e.prototype.polygonjsVersionQueryParam=function(){return this._polygonjsVersionQueryParam},e}();t.TimestampController=n},6629:(e,t)=>{t.__esModule=!0,t.EsbuildTargetOptions=t.EsbuildOptions=void 0,t.EsbuildOptions={loader:{".glsl":"text",".html":"text"},define:{"process.env.NODE_ENV":'"production"'},external:["require","fs","path"]},t.EsbuildTargetOptions={target:"es2020"}},5898:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.FileHelper=void 0;var s=n(2456),a=i(n(1017)),l=function(){function e(){}return e.getFilesFromDir=function(e,t){var n=[];return s.FsWrapped.existsSync(e)&&function o(r){var i,l,c=s.FsWrapped.readdirSync(r);for(var u in c){var p=a.join(r,c[u]);if(null===(i=s.FsWrapped.statSync(p))||void 0===i?void 0:i.isFile()){var d=a.relative(e,p);t?-1!=t.indexOf(a.extname(p).toLowerCase())&&n.push(d):n.push(d)}else(null===(l=s.FsWrapped.statSync(p))||void 0===l?void 0:l.isDirectory())&&o(p)}}(e),n},e.removeExt=function(e){var t=e.split("."),n=t[t.length-1].length;return e.slice(0,e.length-n)},e}();t.FileHelper=l},7126:(e,t)=>{t.__esModule=!0,t.CoreFileUtils=void 0;var n=function(){function e(){}return e.dataURItoBuffer=function(e){return Buffer.from(e,"base64")},e.removeImportExport=function(e){for(var t=[],n=0,o=e.split("\n");n<o.length;n++){var r=o[n],i=r.includes("import {"),s=r.includes("export {");i||s||t.push(r)}return t.join("\n")},e}();t.CoreFileUtils=n},8324:(e,t)=>{t.__esModule=!0,t.ImportsHelper=void 0;var n=function(){function e(){}return e.TStoJS=function(e){return e.replace(/@polygonjs\/polygonjs\/src\//g,"@polygonjs/polygonjs/dist/src/")},e.JStoTS=function(e){return e.replace(/@polygonjs\/polygonjs\/dist\/src\//g,"@polygonjs/polygonjs/src/")},e}();t.ImportsHelper=n},5849:(e,t,n)=>{t.__esModule=!0,t.Logger=void 0;var o=n(2456),r=n(2822),i=n(5022),s=function(){function e(){}return e.log=function(e){var t=[this._timestamp(),e];console.log.apply(console,t),this._writeToFile(t)},e.req=function(e,t){var n=[this._timestamp(),"receiving:",e.url];null!=t&&n.push(t),console.log.apply(console,n),this._writeToFile(n)},e.error=function(e){var t,n=[this._timestamp(),"ERROR",e];console.log((t=i.bgBlack).red.apply(t,n)),this._writeToFile(n)},e.warn=function(e){var t,n=[this._timestamp(),"WARNING",e];console.log((t=i.bgBlack).yellow.apply(t,n)),this._writeToFile(n)},e.file=function(e){var t=[this._timestamp(),"updated file:",e];console.log.apply(console,t),this._writeToFile(t)},e._timestamp=function(){var e=Date.now();return new Date(e).toISOString()},e._writeToFile=function(e){var t=r.CurrentPathController.LOG_FILE_PATH;o.FsWrapped.existsSync(t)||o.FsWrapped.writeFileSync(t,"");try{o.FsWrapped.appendFileSync(t,e.join(" ")+"\n")}catch(e){console.error("failed to write to log file",t)}},e}();t.Logger=s},4859:(e,t)=>{t.__esModule=!0,t.RemoteApiController=void 0;var n=function(){function e(){}return e.instance=function(){return this.__instance=this.__instance||new e},e.prototype.overrideApiRoolUrl=function(e){this._overrideApiRoolUrl=e,console.log("test:'".concat(this._overrideApiRoolUrl,"'"))},e.prototype.overrideMarketApiRoolUrl=function(e){this._overrideMarketApiRoolUrl=e,console.log("test:'".concat(this._overrideMarketApiRoolUrl,"'"))},e.prototype._rootUrl=function(){return this._overrideApiRoolUrl||"https://api-npm-editor.polygonjs.com"},e.prototype._marketRootUrl=function(){return this._overrideMarketApiRoolUrl||"https://market.polygonjs.com"},e.prototype.createTokenUrl=function(){return"".concat(this._rootUrl(),"/api/tokens")},e.prototype.tokenUrl=function(){return"".concat(this._rootUrl(),"/api/tokens/whoami")},e.prototype.exportUrl=function(){return"".concat(this._rootUrl(),"/api/npm_module/exports")},e.prototype.sceneCreate=function(){return"".concat(this._rootUrl(),"/api/scenes")},e.prototype.marketplacePolyNodesIndex=function(){return"".concat(this._marketRootUrl(),"/api/poly_nodes")},e.prototype.marketplacePolyNodesSearch=function(){return"".concat(this._marketRootUrl(),"/api/poly_nodes/search")},e.prototype.marketplacePolyNodesData=function(){return"".concat(this._marketRootUrl(),"/api/poly_nodes/data")},e.prototype.marketplacePolyNodesUpload=function(){return"".concat(this._marketRootUrl(),"/api/poly_nodes/upload")},e}();t.RemoteApiController=n.instance()},4249:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};t.__esModule=!0,t.jsFunctionBodyUrl=t.jsFunctionBodyFilePath=t.shaderUrl=t.shaderFilePath=void 0;var a=i(n(1017)),l=n(7633);t.shaderFilePath=function(e){var t=e.nodePath,n=e.shaderName,o=a.join.apply(a,s([l.OutFileName.ROOT],t.split("/"),!1));return"".concat(o,".").concat(n,".glsl")},t.shaderUrl=function(e){var t=e.nodePath,n=e.shaderName;return"".concat(t,".").concat(n,".glsl")},t.jsFunctionBodyFilePath=function(e){var t=e.nodePath,n=e.key,o=a.join.apply(a,s([l.OutFileName.ROOT],t.split("/"),!1));return null!=n?"".concat(o,".").concat(n,".txt"):"".concat(o,".txt")},t.jsFunctionBodyUrl=function(e){var t=e.nodePath;return"".concat(t,".txt")}},4611:(e,t)=>{t.__esModule=!0,t.CoreSleep=void 0;var n=function(){function e(){}return e.sleep=function(e){return new Promise((function(t,n){setTimeout((function(){t()}),e)}))},e}();t.CoreSleep=n},8949:(e,t,n)=>{t.__esModule=!0,t.States=void 0;var o=n(336),r=function(){this.error=new o.StateError};t.States=r},3970:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.SystemController=void 0;var l=i(n(2037)),c=n(7396),u=function(){function e(){}return e.home_folder=function(){return l.homedir()},e.hostname=function(){return l.hostname()},e.hardware_id=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,(0,c.machineId)()];case 1:return[2,e.sent()]}}))}))},e}();t.SystemController=u},2355:(e,t)=>{function n(e){return"string"==typeof e}t.__esModule=!0,t.CoreType=t.isBooleanTrue=t.isString=void 0,t.isString=n,t.isBooleanTrue=function(e){return e};var o=function(){function e(){}return e.isString=n,e}();t.CoreType=o},7129:(e,t)=>{t.__esModule=!0,t.UrlHelper=void 0;var n=function(){function e(){}return e.sanitize=function(e){return e.replace(/([^:])\/\//g,"$1/")},e}();t.UrlHelper=n},4783:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.stringToUint8Array=void 0;var s=n(2456),a=i(n(3360));t.stringToUint8Array=function(e){return o(this,void 0,void 0,(function(){var t,n;return r(this,(function(o){return t=a.default.fileSync(),s.FsWrapped.writeFileSync(t.name,e),n=s.FsWrapped.readFileSync(t.name),t.removeCallback(),[2,n]}))}))}},9795:(e,t,n)=>{t.__esModule=!0,t.writeBrotliCompress=t.brotliBuffer=t.writeGzipCompress=t.gzipBuffer=void 0;var o=n(2456),r=n(9796);t.gzipBuffer=function(e,t){return void 0===t&&(t={}),(0,r.gzipSync)(e,t)};t.writeGzipCompress=function(e,n,r){void 0===r&&(r={});var i=(0,t.gzipBuffer)(n,r),s="".concat(e,".gz");return o.FsWrapped.writeFileSync(s,i),{filePath:s,gzippedBuffer:i}};t.brotliBuffer=function(e,t){return void 0===t&&(t={}),(0,r.brotliCompressSync)(e,t)};t.writeBrotliCompress=function(e,n,r){void 0===r&&(r={});var i=(0,t.brotliBuffer)(n,r),s="".concat(e,".br");return o.FsWrapped.writeFileSync(s,i),s}},5205:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.threeImportMapsOnResolve=void 0;var s=i(n(1017)),a=n(2822);function l(e){var t=e.path.split("."),n=t[t.length-1],o=s.join(a.CurrentPathController.NODE_MODULES_PATH,"".concat(e.path));return"js"!=n&&(o="".concat(o,".js")),"html"==n?{path:o,external:!0}:{path:o}}t.threeImportMapsOnResolve={name:"example",setup:function(e){e.onResolve({filter:/^three\/src/},l),e.onResolve({filter:/^three\/examples/},l)}}},336:(e,t)=>{t.__esModule=!0,t.StateError=void 0;var n=function(){function e(){}return e.prototype.errored=function(){return null!=this._message},e.prototype.setMessage=function(e){this._message=e},e.prototype.message=function(){return this._message},e.prototype.reset=function(){this._message=void 0},e}();t.StateError=n},8708:(e,t,n)=>{t.__esModule=!0,t.myVar=t.EditorApi=void 0;var o=n(4358);t.EditorApi=o.EditorApi,t.myVar=o.myVar},8215:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t};t.__esModule=!0,t.FileReaderController=void 0;var l=n(2456),c=a(n(1017)),u=n(7221),p=n(2992),d=n(5849),f=function(e){function t(t){var n=e.call(this,t)||this;return n.main_controller=t,n}return r(t,e),t.prototype.readJSON=function(e,t,n){var o=this.main_controller.project_config.config(),r=t==p.JsonDestFolder.PUBLIC?o.public_scene_folder:o.src_scene_folder,i="".concat(e,".json"),s=c.join(r,i);if(l.FsWrapped.existsSync(s))return JSON.parse(l.FsWrapped.readFileSync(s,"utf-8"));var a=!0;n&&null!=n.displayError&&(a=n.displayError),a&&d.Logger.error("file '".concat(e,"' not found"))},t.prototype.readText=function(e,t){var n=this.main_controller.project_config.config().public_scene_folder,o=c.join(n,e);if(l.FsWrapped.existsSync(o))return l.FsWrapped.readFileSync(o,"utf-8");var r=!0;t&&null!=t.displayError&&(r=t.displayError),r&&d.Logger.error("file '".concat(e,"' not found"))},t}(u.BaseController);t.FileReaderController=f},2992:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&i(t,e,n);return s(t,e),t},l=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}};t.__esModule=!0,t.FileWriterController=t.JsonDestFolder=void 0;var u,p=n(2456),d=a(n(1017)),f=a(n(4470)),h=n(7221),_=n(5849),m=n(9250),g=n(731);!function(e){e.SRC="src",e.PUBLIC="public"}(u=t.JsonDestFolder||(t.JsonDestFolder={}));var v=function(e){function t(t){var n=e.call(this,t)||this;return n.main_controller=t,n}return r(t,e),t.write_text_file_and_create_folders=function(e){var t=e.file,n=d.dirname(t);p.FsWrapped.existsSync(n)||p.FsWrapped.mkdirSync(n,{recursive:!0});var o=e.prettier?m.PrettierController.formatAny(t,e.content):e.content;f.writeFileSync(t,o,"utf-8"),_.Logger.file(t)},t.prototype.codeFilesFolder=function(){return this.main_controller.project_config.config().src_scene_folder},t.prototype.writeCode=function(e){var n=this.codeFilesFolder(),o=d.join(n,e.file);t.write_text_file_and_create_folders({file:o,content:e.content,prettier:!0})},t.prototype.writeGLSL=function(e){var n=this.main_controller.project_config.config().public_scene_folder,o=d.join(n,e.file);t.write_text_file_and_create_folders({file:o,content:e.content,prettier:!1})},t.prototype.writeTXT=function(e){var n=this.main_controller.project_config.config().public_scene_folder,o=d.join(n,e.file);t.write_text_file_and_create_folders({file:o,content:e.content,prettier:!1})},t.prototype.write_scene_data=function(e,t){void 0===t&&(t=u.PUBLIC),this._write_json(e,t)},t.prototype._write_json=function(e,t){var n=this.main_controller.project_config.config(),o=t==u.PUBLIC?n.public_scene_folder:n.src_scene_folder,r="".concat(e.file,".json"),i=d.join(o,r),s=d.dirname(i);p.FsWrapped.existsSync(s)||p.FsWrapped.mkdirSync(s,{recursive:!0});var a=m.PrettierController.formatJSON(JSON.stringify(e.content,null,"\t"));p.FsWrapped.writeFileSync(i,a),_.Logger.file(i)},t.prototype.backupSceneData=function(){return l(this,void 0,void 0,(function(){var e,t,n,o,r;return c(this,(function(i){switch(i.label){case 0:if(e=this.main_controller.project_config.config(),t=e.public_scene_folder,n=e.public_scene_backup_folder,o=new Date,!p.FsWrapped.existsSync(t))return[2];r="".concat(o.getFullYear(),"_").concat(o.getMonth(),"_").concat(o.getDate(),"__").concat(o.getHours(),"h").concat(o.getMinutes(),"m"),i.label=1;case 1:return i.trys.push([1,3,,4]),_.Logger.log("backing up folder ".concat(t," to ").concat(n)),[4,new g.BackupZipController({publicFolder:t,backupFolder:n,backupName:r}).createZip()];case 2:return i.sent(),_.Logger.log("backup completed"),[3,4];case 3:return i.sent(),_.Logger.log("!!! backup failed to be saved !!!"),[3,4];case 4:return[2]}}))}))},t.prototype.clear_scene_data=function(){var e=this.main_controller.project_config.config().public_scene_folder;p.FsWrapped.existsSync(e)?(_.Logger.log("deleting folder ".concat(e)),p.FsWrapped.removeSync(e),_.Logger.log("folder ".concat(e," deleted"))):_.Logger.log("cannot clear scene public folder")},t}(h.BaseController);t.FileWriterController=v},9001:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.SceneDataCache=void 0;var s=n(7633),a=n(2992),l=i(n(1017)),c=n(4249),u=function(){function e(e){this.mainController=e,this._nodesMap=new Map,this._shadersMap=new Map,this._jsFunctionBodiesMap=new Map}return e.prototype._reset=function(){this._properties=void 0,this._root=void 0,this._nodesMap.clear(),this._shadersMap.clear(),this._jsFunctionBodiesMap.clear()},e.prototype.load_scene_data=function(){var e=this;this._reset();var t=this.mainController.manifest.content();if(t){var n=this.mainController.file_reader.readJSON(s.OutFileName.PROPERTIES,a.JsonDestFolder.PUBLIC);n&&(this._properties=JSON.stringify(n));var o=this.mainController.file_reader.readJSON(s.OutFileName.ROOT,a.JsonDestFolder.PUBLIC);o&&(this._root=JSON.stringify(o));for(var r=0,i=Object.keys(t.nodes||{});r<i.length;r++){var u=i[r],p=this.mainController.file_reader.readJSON(l.join(s.OutFileName.ROOT,u),a.JsonDestFolder.PUBLIC);p&&this._nodesMap.set(u,JSON.stringify(p))}!function(){for(var n=0,o=Object.keys(t.shaders||{});n<o.length;n++)for(var r=o[n],i=t.shaders[r],s=0,a=Object.keys(i||{});s<a.length;s++){var l=a[s],u=(0,c.shaderFilePath)({nodePath:r,shaderName:l}),p=e.mainController.file_reader.readText(u);if(p){var d=e._shadersMap.get(r);d||(d=new Map,e._shadersMap.set(r,d)),d.set(l,p)}}}(),function(){for(var n=0,o=Object.keys(t.jsFunctionBodies||{});n<o.length;n++){var r=o[n],i=(0,c.jsFunctionBodyFilePath)({nodePath:r}),s=e.mainController.file_reader.readText(i);s&&e._jsFunctionBodiesMap.set(r,s)}}()}},e.prototype.hasPropertiesChanged=function(e){return!this._properties||JSON.stringify(e)!=this._properties},e.prototype.hasRootChanged=function(e){return!this._root||JSON.stringify(e)!=this._root},e.prototype.hasNodeDataChanged=function(e,t){var n=this._nodesMap.get(e);return!n||JSON.stringify(t)!=n},e.prototype.hasShaderChanged=function(e){var t=e.nodePath,n=e.shaderName,o=e.newShader,r=this._shadersMap.get(t);if(!r)return!0;var i=r.get(n);return!i||i!=o},e.prototype.hasJsFunctionBodyChanged=function(e){var t=e.nodePath,n=e.newJsFunctionBody,o=this._jsFunctionBodiesMap.get(t);return!o||o!=n},e}();t.SceneDataCache=u},7221:(e,t)=>{t.__esModule=!0,t.BaseController=void 0;var n=function(e){this.main_controller=e};t.BaseController=n},2456:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.FsWrapped=void 0;var s=i(n(4470)),a=n(5849),l=function(){function e(){}return e.readFileSync=function(e,t){try{return s.readFileSync(e,t)}catch(t){a.Logger.error("fail to read file '".concat(e,"'"))}},e.readdirSync=function(e){try{return s.readdirSync(e)}catch(t){return a.Logger.error("fail to list files in directory '".concat(e,"'")),[]}},e.writeFileSync=function(e,t){try{return s.writeFileSync(e,t)}catch(t){a.Logger.error("fail to write to file '".concat(e,"'"))}},e.appendFileSync=function(e,t){try{return s.appendFileSync(e,t)}catch(t){a.Logger.error("fail to append to file '".concat(e,"'"))}},e.unlinkSync=function(e){try{return s.unlinkSync(e)}catch(t){a.Logger.error("fail to unlink file '".concat(e,"'"))}},e.removeSync=function(e){try{return s.removeSync(e)}catch(t){a.Logger.error("fail to remove file '".concat(e,"'"))}},e.renameSync=function(e,t){try{return s.renameSync(e,t)}catch(n){a.Logger.error("fail to name file '".concat(e,"' to '").concat(t,"'"))}},e.existsSync=function(e){try{return s.existsSync(e)}catch(t){return a.Logger.error("fail to check if file '".concat(e,"' exists")),!1}},e.statSync=function(e){try{return s.statSync(e)}catch(t){a.Logger.error("fail to get stats of file '".concat(e,"'"))}},e.lstatSync=function(e){try{return s.lstatSync(e)}catch(t){a.Logger.error("fail to get lstats of file '".concat(e,"'"))}},e.mkdirSync=function(e,t){try{return s.mkdirSync(e,t)}catch(t){a.Logger.error("fail to get stats of file '".concat(e,"'"))}},e.rmdirSync=function(e,t){try{return s.rmdirSync(e,t)}catch(t){console.log(t),a.Logger.error("fail to rmdirSync '".concat(e,"'"))}},e.watch=function(e,t){try{return s.watch(e,t)}catch(t){a.Logger.error("fail to get stats of file '".concat(e,"'"))}},e.copyFileSync=function(e,t){try{return s.copyFileSync(e,t)}catch(n){a.Logger.error("fail to copy file '".concat(e,"' to '").concat(t,"'"))}},e.copySync=function(e,t){try{return s.copySync(e,t)}catch(n){a.Logger.error("fail to copy file '".concat(e,"' to '").concat(t,"'"))}},e.createWriteStream=function(e){try{return s.createWriteStream(e)}catch(t){a.Logger.error("fail to create writeStream for file '".concat(e,"'"))}},e}();t.FsWrapped=l},8479:(e,t,n)=>{t.__esModule=!0,t.MainExporterController=t.SceneExportType=void 0;var o=n(4634),r=n(1209),i=n(2643),s=n(9251),a=n(5354),l=n(5770);!function(e){e.TYPESCRIPT="typescript",e.JAVASCRIPT="javascript",e.HTML="html"}(t.SceneExportType||(t.SceneExportType={}));var c=function(){function e(e){this.tmpConfig=e,this.node_imports_controller=new i.NodesImportsController(this),this.operation_imports_controller=new s.OperationsImportsController(this),this.jsFunctionsImportsController=new l.JsFunctionsImportsController(this),this.registers_controller=new o.RegisterController(this),this.scene_node_types_controller=new r.SceneNodeTypesController(this),this.plugins_controller=new a.PluginsController(this)}return e.prototype.errored=function(){return null!=this._error_message},e.prototype.error_message=function(){return this._error_message},e.prototype.config=function(){return this._valid_config},e.prototype.run=function(){this._error_message=void 0;var e=this._checkConfigValid();if(!e)return this._valid_config=this.tmpConfig,this.node_imports_controller.setNodes(this._valid_config.scene.nodes),this.operation_imports_controller.setOperations(this._valid_config.scene.operations),this.jsFunctionsImportsController.setJsFunctions(this._valid_config.scene.jsFunctionTypes),this.registers_controller.run(),this._error_message=this._error_message||this.registers_controller.error_message(),this.scene_node_types_controller.run(),this._error_message=this._error_message||this.scene_node_types_controller.error_message(),{error:this._error_message,register:this.registers_controller.content(),scene_node_types:this.scene_node_types_controller.content()};this._error_message="MainExporterController: config is invalid (".concat(e,")")},e.prototype._checkConfigValid=function(){var e=this.tmpConfig.scene;if(!e)return"no scene_data";if(!e.engine_version)return"no engine_version";if(!e.name)return"no name";if(!e.nodes)return"no nodes";if(!e.jsFunctionTypes)return"no jsFunctionTypes";if(!e.modules)return"no modules";if(!e.assemblers)return"no assemblers";if(!e.integrations)return"no integrations";if(!e.code)return"no code";if(!e.nodes_map)return"no nodes_map";if(!e.plugins_data)return"no plugins_data";var t=this.tmpConfig.project;return t?t.project_root?t.polygonjs_engine_root?t.src_scene_folder?t.public_root?t.public_scene_folder?void 0:"no export_data.public_scene_folder":"no export_data.public_root":"no export_data.src_scene_folder":"no polygonjs_engine_root":"no project_root":"no project_data"},e}();t.MainExporterController=c},5354:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.PluginsController=void 0;var i=n(8637),s="@polygonjs/polygonjs",a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.is_node_from_plugins=function(e,t){return null!=this._nodeImportRoot(e,t)},t.prototype.is_operation_from_plugins=function(e,t){return null!=this._operationImportRoot(e,t)},t.prototype.nodeImportPath=function(e){var t=e.node_context,n=e.node_type,o=e.fileShortName,r=this._nodeImportRoot(t,n);return r||"".concat(s,"/src/engine/nodes/").concat(t,"/").concat(o)},t.prototype.operationImportPath=function(e){var t=e.operation_context,n=e.operation_type,o=e.fileShortName,r=this._operationImportRoot(t,n);return r||"".concat(s,"/src/engine/operations/").concat(t,"/").concat(o)},t.prototype.jsFunctionImportPath=function(e){var t=e.jsFunctionType,n=e.fileShortName,o=this._jsFunctionImportRoot(t);return o||"".concat(s,"/src/engine/functions/").concat(n)},t.prototype._nodeImportRoot=function(e,t){var n=this.mainController.config();if(n){var o=n.scene.plugins_data;if(o){var r=o.nodes;if(r){var i=r[e];if(i){var s=i[t];if(s){console.log("node ".concat(e,"/").concat(t," is from plugin ").concat(s));var a=o.plugins[s];if(a)return a.libraryImportPath}}}}}},t.prototype._operationImportRoot=function(e,t){var n=this.mainController.config();if(n){var o=n.scene.plugins_data;if(o){var r=o.operations;if(r){var i=r[e];if(i){var s=i[t];if(s){var a=o.plugins[s];if(a)return a.libraryImportPath}}}}}},t.prototype._jsFunctionImportRoot=function(e){var t=this.mainController.config();if(t){var n=t.scene.plugins_data;if(n){var o=n.jsFunctions;if(o){var r=o[e];if(r){var i=n.plugins[r];if(i)return i.libraryImportPath}}}}},t}(i.BaseController);t.PluginsController=a},4634:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.RegisterController=void 0;var i=n(7112),s=n(4314),a=n(9957),l=n(7160),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._content="",t}return r(t,e),t.prototype.content=function(){return this._content},t.prototype.run=function(){var e=this.mainController.config();if(e&&e.scene.engine_version){var t=e.scene,n=t.nodes,o=t.operations,r=t.jsFunctionTypes;this.mainController.node_imports_controller.run(),this.mainController.operation_imports_controller.run(),this.mainController.jsFunctionsImportsController.run();var i=new s.NodesRegister(this.mainController,n,this.mainController.node_imports_controller),c=new a.OperationsRegister(this.mainController,o,this.mainController.operation_imports_controller),u=new l.JsFunctionsRegister(this.mainController,r,this.mainController.jsFunctionsImportsController);i.run(),c.run(),u.run();var p={nodesRegister:i,operationsRegister:c,jsFunctionsRegister:u};return this._runV2(p)}},t.prototype._runV2=function(e){var t=e.nodesRegister,n=e.operationsRegister,o=e.jsFunctionsRegister,r="\n".concat(t.import_lines_except_plugins.join(i.LINES_SEPARATOR),"\n").concat(n.import_lines_except_plugins.join(i.LINES_SEPARATOR),"\n").concat(o.import_lines_except_plugins.join(i.LINES_SEPARATOR),"\n\nexport const <%= constantName %> = {\n\tnodes: [\n\t\t").concat(t.classNames.join(",".concat(i.LINES_SEPARATOR,"\t\t")),"\n\t],\n\toperations: [\n\t\t").concat(n.classNames.join(",".concat(i.LINES_SEPARATOR,"\t\t")),"\n\t],\n\tjsFunctions: [\n\t\t").concat(o.classNames.join(",".concat(i.LINES_SEPARATOR,"\t\t")),"\n\t]\n}\n");this._content=r},t}(n(8637).BaseController);t.RegisterController=c},1209:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.SceneNodeTypesController=void 0;var i=n(7112),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._content="",t}return r(t,e),t.prototype.content=function(){return this._content},t.prototype.run=function(){var e=this.mainController.config();if(e&&e.scene.engine_version){for(var t=this.mainController.node_imports_controller,n=e.scene.nodes_map,o=new Map,r=[],s=[],a=0,l=Object.keys(n);a<l.length;a++){var c=l[a],u=n[c],p=t.node_class(u),d=t.file_path(u);if(p&&d){if(!o.get(p)){o.set(p,!0);var f="import {".concat(p,"} from '").concat(d,"';");s.push(f)}var h="\tnode(path: '".concat(c,"'): ").concat(p,";");r.push(h)}}s=this._sort_and_comment_import_lines(s);var _="\nimport {PolyScene} from '@polygonjs/polygonjs/src/engine/scene/PolyScene';\n".concat(s.join(i.LINES_SEPARATOR),"\n\nexport class PolySceneWithNodeMap_<%= sceneName %> extends PolyScene {\n").concat(r.join(i.LINES_SEPARATOR),"\n\tnode(path: string):any /* we need any for now as otherwise an error occurs when adding plugins to the overloaded methods */ {\n\t\treturn super.node(path);\n\t}\n}\n");this._content=_}},t.prototype._sort_and_comment_import_lines=function(e){for(var t=[],n=new Map,o=0,r=e;o<r.length;o++){var i=r[o],s=i.split("/"),a=s[s.length-2],l=n.get(a);l||(l=[],n.set(a,l)),l.push(i)}return n.forEach((function(e,n){t.push("// ".concat(n)),e.sort();for(var o=0,r=e;o<r.length;o++){var i=r[o];t.push(i)}})),t},t.FILENAME_SHORT="PolySceneWithNodesPath.d",t}(n(8637).BaseController);t.SceneNodeTypesController=s},8637:(e,t)=>{t.__esModule=!0,t.BaseController=void 0;var n=function(){function e(e){this.mainController=e}return e.prototype.error_message=function(){return this._error_message},e.prototype.errored=function(){return null!=this._error_message},e}();t.BaseController=n},5770:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.JsFunctionsImportsController=void 0;var i=n(6441),s=function(e){function t(t){var n=e.call(this,t)||this;return n.jsFunctions=[],n.import_lines=[],n.register_lines=[],n._jsFunctionClassByType=new Map,n._filePathByType=new Map,n.file_finder=new i.FileFinder(t),n}return r(t,e),t.prototype.setJsFunctions=function(e){for(;this.jsFunctions.pop(););for(var t=0,n=e;t<n.length;t++){var o=n[t];this.jsFunctions.push(o)}},t.prototype.run=function(){this._jsFunctionClassByType.clear(),this._filePathByType.clear();for(var e=0,t=this.jsFunctions;e<t.length;e++){var n=t[e];this._find_operation_import_and_register_lines(n)}},t.prototype.jsFunctionClass=function(e){return this._jsFunctionClassByType.get(e)},t.prototype.file_path=function(e){return this._filePathByType.get(e)},t.prototype._find_operation_import_and_register_lines=function(e){var t=e,n=t;if(this.file_finder.jsFunctionsFolder()){var o=this.file_finder.expectedJsFunctionClass(e),r=this.mainController.plugins_controller.jsFunctionImportPath({jsFunctionType:t,fileShortName:n});if(!r)throw"no file found for ".concat(t);if(!o)throw"no imported_class found for ".concat(t);this._jsFunctionClassByType.set(t,o),this._filePathByType.set(t,r)}},t}(n(967).BaseImportsController);t.JsFunctionsImportsController=s},2643:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.NodesImportsController=void 0;var i=n(6441),s=n(967),a=n(7112),l=function(e){function t(t){var n=e.call(this,t)||this;return n.nodes=[],n.import_lines=[],n.register_lines=[],n._node_class_by_node_context_and_type=new Map,n._file_path_by_node_context_and_type=new Map,n.file_finder=new i.FileFinder(n.mainController),n}return r(t,e),t.prototype.setNodes=function(e){for(;this.nodes.pop(););for(var t=0,n=e;t<n.length;t++){var o=n[t];this.nodes.push(o)}},t.prototype.run=function(){this._node_class_by_node_context_and_type.clear(),this._file_path_by_node_context_and_type.clear();for(var e=0,t=this.nodes;e<t.length;e++){var n=t[e];this._find_node_import_and_register_lines(n)}},t.prototype.node_class=function(e){return this._node_class_by_node_context_and_type.get(e)},t.prototype.file_path=function(e){return this._file_path_by_node_context_and_type.get(e)},t.prototype._find_node_import_and_register_lines=function(e){var t=e.split("/"),n=t[0],o=t[1];if(!this._find_poly_node(e)){var r=a.CoreString.camelize(o);if(this.file_finder.nodes_folder()){var i=this.file_finder.expected_node_class(n,o),s=this.mainController.plugins_controller.nodeImportPath({node_context:n,node_type:o,fileShortName:r});if(!s)throw"no file found for ".concat(o);if(!i)throw"no imported_class found for ".concat(o);this._node_class_by_node_context_and_type.set(e,i),this._file_path_by_node_context_and_type.set(e,s)}}},t.prototype._find_poly_node=function(e){var t=this.mainController.config();return!!t&&t.scene.poly_nodes.includes(e)},t}(s.BaseImportsController);t.NodesImportsController=l},9251:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.OperationsImportsController=void 0;var i=n(7112),s=n(6441),a=function(e){function t(t){var n=e.call(this,t)||this;return n.operations=[],n.import_lines=[],n.register_lines=[],n._operation_class_by_node_context_and_type=new Map,n._file_path_by_node_context_and_type=new Map,n.file_finder=new s.FileFinder(t),n}return r(t,e),t.prototype.setOperations=function(e){for(;this.operations.pop(););for(var t=0,n=e;t<n.length;t++){var o=n[t];this.operations.push(o)}},t.prototype.run=function(){this._operation_class_by_node_context_and_type.clear(),this._file_path_by_node_context_and_type.clear();for(var e=0,t=this.operations;e<t.length;e++){var n=t[e];this._find_operation_import_and_register_lines(n)}},t.prototype.operation_class=function(e){return this._operation_class_by_node_context_and_type.get(e)},t.prototype.file_path=function(e){return this._file_path_by_node_context_and_type.get(e)},t.prototype._find_operation_import_and_register_lines=function(e){var t=e.split("/"),n=t[0],o=t[1],r=i.CoreString.camelize(o);if(this.file_finder.operations_folder()){var s=this.file_finder.expected_operation_class(n,o),a=this.mainController.plugins_controller.operationImportPath({operation_context:n,operation_type:o,fileShortName:r});if(!a)throw"no file found for ".concat(o);if(!s)throw"no imported_class found for ".concat(o);this._operation_class_by_node_context_and_type.set(e,s),this._file_path_by_node_context_and_type.set(e,a)}},t}(n(967).BaseImportsController);t.OperationsImportsController=a},967:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.BaseImportsController=void 0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(n(8637).BaseController);t.BaseImportsController=i},7160:(e,t)=>{t.__esModule=!0,t.JsFunctionsRegister=void 0;var n=function(){function e(e,t,n){this.mainController=e,this.jsFunctions=t,this.jsFunctionsImportsController=n,this.import_lines=[],this.import_lines_except_plugins=[],this.register_lines=[],this.classNames=[],this.import_contexts=new Set,this.import_contexts_except_plugins=new Set,this.register_contexts=new Set}return e.prototype.run=function(){this.jsFunctions.sort();for(var e=0,t=this.jsFunctions;e<t.length;e++){var n=t[e];this.operation_import_and_register_lines(n)}},e.prototype.operation_import_and_register_lines=function(e){var t=e.split("/"),n=t[0],o=t[1],r=this.jsFunctionsImportsController.jsFunctionClass(e),i=this.jsFunctionsImportsController.file_path(e),s=this.mainController.plugins_controller.is_node_from_plugins(n,o);if(r&&i){var a="named functions";this.import_contexts.has(a)||(this.import_contexts.add(a),this.import_lines.push("// ".concat(a))),s||this.import_contexts_except_plugins.has(a)||(this.import_contexts_except_plugins.add(a),this.import_lines_except_plugins.push("// ".concat(a))),this.register_contexts.has(a)||(this.register_contexts.add(a),this.register_lines.push("\t\t// ".concat(a))),this.import_lines.push("import {".concat(r,"} from '").concat(i,"'")),s||this.import_lines_except_plugins.push("import {".concat(r,"} from '").concat(i,"'")),this.register_lines.push("\t\tPoly.registerOperation(".concat(r,");")),this.classNames.push(r)}},e}();t.JsFunctionsRegister=n},4314:(e,t)=>{t.__esModule=!0,t.NodesRegister=void 0;var n=function(){function e(e,t,n){this.mainController=e,this.nodes=t,this.node_imports_controller=n,this.import_lines=[],this.import_lines_except_plugins=[],this.register_lines=[],this.classNames=[],this.import_contexts=new Set,this.import_contexts_except_plugins=new Set,this.register_contexts=new Set}return e.prototype.run=function(){this.nodes.sort();for(var e=0,t=this.nodes;e<t.length;e++){var n=t[e];this.node_import_and_register_lines(n)}},e.prototype.node_import_and_register_lines=function(e){var t=e.split("/"),n=t[0],o=t[1],r=this.node_imports_controller.node_class(e),i=this.node_imports_controller.file_path(e),s=this.mainController.plugins_controller.is_node_from_plugins(n,o);r&&i&&(this.import_contexts.has(n)||(this.import_contexts.add(n),this.import_lines.push("// ".concat(n))),s||(this.import_contexts_except_plugins.has(n)||(this.import_contexts_except_plugins.add(n),this.import_lines_except_plugins.push("// ".concat(n))),this.register_contexts.has(n)||(this.register_contexts.add(n),this.register_lines.push("\t\t// ".concat(n)))),this.import_lines.push("import {".concat(r,"} from '").concat(i,"';")),s||(this.import_lines_except_plugins.push("import {".concat(r,"} from '").concat(i,"';")),this.register_lines.push("\t\tPoly.registerNode(".concat(r,");")),this.classNames.push(r)))},e}();t.NodesRegister=n},9957:(e,t)=>{t.__esModule=!0,t.OperationsRegister=void 0;var n=function(){function e(e,t,n){this.mainController=e,this.operations=t,this.operations_imports_controller=n,this.import_lines=[],this.import_lines_except_plugins=[],this.register_lines=[],this.classNames=[],this.import_contexts=new Set,this.import_contexts_except_plugins=new Set,this.register_contexts=new Set}return e.prototype.run=function(){this.operations.sort();for(var e=0,t=this.operations;e<t.length;e++){var n=t[e];this.operation_import_and_register_lines(n)}},e.prototype.operation_import_and_register_lines=function(e){var t=e.split("/"),n=t[0],o=t[1],r=this.operations_imports_controller.operation_class(e),i=this.operations_imports_controller.file_path(e),s=this.mainController.plugins_controller.is_node_from_plugins(n,o);if(r&&i){var a=e.split("/")[0];this.import_contexts.has(a)||(this.import_contexts.add(a),this.import_lines.push("// ".concat(a))),s||this.import_contexts_except_plugins.has(a)||(this.import_contexts_except_plugins.add(a),this.import_lines_except_plugins.push("// ".concat(a))),this.register_contexts.has(a)||(this.register_contexts.add(a),this.register_lines.push("\t\t// ".concat(a))),this.import_lines.push("import {".concat(r,"} from '").concat(i,"'")),s||this.import_lines_except_plugins.push("import {".concat(r,"} from '").concat(i,"'")),this.register_lines.push("\t\tPoly.registerOperation(".concat(r,");")),this.classNames.push(r)}},e}();t.OperationsRegister=n},6441:function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t};t.__esModule=!0,t.FileFinder=void 0;var s=i(n(1017)),a=n(7112),l=function(){function e(e){this.mainController=e}return e.prototype._classPrefix=function(e,t){return"".concat(a.CoreString.camelize(t)).concat(a.CoreString.camelize(e))},e.prototype.expected_node_class=function(e,t){return"".concat(this._classPrefix(e,t),"Node")},e.prototype.expected_operation_class=function(e,t){return"".concat(this._classPrefix(e,t),"Operation")},e.prototype.expectedJsFunctionClass=function(e){return e},e.prototype.nodes_folder=function(){var e=this.mainController.config();if(e)return s.join(e.project.polygonjs_engine_root,"src/engine/nodes")},e.prototype.operations_folder=function(){var e=this.mainController.config();if(e)return s.join(e.project.polygonjs_engine_root,"src/engine/operations")},e.prototype.jsFunctionsFolder=function(){var e=this.mainController.config();if(e)return s.join(e.project.polygonjs_engine_root,"src/engine/functions")},e}();t.FileFinder=l},7112:(e,t)=>{t.__esModule=!0,t.CoreString=t.LINES_SEPARATOR=void 0,t.LINES_SEPARATOR="\n";var n=function(){function e(){}return e.camelize=function(e){for(var t,n=e.split(""),o="",r=!1;t=n.shift();)"_"==t?r=!0:(r?(t=t.toUpperCase(),r=!1):0==o.length&&(t=t.toUpperCase()),o+=t);return o},e}();t.CoreString=n},3607:function(e,t,n){e=n.nmd(e);var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var r=Object.getOwnPropertyDescriptor(t,n);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,r)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return r(t,e),t},s=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0;var c=l(n(6860)),u=i(n(1017)),p=n(8160),d=n(6231),f=n(5849),h=n(5022),_=n(2355),m=n(4859),g=n(7099).ServerVersionController.version();var v=i(n(9760)).scriptName("polygon").usage("$0 [args]").usage("Usage: $0").usage("Usage: $0 --port=8092").usage("Usage: $0 --export [sceneName]").option("export",{alias:"e",description:"sceneName",type:"string"}).option("port",{alias:"t",description:"8091 will allow you to open the editor on http://localhost:8091 (default: ".concat(8091,")"),type:"number"}).help().alias("help","h").argv,y=parseInt("".concat(v.port))||8091,S=(0,c.default)();t.default={},S.use(c.default.json({limit:"50mb"}));var b=l(n(3582));S.use((0,b.default)());u.join(u.resolve(__dirname),"../public");var A=u.join(u.resolve(__dirname),"../public");S.use(c.default.static(A)),c.default.static.mime.types.wasm="application/wasm";var C=new p.MainController,w=A;function E(e,t){return s(this,void 0,void 0,(function(){var n,o;return a(this,(function(r){switch(r.label){case 0:return f.Logger.req(e,"(renderApp)"),i="editor/index",n=u.join(w,"".concat(i,".html")),[4,C.editorPage.pageWithEditorConfig(n)];case 1:return o=r.sent(),t.send(o),[2]}var i}))}))}S.get(d.LocalServerUrl.ROOT,E);for(var P,O=[d.Route.DOCS],j=[d.Route.SCENE_NEW,d.Route.SCENE_EDIT,d.Route.SCENE_SETTINGS,d.Route.EXAMPLE],x=0,T=O;x<T.length;x++){for(var L=[B=T[x],"".concat(B,"/*")],N=0,F=d.EDITOR_ROUTES;N<F.length;N++){var M=F[N];L.push("".concat(M,"/").concat(M))}for(var D=0,R=L;D<R.length;D++){var k=R[D];S.get(k,E)}}for(var I=0,U=j;I<U.length;I++){L=[B=U[I]];for(var B,W=0,Y=d.EDITOR_ROUTES;W<Y.length;W++){M=Y[W];L.push("".concat(B,"/").concat(M))}for(var q=0,J=L;q<J.length;q++){k=J[q];S.get(k,E)}}function H(e,t){try{(P=e.listen(t,(function(){}))).listening&&function(e,t){s(this,void 0,void 0,(function(){var n,o;return a(this,(function(r){return n=C.sceneLoader.sceneNames(),o="http://localhost:".concat(e),f.Logger.log("==================================="),f.Logger.log(""),f.Logger.log("Polygonjs Editor (".concat(g,") started on: ").concat(h.green(o))),n.length,f.Logger.log(""),f.Logger.log("==================================="),P?(C.multiPlayer.setPort(e),C.socket.setInitData({port:e,server:P,express:t}),C.socket.start(),[2]):[2]}))}))}(t,e)}catch(e){}}S.post(d.LocalServerUrl.TOKEN_CREATE,(function(e,t){C.authentication.createToken(e,t)})),S.get(d.LocalServerUrl.TOKEN_GET,(function(e,t){C.authentication.showToken(e,t)})),S.delete(d.LocalServerUrl.LOGOUT,(function(e,t){C.authentication.logout(e,t)})),S.get(d.LocalServerUrl.POLY_CONFIG_LOAD,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return f.Logger.req(e),[4,C.poly_config.load(e,t)];case 1:return n.sent(),[2]}}))}))})),S.get(d.LocalServerUrl.EDITOR_CONFIG_LOAD,(function(e,t){return s(void 0,void 0,void 0,(function(){var n;return a(this,(function(o){switch(o.label){case 0:return f.Logger.req(e),[4,C.editor_config.load()];case 1:return n=o.sent(),t.type(".js"),t.send(n),[2]}}))}))})),S.get(d.LocalServerUrl.SCENES,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.sceneLoader.index(e,t),[2]}))}))})),S.get(d.LocalServerUrl.SCENE_LOAD,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.sceneLoader.load(e,t),[2]}))}))})),S.post(d.LocalServerUrl.SCENE_SAVE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.sceneSaver.save(e,t),[2]}))}))})),S.post(d.LocalServerUrl.SCENE_UPDATE_NAME,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.sceneSaver.updateName(e,t),[2]}))}))})),S.post(d.LocalServerUrl.SCENE_DELETE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.sceneSaver.delete(e,t),[2]}))}))})),S.post(d.LocalServerUrl.SHARE_SCENE_UPLOAD,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.share.uploadScene(e,t),[2]}))}))})),S.post(d.LocalServerUrl.SHARE_ZIP,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.share.createZip(e,t),[2]}))}))})),S.get(d.LocalServerUrl.POLY_NODES_INDEX,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.polyNodes.index(e,t),[2]}))}))})),S.post(d.LocalServerUrl.POLY_NODE_CREATE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.polyNodes.create(e,t),[2]}))}))})),S.post(d.LocalServerUrl.POLY_NODE_UPDATE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.polyNodes.update(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MARKETPLACE_POLY_NODES_INDEX,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.marketplacePolyNodes.index(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MARKETPLACE_POLY_NODES_SEARCH,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.marketplacePolyNodes.search(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MARKETPLACE_POLY_NODES_DOWNLOAD,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.marketplacePolyNodes.download(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MARKETPLACE_POLY_NODES_UPLOAD,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.marketplacePolyNodes.upload(e,t),[2]}))}))})),S.post(d.LocalServerUrl.CAPTURE_ANIMATION_SAVE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.capture.saveAnimation(e,t),[2]}))}))})),S.post(d.LocalServerUrl.CAPTURE_STATUS_REQUEST,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.capture.requestStatus(e,t),[2]}))}))})),S.post(d.LocalServerUrl.CAPTURE_STATIC_SAVE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.capture.saveStatic(e,t),[2]}))}))})),S.get(d.LocalServerUrl.CAPTURE_STATIC_LOAD,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.capture.loadStatic(e,t),[2]}))}))})),S.post(d.LocalServerUrl.CAPTURE_ANIMATION_FRAME_SAVE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.capture.saveAnimationFrame(e,t),[2]}))}))})),S.post(d.LocalServerUrl.CAPTURE_ANIMATION_FRAME_LOAD,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.capture.loadAnimationFrame(e,t),[2]}))}))})),S.post(d.LocalServerUrl.INSTALL_DRACO,(function(e,t){f.Logger.req(e),C.libs.installDraco(e,t)})),S.post(d.LocalServerUrl.INSTALL_KTX2,(function(e,t){f.Logger.req(e),C.libs.installKTX2(e,t)})),S.post(d.LocalServerUrl.INSTALL_XATLAS,(function(e,t){f.Logger.req(e),C.libs.installXAtlas(e,t)})),S.post(d.LocalServerUrl.INSTALL_OCCT,(function(e,t){f.Logger.req(e),C.libs.installOCCT(e,t)})),S.post(d.LocalServerUrl.INSTALL_MANIFOLD,(function(e,t){f.Logger.req(e),C.libs.installManifold(e,t)})),S.post(d.LocalServerUrl.MULTIPLAYER_SESSION_CHECK_CREATION_ALLOWED,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.sessions.checkCreationAllowed(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_SESSION_CREATE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.multiPlayer.sessions.create(e,t),[2]}))}))})),S.get(d.LocalServerUrl.MULTIPLAYER_SESSION_SHOW,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.multiPlayer.sessions.show(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_SESSION_DESTROY,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.multiPlayer.sessions.destroy(e,t),[2]}))}))})),S.get(d.LocalServerUrl.MULTIPLAYER_USER_REQUEST_INDEX,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.multiPlayer.userRequests.index(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_USER_REQUEST_CREATE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.multiPlayer.userRequests.create(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_USER_REQUEST_APPROVE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.userRequests.approve(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_USER_REQUEST_REJECT,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.userRequests.reject(e,t),[2]}))}))})),S.get(d.LocalServerUrl.MULTIPLAYER_USER_INDEX,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.multiPlayer.users.index(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_USER_DESTROY,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.multiPlayer.users.destroy(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_USER_BAN,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.multiPlayer.users.ban(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_USER_UNBAN,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.multiPlayer.users.unban(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_AWARENESS_UPDATE_PATH,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.awareness.setPath(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_AWARENESS_UPDATE_POSITION,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.awareness.setPosition(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_AWARENESS_UPDATE_CAMERA,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.awareness.setCamera(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_COMMAND_REQUEST,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.commands.requestCommand(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_COMMAND_UPDATE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.commands.updateCommand(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_UNDO_REQUEST,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.commands.requestUndo(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_REDO_REQUEST,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.commands.requestRedo(e,t),[2]}))}))})),S.post(d.LocalServerUrl.MULTIPLAYER_SCENE_DATA_SAVE,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return C.multiPlayer.sceneData.save(e,t),[2]}))}))})),S.get(d.LocalServerUrl.PLUGIN_FIGMA_PING,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return f.Logger.req(e),[4,C.plugins.figma.ping(e,t)];case 1:return n.sent(),[2]}}))}))})),S.get(d.LocalServerUrl.STATUS,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.status.processStatusRequest(e,t),[2]}))}))})),S.get(d.LocalServerUrl.ASSETS,(function(e,t){f.Logger.req(e),C.publicAssets.index(e,t)})),S.post(d.LocalServerUrl.ASSET_DOWNLOAD,(function(e,t){f.Logger.req(e),C.publicAssets.download(e,t)})),S.get("/favicon.*",(function(e,t){C.publicAssets.favicon(t)})),S.get("/*",(function(e,t){f.Logger.req(e,"(asset)"),C.publicAssets.show(e,t)})),S.post(d.LocalServerUrl.NODE_FILE_DOWNLOAD,(function(e,t){return s(void 0,void 0,void 0,(function(){return a(this,(function(n){return f.Logger.req(e),C.nodeDownloadedFiles.download(e,t),[2]}))}))})),n.c[n.s]===e&&(null!=v.overrideApiRoolUrl&&_.CoreType.isString(v.overrideApiRoolUrl)&&m.RemoteApiController.overrideApiRoolUrl(v.overrideApiRoolUrl),null!=v.overrideMarketApiRoolUrl&&_.CoreType.isString(v.overrideMarketApiRoolUrl)&&m.RemoteApiController.overrideMarketApiRoolUrl(v.overrideMarketApiRoolUrl),v.init?C.sceneSaver.npm.savePackageJSON():(0,_.isBooleanTrue)(null!=v.export||null!=v.runApiTest)?function(){if(v.export){var e=v.export;e||(console.error("no sceneName given"),process.exit(0)),C.cli.run(e)}else v.runApiTest&&C.cli.testCompiledExports()}():H(S,y))},7249:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.ProgressBarTop=void 0;var i=function(e){return"\n/* POSTER */\n#polygonjs-loading-poster {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\theight: 100%;\n\twidth: 100%;\n}\n#polygonjs-loading-poster {\n\tpointer-events: none;\n\tbackground: url('".concat(e.posterUrl,"') no-repeat center center;\n\t-webkit-background-size: cover;\n\t-moz-background-size: cover;\n\t-o-background-size: cover;\n\tbackground-size: cover;\n\topacity: 1;\n\ttransition: opacity 0.8s ease-in-out;\n\t-webkit-transition: opacity 0.8s ease-in-out;\n\t-moz-transition: opacity 0.8s ease-in-out;\n\t-ms-transition: opacity 0.8s ease-in-out;\n\t-o-transition: opacity 0.8s ease-in-out;\n}\n#polygonjs-loading-poster.fade-out {\n\topacity: 0;\n}\n\n/* PROGRESS BAR */\n.polygonjs-progress-bar-container {\n\tposition: absolute;\n\ttop: 0px;\n\tleft: 0px;\n\twidth: 100%;\n\theight: 8px;\n\tpointer-events: none;\n}\n.polygonjs-progress-bar-container .polygonjs-progress-bar {\n\theight: 100%;\n\twidth: 0%;\n\tanimation-name: progress-bar-color;\n\tanimation-duration: 4s;\n\tanimation-iteration-count: infinite;\n}\n.fadeable {\n\topacity: 1;\n\ttransition: opacity 0.5s ease-in-out;\n}\n.visible {\n\topacity: 1;\n}\n.hidden {\n\topacity: 0;\n}\n\n@keyframes progress-bar-color {\n\t0% {\n\t\tbackground-color: rgb(115, 214, 115);\n\t}\n\t50% {\n\t\tbackground-color: rgb(60, 60, 211);\n\t}\n\t100% {\n\t\tbackground-color: rgb(115, 214, 115);\n\t}\n}\n")},s=function(e){return'\n<div id="polygonjs-loading-poster"></div>\n<div id="polygonjs-progress-bar-container" class="polygonjs-progress-bar-container fadeable">\n\t<div id="polygonjs-progress-bar" class="polygonjs-progress-bar"></div>\n</div>\n'},a=function(e){return"\nconst container = document.getElementById('polygonjs-progress-bar-container');\nconst barElement = document.getElementById('polygonjs-progress-bar');\nconst poster = document.getElementById('polygonjs-loading-poster');\nexport function updateProgressBarTop(progress) {\n\tif (!(barElement && container && poster)) {\n\t\tconsole.log('progress bar elements missing', barElement, container, poster);\n\t\treturn;\n\t}\n\tif (progress < 1) {\n\t\tconst percent = Math.round(progress * 100) + '%'\n\t\tbarElement.style.width = percent;\n\t} else {\n\t\t// when we reach 1, we can remove the progress bar and fade out the poster\n\t\tif (container.parentElement) {\n\t\t\tcontainer.parentElement.removeChild(container);\n\t\t}\n\t\tif (poster) {\n\t\t\tposter.classList.add('fade-out');\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (poster.parentElement) {\n\t\t\t\t\tposter.parentElement.removeChild(poster);\n\t\t\t\t}\n\t\t\t}, 1200);\n\t\t}\n\t}\n}\n"},l=function(e){function t(){return e.call(this,{HTML:s,CSS:i,JS:a})||this}return r(t,e),t}(n(146).BaseProgressBar);t.ProgressBarTop=l},146:(e,t)=>{t.__esModule=!0,t.BaseProgressBar=void 0;var n=function(){function e(e){this._templateCSSFunction=e.CSS,this._templateHTMLFunction=e.HTML,this._templateJSFunction=e.JS}return e.prototype.templates=function(e){return{CSS:this._templateCSSFunction(e.CSS),JS:this._templateJSFunction(e.JS),HTML:this._templateHTMLFunction(e.HTML)}},e}();t.BaseProgressBar=n},5114:(e,t)=>{t.__esModule=!0,t.code=void 0,t.code={properties:{frame:0,maxFrame:600,maxFrameLocked:!1,realtimeState:!0,mainCameraPath:"/cameras/cameras:sopGroup/perspectiveCamera1",versions:{polygonjs:"1.3.3"}},root:{type:"root",nodes:{geo1:{type:"geo",nodes:{sphere1:{type:"sphere"},transform1:{type:"transform",inputs:["sphere1"],params:{t:[0,1,0]}},material1:{type:"material",params:{material:"../MAT/meshStandard1"},inputs:["transform1"],flags:{display:!0}},MAT:{type:"materialsNetwork",nodes:{meshStandard1:{type:"meshStandard",params:{useMap:1,map:"../../../COP/image1",useEnvMap:1,envMap:"../../../COP/envMap",metalness:1,roughness:0}}}}},flags:{display:!0}},ground:{type:"geo",nodes:{material1:{type:"material",params:{material:"../MAT/meshStandardBuilder1"},inputs:["box1"],flags:{display:!0}},MAT:{type:"materialsNetwork",nodes:{meshStandardBuilder1:{type:"meshStandardBuilder",nodes:{globals1:{type:"globals"},output1:{type:"output",inputs:[null,null,{index:2,inputName:"color",node:"mix1",output:"mix"}]},vec3ToFloat1:{type:"vec3ToFloat",params:{vec:{overriden_options:{}}},inputs:[{index:0,inputName:"vec",node:"globals1",output:"position"}]},floatToVec2_1:{type:"floatToVec2",params:{x:{overriden_options:{}},y:{overriden_options:{}}},inputs:[{index:0,inputName:"x",node:"vec3ToFloat1",output:"x"},{index:1,inputName:"y",node:"vec3ToFloat1",output:"z"}]},checkers1:{type:"checkers",params:{uv:{overriden_options:{}},freq:{overriden_options:{}},freqMult:{overriden_options:{}}},inputs:[{index:0,inputName:"uv",node:"floatToVec2_1",output:"vec2"}]},mix1:{type:"mix",params:{value0:{type:"vector3",default_value:[0,0,0],options:{spare:!0,editable:!1}},value1:{type:"vector3",default_value:[0,0,0],options:{spare:!0,editable:!1},overriden_options:{}},blend:{type:"float",default_value:.5,options:{spare:!0,editable:!1},overriden_options:{}}},inputs:[{index:0,inputName:"value0",node:"constant1",output:"val"},{index:1,inputName:"value1",node:"constant2",output:"val"},{index:2,inputName:"blend",node:"checkers1",output:"checker"}],connection_points:{in:[{name:"value0",type:"vec3"},{name:"value1",type:"vec3"},{name:"blend",type:"float"}],out:[{name:"mix",type:"vec3"}]}},constant1:{type:"constant",params:{type:4,color:[.24313725490196078,.5098039215686274,.8549019607843137],asColor:!0},connection_points:{in:[],out:[{name:"val",type:"vec3"}]}},constant2:{type:"constant",params:{type:4,color:[.047058823529411764,.10196078431372549,.17647058823529413],asColor:!0},connection_points:{in:[],out:[{name:"val",type:"vec3"}]}}},persisted_config:{material:{metadata:{version:4.5,type:"Material",generator:"Material.toJSON"},uuid:"/ground/MAT/meshStandardBuilder1-main",type:"MeshStandardMaterial",name:"/ground/MAT/meshStandardBuilder1",color:16777215,roughness:1,metalness:0,emissive:0,envMapIntensity:1,depthFunc:3,depthTest:!0,depthWrite:!0,colorWrite:!0,stencilWrite:!1,stencilWriteMask:255,stencilFunc:519,stencilRef:0,stencilFuncMask:255,stencilFail:7680,stencilZFail:7680,stencilZPass:7680,fog:!1},onBeforeCompileDataJSONWithoutShaders:{paramConfigs:[],timeDependent:!1,resolutionDependent:!1,raymarchingLightsWorldCoordsDependent:!1},customMaterials:{customDepthMaterial:{material:{metadata:{version:4.5,type:"Material",generator:"Material.toJSON"},uuid:"/ground/MAT/meshStandardBuilder1-customDepthMaterial",type:"MeshDepthMaterial",name:"customDepthMaterial",side:1,depthFunc:3,depthTest:!0,depthWrite:!0,colorWrite:!0,stencilWrite:!1,stencilWriteMask:255,stencilFunc:519,stencilRef:0,stencilFuncMask:255,stencilFail:7680,stencilZFail:7680,stencilZPass:7680,depthPacking:3201},onBeforeCompileDataJSONWithoutShaders:{paramConfigs:[],timeDependent:!1,resolutionDependent:!1,raymarchingLightsWorldCoordsDependent:!1}},customDistanceMaterial:{material:{metadata:{version:4.5,type:"Material",generator:"Material.toJSON"},uuid:"/ground/MAT/meshStandardBuilder1-customDistanceMaterial",type:"MeshDistanceMaterial",name:"customDistanceMaterial",depthFunc:3,depthTest:!0,depthWrite:!0,colorWrite:!0,stencilWrite:!1,stencilWriteMask:255,stencilFunc:519,stencilRef:0,stencilFuncMask:255,stencilFail:7680,stencilZFail:7680,stencilZPass:7680},onBeforeCompileDataJSONWithoutShaders:{paramConfigs:[],timeDependent:!1,resolutionDependent:!1,raymarchingLightsWorldCoordsDependent:!1}},customDepthDOFMaterial:{material:{metadata:{version:4.5,type:"Material",generator:"Material.toJSON"},uuid:"/ground/MAT/meshStandardBuilder1-customDepthDOFMaterial",type:"MeshDepthMaterial",name:"customDepthDOFMaterial",depthFunc:3,depthTest:!0,depthWrite:!0,colorWrite:!0,stencilWrite:!1,stencilWriteMask:255,stencilFunc:519,stencilRef:0,stencilFuncMask:255,stencilFail:7680,stencilZFail:7680,stencilZPass:7680,depthPacking:3200},onBeforeCompileDataJSONWithoutShaders:{paramConfigs:[],timeDependent:!1,resolutionDependent:!1,raymarchingLightsWorldCoordsDependent:!1}}}}}}},box1:{type:"box",params:{sizes:[9.98,1,9.98],center:[0,-.5,0]}}},flags:{display:!0}},COP:{type:"copNetwork",nodes:{envMap:{type:"envMap",inputs:["imageEnv"]},imageEnv:{type:"imageEXR",params:{tminFilter:!0,tmagFilter:!0,tanisotropy:!0,useRendererMaxAnisotropy:!0}},image1:{type:"image"}}},lights:{type:"geo",nodes:{hemisphereLight1:{type:"hemisphereLight",params:{intensity:.52}},spotLight1:{type:"spotLight",params:{showHelper:!1,castShadow:1,distance:10}},polarTransform1:{type:"polarTransform",params:{center:[0,.7,0],latitude:25.2,depth:3},inputs:["spotLight1"]},merge1:{type:"merge",inputs:["hemisphereLight1","polarTransform1"],flags:{display:!0}}},flags:{display:!0}},cameras:{type:"geo",nodes:{perspectiveCamera1:{type:"perspectiveCamera",params:{position:[3.3,3.3,3.3]}},cameraControls1:{type:"cameraControls",nodes:{cameraOrbitControls1:{type:"cameraOrbitControls",params:{target:[0,.75,0]}}},params:{node:"cameraOrbitControls1"},inputs:["perspectiveCamera1"],flags:{display:!0}}},flags:{display:!0}}},params:{mainCameraPath:"/cameras/cameras:sopGroup/perspectiveCamera1"}},ui:{nodes:{geo1:{pos:[-50,-350],nodes:{sphere1:{pos:[0,50]},transform1:{pos:[0,200]},material1:{pos:[0,350]},MAT:{pos:[-200,350],selection:["meshStandard1"],nodes:{meshStandard1:{pos:[0,0]}}}}},ground:{pos:[-50,-450],nodes:{material1:{pos:[0,300]},MAT:{pos:[-200,300],nodes:{meshStandardBuilder1:{pos:[0,200],nodes:{globals1:{pos:[-450,0]},output1:{pos:[400,0]},vec3ToFloat1:{pos:[-200,200]},floatToVec2_1:{pos:[-100,200]},checkers1:{pos:[50,200]},mix1:{pos:[250,0]},constant1:{pos:[50,-150]},constant2:{pos:[0,0]}}}}},box1:{pos:[0,100]}}},COP:{pos:[-300,-50],selection:["image1"],nodes:{envMap:{pos:[50,250]},imageEnv:{pos:[50,100]},image1:{pos:[-200,100]}}},lights:{pos:[-50,-250],selection:["hemisphereLight1"],nodes:{hemisphereLight1:{pos:[50,-50]},spotLight1:{pos:[300,-50]},polarTransform1:{pos:[300,150]},merge1:{pos:[100,300]}}},cameras:{pos:[-50,-150],nodes:{perspectiveCamera1:{pos:[0,-50]},cameraControls1:{pos:[0,150],nodes:{cameraOrbitControls1:{pos:[0,0]}}}}}}},shaders:{"/ground/MAT/meshStandardBuilder1":{vertex:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n\n\n\n// /ground/MAT/meshStandardBuilder1/globals1\nvarying vec3 v_POLY_globals1_position;\n\n\n\n\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\n\n\t// /ground/MAT/meshStandardBuilder1/globals1\n\tv_POLY_globals1_position = vec3(position);\n\t\n\t// /ground/MAT/meshStandardBuilder1/output1\n\tvec3 transformed = position;\n\tvec3 objectNormal = normal;\n\t#ifdef USE_TANGENT\n\t\tvec3 objectTangent = vec3( tangent.xyz );\n\t#endif\n\n\n\n\t#include <morphcolor_vertex>\n// removed:\n//\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n// removed:\n//\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",fragment:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n\n\n\n// /ground/MAT/meshStandardBuilder1/checkers1\n// https://iquilezles.org/articles/checkerfiltering/\nfloat checkers(vec2 p) {\n\tvec2 s = sign(fract(p*.5)-.5);\n\treturn .5 - .5*s.x*s.y;\n}\nfloat checkersGrad( in vec2 p, in vec2 ddx, in vec2 ddy )\n{\n    // filter kernel\n    vec2 w = max(abs(ddx), abs(ddy)) + 0.01;\n    // analytical integral (box filter)\n    vec2 i = 2.0*(abs(fract((p-0.5*w)/2.0)-0.5)-abs(fract((p+0.5*w)/2.0)-0.5))/w;\n    // xor pattern\n    return 0.5 - 0.5*i.x*i.y;\n}\n\n\n\n\n\n\n\n\n// /ground/MAT/meshStandardBuilder1/globals1\nvarying vec3 v_POLY_globals1_position;\n\n\n\n\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nstruct SSSModel {\n\tbool isActive;\n\tvec3 color;\n\tfloat thickness;\n\tfloat power;\n\tfloat scale;\n\tfloat distortion;\n\tfloat ambient;\n\tfloat attenuation;\n};\n\nvoid RE_Direct_Scattering(\n\tconst in IncidentLight directLight,\n\tconst in GeometricContext geometry,\n\tconst in SSSModel sssModel,\n\tinout ReflectedLight reflectedLight\n\t){\n\tvec3 scatteringHalf = normalize(directLight.direction + (geometry.normal * sssModel.distortion));\n\tfloat scatteringDot = pow(saturate(dot(geometry.viewDir, -scatteringHalf)), sssModel.power) * sssModel.scale;\n\tvec3 scatteringIllu = (scatteringDot + sssModel.ambient) * (sssModel.color * (1.0-sssModel.thickness));\n\treflectedLight.directDiffuse += scatteringIllu * sssModel.attenuation * directLight.color;\n}\n\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\n\n\t// /ground/MAT/meshStandardBuilder1/constant1\n\tvec3 v_POLY_constant1_val = vec3(0.24313725490196078, 0.5098039215686274, 0.8549019607843137);\n\t\n\t// /ground/MAT/meshStandardBuilder1/constant2\n\tvec3 v_POLY_constant2_val = vec3(0.047058823529411764, 0.10196078431372549, 0.17647058823529413);\n\t\n\t// /ground/MAT/meshStandardBuilder1/vec3ToFloat1\n\tfloat v_POLY_vec3ToFloat1_x = v_POLY_globals1_position.x;\n\tfloat v_POLY_vec3ToFloat1_z = v_POLY_globals1_position.z;\n\t\n\t// /ground/MAT/meshStandardBuilder1/floatToVec2_1\n\tvec2 v_POLY_floatToVec2_1_vec2 = vec2(v_POLY_vec3ToFloat1_x, v_POLY_vec3ToFloat1_z);\n\t\n\t// /ground/MAT/meshStandardBuilder1/checkers1\n\tvec2 v_POLY_checkers1_coord = v_POLY_floatToVec2_1_vec2*vec2(1.0, 1.0)*1.0;\n\tfloat v_POLY_checkers1_checker = checkersGrad(v_POLY_checkers1_coord, dFdx(v_POLY_checkers1_coord), dFdy(v_POLY_checkers1_coord));\n\t\n\t// /ground/MAT/meshStandardBuilder1/mix1\n\tvec3 v_POLY_mix1_mix = mix(v_POLY_constant1_val, v_POLY_constant2_val, v_POLY_checkers1_checker);\n\t\n\t// /ground/MAT/meshStandardBuilder1/output1\n\tdiffuseColor.xyz = v_POLY_mix1_mix;\n\tfloat POLY_metalness = 1.0;\n\tfloat POLY_roughness = 1.0;\n\tvec3 POLY_emissive = vec3(1.0, 1.0, 1.0);\n\tSSSModel POLY_SSSModel = SSSModel(/*isActive*/false,/*color*/vec3(1.0, 1.0, 1.0), /*thickness*/0.1, /*power*/2.0, /*scale*/16.0, /*distortion*/0.1,/*ambient*/0.4,/*attenuation*/0.8 );\n\n\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive * POLY_emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat roughnessFactor = roughness * POLY_roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n\n\tfloat metalnessFactor = metalness * POLY_metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\nif(POLY_SSSModel.isActive){\n\tRE_Direct_Scattering(directLight, geometry, POLY_SSSModel, reflectedLight);\n}\n\n\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}","customDepthMaterial.vertex":"#include <common>\n\n\n\n// /ground/MAT/meshStandardBuilder1/globals1\nvarying vec3 v_POLY_globals1_position;\n\n\n\n\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n// removed:\n//\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n// removed:\n//\t#include <begin_vertex>\n\n\n\n\t// /ground/MAT/meshStandardBuilder1/globals1\n\tv_POLY_globals1_position = vec3(position);\n\t\n\t// /ground/MAT/meshStandardBuilder1/output1\n\tvec3 transformed = position;\n\tvec3 objectNormal = normal;\n\t#ifdef USE_TANGENT\n\t\tvec3 objectTangent = vec3( tangent.xyz );\n\t#endif\n\n\n\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}","customDepthMaterial.fragment":"\n// INSERT DEFINES\n\n\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n\n\n\n// /ground/MAT/meshStandardBuilder1/checkers1\n// https://iquilezles.org/articles/checkerfiltering/\nfloat checkers(vec2 p) {\n\tvec2 s = sign(fract(p*.5)-.5);\n\treturn .5 - .5*s.x*s.y;\n}\nfloat checkersGrad( in vec2 p, in vec2 ddx, in vec2 ddy )\n{\n    // filter kernel\n    vec2 w = max(abs(ddx), abs(ddy)) + 0.01;\n    // analytical integral (box filter)\n    vec2 i = 2.0*(abs(fract((p-0.5*w)/2.0)-0.5)-abs(fract((p+0.5*w)/2.0)-0.5))/w;\n    // xor pattern\n    return 0.5 - 0.5*i.x*i.y;\n}\n\n\n\n\n\n\n\n\n// /ground/MAT/meshStandardBuilder1/globals1\nvarying vec3 v_POLY_globals1_position;\n\n\n\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nstruct SSSModel {\n\tbool isActive;\n\tvec3 color;\n\tfloat thickness;\n\tfloat power;\n\tfloat scale;\n\tfloat distortion;\n\tfloat ambient;\n\tfloat attenuation;\n};\n\nvoid RE_Direct_Scattering(\n\tconst in IncidentLight directLight,\n\tconst in GeometricContext geometry,\n\tconst in SSSModel sssModel,\n\tinout ReflectedLight reflectedLight\n\t){\n\tvec3 scatteringHalf = normalize(directLight.direction + (geometry.normal * sssModel.distortion));\n\tfloat scatteringDot = pow(saturate(dot(geometry.viewDir, -scatteringHalf)), sssModel.power) * sssModel.scale;\n\tvec3 scatteringIllu = (scatteringDot + sssModel.ambient) * (sssModel.color * (1.0-sssModel.thickness));\n\treflectedLight.directDiffuse += scatteringIllu * sssModel.attenuation * directLight.color;\n}\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\n\n\n\t// /ground/MAT/meshStandardBuilder1/constant1\n\tvec3 v_POLY_constant1_val = vec3(0.24313725490196078, 0.5098039215686274, 0.8549019607843137);\n\t\n\t// /ground/MAT/meshStandardBuilder1/constant2\n\tvec3 v_POLY_constant2_val = vec3(0.047058823529411764, 0.10196078431372549, 0.17647058823529413);\n\t\n\t// /ground/MAT/meshStandardBuilder1/vec3ToFloat1\n\tfloat v_POLY_vec3ToFloat1_x = v_POLY_globals1_position.x;\n\tfloat v_POLY_vec3ToFloat1_z = v_POLY_globals1_position.z;\n\t\n\t// /ground/MAT/meshStandardBuilder1/floatToVec2_1\n\tvec2 v_POLY_floatToVec2_1_vec2 = vec2(v_POLY_vec3ToFloat1_x, v_POLY_vec3ToFloat1_z);\n\t\n\t// /ground/MAT/meshStandardBuilder1/checkers1\n\tvec2 v_POLY_checkers1_coord = v_POLY_floatToVec2_1_vec2*vec2(1.0, 1.0)*1.0;\n\tfloat v_POLY_checkers1_checker = checkersGrad(v_POLY_checkers1_coord, dFdx(v_POLY_checkers1_coord), dFdy(v_POLY_checkers1_coord));\n\t\n\t// /ground/MAT/meshStandardBuilder1/mix1\n\tvec3 v_POLY_mix1_mix = mix(v_POLY_constant1_val, v_POLY_constant2_val, v_POLY_checkers1_checker);\n\t\n\t// /ground/MAT/meshStandardBuilder1/output1\n\tdiffuseColor.xyz = v_POLY_mix1_mix;\n\tfloat POLY_metalness = 1.0;\n\tfloat POLY_roughness = 1.0;\n\tvec3 POLY_emissive = vec3(1.0, 1.0, 1.0);\n\tSSSModel POLY_SSSModel = SSSModel(/*isActive*/false,/*color*/vec3(1.0, 1.0, 1.0), /*thickness*/0.1, /*power*/2.0, /*scale*/16.0, /*distortion*/0.1,/*ambient*/0.4,/*attenuation*/0.8 );\n\n\n\n\n\t// INSERT BODY\n\t// the new body lines should be added before the alphatest_fragment\n\t// so that alpha is set before (which is really how it would be set if the alphamap_fragment above was used by the material node parameters)\n\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), diffuseColor.a );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n","customDistanceMaterial.vertex":"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n\n\n\n// /ground/MAT/meshStandardBuilder1/globals1\nvarying vec3 v_POLY_globals1_position;\n\n\n\n\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n// removed:\n//\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n// removed:\n//\t#include <begin_vertex>\n\n\n\n\t// /ground/MAT/meshStandardBuilder1/globals1\n\tv_POLY_globals1_position = vec3(position);\n\t\n\t// /ground/MAT/meshStandardBuilder1/output1\n\tvec3 transformed = position;\n\tvec3 objectNormal = normal;\n\t#ifdef USE_TANGENT\n\t\tvec3 objectTangent = vec3( tangent.xyz );\n\t#endif\n\n\n\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}","customDistanceMaterial.fragment":"\n// INSERT DEFINES\n\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n\n\n\n// /ground/MAT/meshStandardBuilder1/checkers1\n// https://iquilezles.org/articles/checkerfiltering/\nfloat checkers(vec2 p) {\n\tvec2 s = sign(fract(p*.5)-.5);\n\treturn .5 - .5*s.x*s.y;\n}\nfloat checkersGrad( in vec2 p, in vec2 ddx, in vec2 ddy )\n{\n    // filter kernel\n    vec2 w = max(abs(ddx), abs(ddy)) + 0.01;\n    // analytical integral (box filter)\n    vec2 i = 2.0*(abs(fract((p-0.5*w)/2.0)-0.5)-abs(fract((p+0.5*w)/2.0)-0.5))/w;\n    // xor pattern\n    return 0.5 - 0.5*i.x*i.y;\n}\n\n\n\n\n\n\n\n\n// /ground/MAT/meshStandardBuilder1/globals1\nvarying vec3 v_POLY_globals1_position;\n\n\n\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nstruct SSSModel {\n\tbool isActive;\n\tvec3 color;\n\tfloat thickness;\n\tfloat power;\n\tfloat scale;\n\tfloat distortion;\n\tfloat ambient;\n\tfloat attenuation;\n};\n\nvoid RE_Direct_Scattering(\n\tconst in IncidentLight directLight,\n\tconst in GeometricContext geometry,\n\tconst in SSSModel sssModel,\n\tinout ReflectedLight reflectedLight\n\t){\n\tvec3 scatteringHalf = normalize(directLight.direction + (geometry.normal * sssModel.distortion));\n\tfloat scatteringDot = pow(saturate(dot(geometry.viewDir, -scatteringHalf)), sssModel.power) * sssModel.scale;\n\tvec3 scatteringIllu = (scatteringDot + sssModel.ambient) * (sssModel.color * (1.0-sssModel.thickness));\n\treflectedLight.directDiffuse += scatteringIllu * sssModel.attenuation * directLight.color;\n}\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\n\n\n\t// /ground/MAT/meshStandardBuilder1/constant1\n\tvec3 v_POLY_constant1_val = vec3(0.24313725490196078, 0.5098039215686274, 0.8549019607843137);\n\t\n\t// /ground/MAT/meshStandardBuilder1/constant2\n\tvec3 v_POLY_constant2_val = vec3(0.047058823529411764, 0.10196078431372549, 0.17647058823529413);\n\t\n\t// /ground/MAT/meshStandardBuilder1/vec3ToFloat1\n\tfloat v_POLY_vec3ToFloat1_x = v_POLY_globals1_position.x;\n\tfloat v_POLY_vec3ToFloat1_z = v_POLY_globals1_position.z;\n\t\n\t// /ground/MAT/meshStandardBuilder1/floatToVec2_1\n\tvec2 v_POLY_floatToVec2_1_vec2 = vec2(v_POLY_vec3ToFloat1_x, v_POLY_vec3ToFloat1_z);\n\t\n\t// /ground/MAT/meshStandardBuilder1/checkers1\n\tvec2 v_POLY_checkers1_coord = v_POLY_floatToVec2_1_vec2*vec2(1.0, 1.0)*1.0;\n\tfloat v_POLY_checkers1_checker = checkersGrad(v_POLY_checkers1_coord, dFdx(v_POLY_checkers1_coord), dFdy(v_POLY_checkers1_coord));\n\t\n\t// /ground/MAT/meshStandardBuilder1/mix1\n\tvec3 v_POLY_mix1_mix = mix(v_POLY_constant1_val, v_POLY_constant2_val, v_POLY_checkers1_checker);\n\t\n\t// /ground/MAT/meshStandardBuilder1/output1\n\tdiffuseColor.xyz = v_POLY_mix1_mix;\n\tfloat POLY_metalness = 1.0;\n\tfloat POLY_roughness = 1.0;\n\tvec3 POLY_emissive = vec3(1.0, 1.0, 1.0);\n\tSSSModel POLY_SSSModel = SSSModel(/*isActive*/false,/*color*/vec3(1.0, 1.0, 1.0), /*thickness*/0.1, /*power*/2.0, /*scale*/16.0, /*distortion*/0.1,/*ambient*/0.4,/*attenuation*/0.8 );\n\n\n\n\n\t// INSERT BODY\n\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n","customDepthDOFMaterial.vertex":"#include <common>\n\n\n\n// /ground/MAT/meshStandardBuilder1/globals1\nvarying vec3 v_POLY_globals1_position;\n\n\n\n\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n// removed:\n//\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n// removed:\n//\t#include <begin_vertex>\n\n\n\n\t// /ground/MAT/meshStandardBuilder1/globals1\n\tv_POLY_globals1_position = vec3(position);\n\t\n\t// /ground/MAT/meshStandardBuilder1/output1\n\tvec3 transformed = position;\n\tvec3 objectNormal = normal;\n\t#ifdef USE_TANGENT\n\t\tvec3 objectTangent = vec3( tangent.xyz );\n\t#endif\n\n\n\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}","customDepthDOFMaterial.fragment":"\n// INSERT DEFINES\n\n\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n\n\n\n// /ground/MAT/meshStandardBuilder1/checkers1\n// https://iquilezles.org/articles/checkerfiltering/\nfloat checkers(vec2 p) {\n\tvec2 s = sign(fract(p*.5)-.5);\n\treturn .5 - .5*s.x*s.y;\n}\nfloat checkersGrad( in vec2 p, in vec2 ddx, in vec2 ddy )\n{\n    // filter kernel\n    vec2 w = max(abs(ddx), abs(ddy)) + 0.01;\n    // analytical integral (box filter)\n    vec2 i = 2.0*(abs(fract((p-0.5*w)/2.0)-0.5)-abs(fract((p+0.5*w)/2.0)-0.5))/w;\n    // xor pattern\n    return 0.5 - 0.5*i.x*i.y;\n}\n\n\n\n\n\n\n\n\n// /ground/MAT/meshStandardBuilder1/globals1\nvarying vec3 v_POLY_globals1_position;\n\n\n\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nstruct SSSModel {\n\tbool isActive;\n\tvec3 color;\n\tfloat thickness;\n\tfloat power;\n\tfloat scale;\n\tfloat distortion;\n\tfloat ambient;\n\tfloat attenuation;\n};\n\nvoid RE_Direct_Scattering(\n\tconst in IncidentLight directLight,\n\tconst in GeometricContext geometry,\n\tconst in SSSModel sssModel,\n\tinout ReflectedLight reflectedLight\n\t){\n\tvec3 scatteringHalf = normalize(directLight.direction + (geometry.normal * sssModel.distortion));\n\tfloat scatteringDot = pow(saturate(dot(geometry.viewDir, -scatteringHalf)), sssModel.power) * sssModel.scale;\n\tvec3 scatteringIllu = (scatteringDot + sssModel.ambient) * (sssModel.color * (1.0-sssModel.thickness));\n\treflectedLight.directDiffuse += scatteringIllu * sssModel.attenuation * directLight.color;\n}\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\n\n\n\t// /ground/MAT/meshStandardBuilder1/constant1\n\tvec3 v_POLY_constant1_val = vec3(0.24313725490196078, 0.5098039215686274, 0.8549019607843137);\n\t\n\t// /ground/MAT/meshStandardBuilder1/constant2\n\tvec3 v_POLY_constant2_val = vec3(0.047058823529411764, 0.10196078431372549, 0.17647058823529413);\n\t\n\t// /ground/MAT/meshStandardBuilder1/vec3ToFloat1\n\tfloat v_POLY_vec3ToFloat1_x = v_POLY_globals1_position.x;\n\tfloat v_POLY_vec3ToFloat1_z = v_POLY_globals1_position.z;\n\t\n\t// /ground/MAT/meshStandardBuilder1/floatToVec2_1\n\tvec2 v_POLY_floatToVec2_1_vec2 = vec2(v_POLY_vec3ToFloat1_x, v_POLY_vec3ToFloat1_z);\n\t\n\t// /ground/MAT/meshStandardBuilder1/checkers1\n\tvec2 v_POLY_checkers1_coord = v_POLY_floatToVec2_1_vec2*vec2(1.0, 1.0)*1.0;\n\tfloat v_POLY_checkers1_checker = checkersGrad(v_POLY_checkers1_coord, dFdx(v_POLY_checkers1_coord), dFdy(v_POLY_checkers1_coord));\n\t\n\t// /ground/MAT/meshStandardBuilder1/mix1\n\tvec3 v_POLY_mix1_mix = mix(v_POLY_constant1_val, v_POLY_constant2_val, v_POLY_checkers1_checker);\n\t\n\t// /ground/MAT/meshStandardBuilder1/output1\n\tdiffuseColor.xyz = v_POLY_mix1_mix;\n\tfloat POLY_metalness = 1.0;\n\tfloat POLY_roughness = 1.0;\n\tvec3 POLY_emissive = vec3(1.0, 1.0, 1.0);\n\tSSSModel POLY_SSSModel = SSSModel(/*isActive*/false,/*color*/vec3(1.0, 1.0, 1.0), /*thickness*/0.1, /*power*/2.0, /*scale*/16.0, /*distortion*/0.1,/*ambient*/0.4,/*attenuation*/0.8 );\n\n\n\n\n\t// INSERT BODY\n\t// the new body lines should be added before the alphatest_fragment\n\t// so that alpha is set before (which is really how it would be set if the alphamap_fragment above was used by the material node parameters)\n\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), diffuseColor.a );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n"}}}},7381:(e,t)=>{t.__esModule=!0,t.editor=void 0,t.editor={multiple_panel:{split_ratio:.5,split_panel0:{split_ratio:.5543217692883486,split_panel0:{panelTypes:["viewer"],currentPanelIndex:0,panel_data:{camera:"/cameras/cameras:sopGroup/perspectiveCamera1",isViewerInitLayoutData:!0,linkIndex:1,overlayedNetwork:{allowed:!1,displayed:!1,initLayoutData:{camera:{position:{x:0,y:0},zoom:1},history:{},paramsDisplayed:!1,linkIndex:1}}}},split_panel1:{panelTypes:["params"],currentPanelIndex:0,panel_data:{active_folder:700,linkIndex:1}},split_mode:"vertical"},split_panel1:{panelTypes:["network","params","viewer"],currentPanelIndex:0,panel_data:{camera:{position:{x:62.54553192632958,y:223.1583293886238},zoom:1.0222221069335933},history:{},paramsDisplayed:!1,linkIndex:1}},split_mode:"horizontal"},currentNodes:["/","/","/","/","/","/","/","/"],navigationHistory:{nodePaths:{1:["/"],2:["/"],3:["/"],4:["/"],5:["/"],6:["/"],7:["/"],8:["/"]},index:{1:17,2:0,3:0,4:0,5:0,6:0,7:0,8:0}},fullscreenPanelId:null,saveOptions:{checkRemoteAssetsUse:!0,minimizeFilesCount:!1},paramsModal:[]}},7633:(e,t)=>{t.__esModule=!0,t.AUTOGENERATED=t.OutFileName=void 0,function(e){e.ROOT="root",e.PROPERTIES="properties",e.UI="ui",e.POLY_CONFIG="PolyConfig",e.EDITOR_CONFIG="EditorConfig",e.EDITOR_DATA="editor",e.MANIFEST="autogenerated/manifest",e.MODULES="autogenerated/modules",e.MANIFEST_LEGACY="manifest",e.MANIFEST_ASSETS="autogenerated/assets",e.INDEX_JS="autogenerated/index",e.FETCH_SCENE_AND_MOUNT_TEMPLATE="autogenerated/fetchSceneAndMount",e.SCENE_DATA_SINGLE_FILE="autogenerated/scene",e.CREATE_SCENE_AND_MOUNT_TEMPLATE="autogenerated/createSceneAndMount",e.CREATE_SCENE_AND_MOUNT_NO_CHUNK_TEMPLATE="autogenerated/createSceneAndMountNoChunk",e.LOAD_SCENE_DATA_TEMPLATE="autogenerated/loadSceneData",e.LOAD_SCENE_FROM_SCENE_DATA_TEMPLATE="autogenerated/loadSceneFromSceneData",e.LOAD_SCENE_TEMPLATE="autogenerated/loadScene",e.REQUIRED_IMPORTS="autogenerated/requiredImports",e.POLY_SCENE_WITH_NODE_MAP="autogenerated/PolySceneWithNodeMap"}(t.OutFileName||(t.OutFileName={})),t.AUTOGENERATED="autogenerated"},6231:(e,t)=>{var n;t.__esModule=!0,t.ASSETS_EXTENSIONS_SEPARATOR=t.TIMESTAMP_URL_PARAM_NAME=t.SocketEvent=t.RESERVED_PUBLIC_ASSETS_FOLDER_NAMES=t.EDITOR_ROUTES=t.EditorRoute=t.Route=t.LocalServerUrl=t.ResponseMessageFromLocalServer=void 0,function(e){e.NO_USER="no user",e.NO_MANIFEST="no manifest",e.NO_POLY_CONFIG="no poly plugins",e.NO_EDITOR_CONFIG="no editor config",e.NO_EDITOR="no editor data",e.NO_NODE_MODULES="no node_modules",e.NO_LIBS_ROOT="no libs root",e.THREEJS_NOT_INSTALLED="threejs is not installed",e.XATLAS_NOT_INSTALLED="xatlas is not installed",e.POLYGONJS_NOT_INSTALLED="polygonjs is not installed"}(t.ResponseMessageFromLocalServer||(t.ResponseMessageFromLocalServer={})),function(e){e.ROOT="/",e.TOKEN_CREATE="/api/tokens",e.TOKEN_GET="/api/token",e.LOGOUT="/api/logout",e.SCENES="/api/scenes",e.SCENE_LOAD="/api/scenes/load",e.SCENE_SAVE="/api/scenes/save",e.SCENE_UPDATE_NAME="/api/scenes/updateName",e.SCENE_DELETE="/api/scenes/delete",e.POLY_NODES_INDEX="/api/poly_nodes",e.POLY_NODE_CREATE="/api/poly_nodes/create",e.POLY_NODE_UPDATE="/api/poly_nodes/update",e.MARKETPLACE_POLY_NODES_INDEX="/api/marketplace/poly_nodes",e.MARKETPLACE_POLY_NODES_SEARCH="/api/marketplace/poly_nodes/search",e.MARKETPLACE_POLY_NODES_DOWNLOAD="/api/marketplace/poly_nodes/download",e.MARKETPLACE_POLY_NODES_UPLOAD="/api/marketplace/poly_nodes/upload",e.SHARE_SCENE_UPLOAD="/api/share/upload",e.SHARE_ZIP="/api/share/zip",e.CAPTURE_ANIMATION_SAVE="/api/captures/animation/save",e.CAPTURE_STATUS_REQUEST="/api/captures/status",e.CAPTURE_STATIC_SAVE="/api/captures/static/save",e.CAPTURE_STATIC_LOAD="/api/captures/static/load",e.CAPTURE_ANIMATION_FRAME_SAVE="/api/captures/animation/frame/save",e.CAPTURE_ANIMATION_FRAME_LOAD="/api/captures/animation/frame/load",e.POLY_CONFIG_LOAD="/api/poly_config/load.js",e.EDITOR_CONFIG_LOAD="/api/editor_config/load.js",e.ASSETS="/api/assets.json",e.ASSET_DOWNLOAD="/api/assets/download.json",e.INSTALL_DRACO="/api/install/draco.json",e.INSTALL_KTX2="/api/install/ktx2.json",e.INSTALL_XATLAS="/api/install/xatlas.json",e.INSTALL_OCCT="/api/install/occt.json",e.INSTALL_MANIFOLD="/api/install/manifold.json",e.STATUS="/api/utils/status.json",e.NODE_FILE_DOWNLOAD="/api/node_files/download",e.MULTIPLAYER_SESSION_CHECK_CREATION_ALLOWED="/api/multiplayer/sessions/checkCreationAllowed",e.MULTIPLAYER_SESSION_CREATE="/api/multiplayer/sessions/create",e.MULTIPLAYER_SESSION_SHOW="/api/multiplayer/sessions/show",e.MULTIPLAYER_SESSION_DESTROY="/api/multiplayer/sessions/destroy",e.MULTIPLAYER_USER_REQUEST_INDEX="/api/multiplayer/userRequests/index",e.MULTIPLAYER_USER_REQUEST_CREATE="/api/multiplayer/userRequests/create",e.MULTIPLAYER_USER_REQUEST_APPROVE="/api/multiplayer/userRequests/approve",e.MULTIPLAYER_USER_REQUEST_REJECT="/api/multiplayer/userRequests/reject",e.MULTIPLAYER_USER_INDEX="/api/multiplayer/users/index",e.MULTIPLAYER_USER_DESTROY="/api/multiplayer/users/destroy",e.MULTIPLAYER_USER_BAN="/api/multiplayer/users/ban",e.MULTIPLAYER_USER_UNBAN="/api/multiplayer/users/unban",e.MULTIPLAYER_AWARENESS_UPDATE_PATH="/api/multiplayer/awareness/path/update",e.MULTIPLAYER_AWARENESS_UPDATE_POSITION="/api/multiplayer/awareness/position/update",e.MULTIPLAYER_AWARENESS_UPDATE_CAMERA="/api/multiplayer/awareness/camera/update",e.MULTIPLAYER_COMMAND_REQUEST="/api/multiplayer/commands/request",e.MULTIPLAYER_COMMAND_UPDATE="/api/multiplayer/commands/update",e.MULTIPLAYER_UNDO_REQUEST="/api/multiplayer/undo/request",e.MULTIPLAYER_REDO_REQUEST="/api/multiplayer/redo/request",e.MULTIPLAYER_SCENE_DATA_SAVE="/api/multiplayer/sceneData/save",e.PLUGIN_FIGMA_PING="/plugins/figma/ping"}(t.LocalServerUrl||(t.LocalServerUrl={})),function(e){e.ROOT="/",e.SCENE_NEW="/scenes/new",e.SCENE_EDIT="/scenes/:sceneName/edit",e.SCENE_SETTINGS="/scenes/:sceneName/settings",e.PROFILE_SCENE_EDIT="/:username/:sceneName/edit",e.EXAMPLE="/examples/:exampleId",e.DEMO="/demo",e.DOCS="/docs"}(t.Route||(t.Route={})),function(e){e.ABOUT="about",e.ASSETS="assets",e.EXPORT="export",e.LIBRARIES="libraries",e.LOGIN="login",e.POLY_NODE_CREATE="polynodes/create/:urlNodePath",e.POLY_NODE_UPDATE="polynodes/update/:urlNodePath",e.PREFERENCES="preferences",e.MARKET="market",e.SELECT_FILE="select/file/:urlParamPath",e.SELECT_NODE="select/node/:urlParamPath",e.SELECT_OBJECT_MASK="select/objectmask/:urlParamPath",e.SHARE="share",e.SPARE_PARAMS_EDIT="spareparams/:urlNodePath",e.MULTIPLAYER="multiplayer",e.KEYFRAMES="keyframes/:urlNodePath"}(n=t.EditorRoute||(t.EditorRoute={})),t.EDITOR_ROUTES=[n.ABOUT,n.ASSETS,n.EXPORT,n.LIBRARIES,n.LOGIN,n.POLY_NODE_CREATE,n.POLY_NODE_UPDATE,n.PREFERENCES,n.MARKET,n.SELECT_FILE,n.SELECT_NODE,n.SELECT_OBJECT_MASK,n.SHARE,n.SPARE_PARAMS_EDIT,n.MULTIPLAYER,n.KEYFRAMES],t.RESERVED_PUBLIC_ASSETS_FOLDER_NAMES=["audio","images","fonts","models","textures","three"],function(e){e.AUTH_SESSION_DESTROYED="auth-session-destroyed",e.FILE_CHANGED="file-changed",e.MULTIPLAYER_SESSION_DESTROYED="multiplayer-session-destroyed",e.MULTIPLAYER_USERS_UPDATED="multiplayer-users-updated",e.MULTIPLAYER_AWARENESS_UPDATED="multiplayer-awareness-updated",e.MULTIPLAYER_COMMAND_CONFIRMED="multiplayer-command-confirmed",e.MULTIPLAYER_UNDO_CONFIRMED="multiplayer-undo-confirmed",e.MULTIPLAYER_REDO_CONFIRMED="multiplayer-redo-confirmed"}(t.SocketEvent||(t.SocketEvent={})),t.TIMESTAMP_URL_PARAM_NAME="timestamp",t.ASSETS_EXTENSIONS_SEPARATOR=","},5433:(e,t,n)=>{t.__esModule=!0,t.EditorApi=void 0;var o=n(6752),r=n(5356),i=n(2375),s=n(9094),a=function(){function e(){this.html=new r.HTMLApi(this),this.panel=new o.PanelApi(this),this.export=new i.ExportApi(this),this.multiplayer=new s.MultiPlayerApi(this)}return e.prototype.setProjectName=function(e){this._projectName=e},e.prototype.projectName=function(){return this._projectName},e}();t.EditorApi=a},2375:(e,t)=>{t.__esModule=!0,t.ExportApi=void 0;var n=function(){function e(e){this.editorApi=e}return e.prototype.setPostExportCommand=function(e){this._postExportCallback=e},e.prototype.postExportCommand=function(e){if(this._postExportCallback)return this._postExportCallback(e)},e.prototype.setExportFolder=function(e){this._exportFolder=e},e.prototype.exportFolder=function(){return this._exportFolder},e}();t.ExportApi=n},5522:(e,t)=>{t.__esModule=!0,t.HTMLBodyApi=void 0;var n=function(){function e(e){this.htmlApi=e,this._tagsByIdByGroup=new Map,this._polygonjsIdFunction=function(e){return"polygonjs-app-".concat(e)}}return e.prototype.addTag=function(e,t){var n=this._tagsByIdByGroup.get(e);n||(n=new Map,this._tagsByIdByGroup.set(e,n)),n.set(t.id,t)},e.prototype.tags=function(e){var t=[],n=this._tagsByIdByGroup.get(e);return n&&n.forEach((function(e,n){t.push(e.content)})),t.join("\n")},e.prototype.polygonjsId=function(e){return this._polygonjsIdFunction(e)},e.prototype.setPolygonjsIdCallback=function(e){this._polygonjsIdFunction=e},e}();t.HTMLBodyApi=n},5356:(e,t,n)=>{t.__esModule=!0,t.HTMLApi=void 0;var o=n(3094),r=n(5522),i=n(2867),s=function(e){this.editorApi=e,this.head=new o.HTMLHeadApi(this),this.body=new r.HTMLBodyApi(this),this.viewer=new i.HTMLViewerApi(this)};t.HTMLApi=s},3094:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};t.__esModule=!0,t.HTMLHeadApi=void 0;var r=["jpg","jpeg","png"],i=["mp4","ogv","ogg"],s=["js"],a=o(n(3198)),l="a WebGL Experience created with @polygonjs",c=function(){function e(e){this.htmlApi=e,this._stylesheetContentById=new Map,this._scriptDataById=new Map,this._preloadUrls=new Map,this._title=l,this._description=l,this._twitter="@polygonjs",this._siteUrl="https://polygonjs.com",this._autoPlay=!0,this._metaTagStrings=[],this.addStylesheet({id:"polygonjs-default",content:"\nhtml,\nbody,\n.polygonjs-app {\n\tmargin: 0px;\n\theight: 100%;\n\toverflow: hidden;\n\tdisplay: block;\n}\n.polygonjs-app canvas {\n\tdisplay: block;\n\theight: 100%;\n\tuser-select: none;\n\t-webkit-user-select: none;\n\t-khtml-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n}\n.polygonjs-app canvas.active {\n\tcursor: pointer;\n}\n"})}return e.prototype.setTitle=function(e){this._title=e},e.prototype.title=function(){return this._title},e.prototype.setDescription=function(e){this._description=e},e.prototype.description=function(){return this._description},e.prototype.setSiteUrl=function(e){this._siteUrl=e},e.prototype.siteUrl=function(){return this._siteUrl},e.prototype.setTwitter=function(e){this._twitter=e},e.prototype.twitter=function(){return this._twitter},e.prototype.setAutoPlay=function(e){this._autoPlay=e},e.prototype.tags=function(){return[this.metaTags(),this.titleTag(),this.stylesheets(),this.scripts(),this.preloadLinks()].join("\n")},e.prototype.titleTag=function(){return"<title>".concat(this.title(),"</title>")},e.prototype.addStylesheet=function(e){this._stylesheetContentById.get(e.id)?console.error("stylesheet with id '".concat(e.id,"' already given")):this._stylesheetContentById.set(e.id,e.content)},e.prototype.stylesheets=function(){var e=[];return this._stylesheetContentById.forEach((function(t,n){var o='\n<style id="'.concat(n,'">\n\t').concat(t,"\n</style>");e.push(o)})),e.join("\n")},e.prototype.addScript=function(e){this._scriptDataById.get(e.id)?console.error("script with id '".concat(e.id,"' already given")):this._scriptDataById.set(e.id,e)},e.prototype._scriptTags=function(){var e=this,t=[];return this._scriptDataById.forEach((function(n,o){var r=e._scriptTag(n,{autoPlay:e._autoPlay});t.push(r)})),t},e.prototype.scripts=function(){return this._scriptTags().join("\n")},e.prototype.addPreloadUrl=function(e,t){this._preloadUrls.set(e,t||{})},e.prototype.preloadLinks=function(){var t=[];return this._preloadUrls.forEach((function(n,o){var r=e.preloadLinkTagFromUrl(o,n);t.push(r)})),t.join("\n")},e.prototype.metaTags=function(){for(var e=[],t=0,n=this._metaTagStrings;t<n.length;t++){var o=n[t];e.push(o)}return e.join("\n")},e.prototype.addMetaTag=function(e){this._metaTagStrings.push(e)},e.prototype.updateCurrentPage=function(){var e=document.getElementsByTagName("head")[0];this._scriptDataById.forEach((function(t,n){var o=document.createElement("script");o.innerHTML=t.content,o.id=n,t.type&&(o.type=t.type),e.appendChild(o)}))},e.prototype.insertIntoHTML=function(e){for(var t=this,n=e.split("\n"),o=[],r=0,i=n;r<i.length;r++){var s=i[r];s.includes("</head>")&&this._scriptDataById.forEach((function(e,n){var r=t._scriptTag(e);o.push(r)})),o.push(s)}return o.join("\n")},e.prototype._scriptTag=function(e,t){var n=[];n.push('id="'.concat(e.id,'"')),e.type&&n.push('type="'.concat(e.type,'"'));var o=t?(0,a.default)(e.content)(t):e.content;return"\n<script ".concat(n.join(" "),">\n\t").concat(o,"\n<\/script>")},e.preloadLinkTagFromUrl=function(e,t){var n=(null==t?void 0:t.crossorigin)||!1,o=e.split("?")[0].split("."),a=o[o.length-1].toLowerCase(),l=null==t?void 0:t.as;null==l&&(l="fetch",r.includes(a)&&(l="image"),i.includes(a)&&(l="video"),s.includes(a)&&(l="script"));var c=n?"crossorigin":"";return'<link rel="preload" href="'.concat(e,'" as="').concat(l,'" ').concat(c,"/>")},e}();t.HTMLHeadApi=c},2867:(e,t)=>{t.__esModule=!0,t.HTMLViewerApi=void 0;var n=function(){function e(e){this.htmlApi=e}return e.prototype.setProgressBar=function(e){this._progressBar=e},e.prototype.progressBar=function(){return this._progressBar},e}();t.HTMLViewerApi=n},4358:(e,t,n)=>{t.__esModule=!0,t.myVar=t.EditorApi=void 0;var o=n(5433);t.EditorApi=o.EditorApi;t.myVar="this is great"},9094:(e,t,n)=>{t.__esModule=!0,t.MultiPlayerApi=void 0;var o=n(1453),r=function(e){this.editorApi=e,this.remote=new o.RemoteApi(this.editorApi)};t.MultiPlayerApi=r},1453:(e,t)=>{t.__esModule=!0,t.RemoteApi=void 0;var n=function(e){this.editorApi=e,this.ngrok=new o};t.RemoteApi=n;var o=function(){function e(){this._closeExistingTunnelsOnCreate=!0}return e.prototype.setAuthToken=function(e){this._authToken=e},e.prototype.authToken=function(){return this._authToken},e.prototype.setCloseExistingTunnelsOnCreate=function(e){this._closeExistingTunnelsOnCreate=e},e.prototype.closeExistingTunnelsOnCreate=function(){return this._closeExistingTunnelsOnCreate},e}()},267:(e,t)=>{t.__esModule=!0,t.PanelCustomApi=void 0;var n=function(){function e(e){this.panelApi=e,this._HTMLByPanelName=new Map}return e.prototype.addPanel=function(e,t){this._HTMLByPanelName.set(e,t)},e.prototype.panelNames=function(){var e=[];return this._HTMLByPanelName.forEach((function(t,n){e.push(n)})),e=e.sort()},e.prototype.contentForPanel=function(e){return this._HTMLByPanelName.get(e)},e}();t.PanelCustomApi=n},6752:(e,t,n)=>{t.__esModule=!0,t.PanelApi=void 0;var o=n(267),r=function(e){this.editorApi=e,this.custom=new o.PanelCustomApi(this)};t.PanelApi=r},5022:e=>{e.exports=require("chalk")},591:e=>{e.exports=require("compression-webpack-plugin")},3582:e=>{e.exports=require("cors")},9659:e=>{e.exports=require("esbuild")},6860:e=>{e.exports=require("express")},4302:e=>{e.exports=require("fflate")},8941:e=>{e.exports=require("form-data")},4470:e=>{e.exports=require("fs-extra")},8010:e=>{e.exports=require("http-status-codes")},6517:e=>{e.exports=require("lodash")},3198:e=>{e.exports=require("lodash/template")},1490:e=>{e.exports=require("md5")},732:e=>{e.exports=require("ngrok")},4809:e=>{e.exports=require("node-fetch")},7396:e=>{e.exports=require("node-machine-id")},3920:e=>{e.exports=require("prettier")},3952:e=>{e.exports=require("socket.io")},7166:e=>{e.exports=require("terser-webpack-plugin")},2248:e=>{e.exports=require("three")},3360:e=>{e.exports=require("tmp")},9354:e=>{e.exports=require("webpack")},9760:e=>{e.exports=require("yargs")},2081:e=>{e.exports=require("child_process")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},4147:e=>{e.exports={i8:"1.5.49-1"}},9199:e=>{e.exports=JSON.parse('{"engine_version":"1.1.208","name":"scene_02","code":{"properties":{"frame":0,"maxFrame":100,"maxFrameLocked":false,"realtimeState":true,"mainCameraNodePath":null,"versions":{"polygonjs":"1.1.208"}},"root":{"type":"root","nodes":{"hemisphereLight1":{"type":"hemisphereLight","flags":{"display":true}},"spotLight1":{"type":"spotLight","params":{"t":[2,2,0]},"flags":{"display":true}},"perspectiveCamera1":{"type":"perspectiveCamera","nodes":{"events1":{"type":"eventsNetwork","nodes":{"cameraOrbitControls1":{"type":"cameraOrbitControls","params":{"target":[-0.11355073140543416,-0.038387628177304345,0.45025714280741963]}}},"selection":["cameraOrbitControls1"]}},"params":{"t":[-5.332220457908354,1.9762684656182816,2.109321367202116],"r":[-50.52863034863499,-63.43039962273586,-47.363152975490394],"controls":"./events1/cameraOrbitControls1"},"flags":{"display":true}},"geo1":{"type":"geo","nodes":{"MAT":{"type":"materialsNetwork","nodes":{"meshBasic1":{"type":"meshBasic","params":{"color":[1,0.5,0.2]}},"meshStandard1":{"type":"meshStandard","params":{"useMap":true,"map":"../../../COP/imageUv","useEnvMap":true,"envMap":"../../../COP/envMap","roughness":0.07}}},"selection":["meshStandard1"]},"box1":{"type":"box"},"material1":{"type":"material","params":{"material":"../MAT/meshBasic1"},"inputs":["box1"]},"material2":{"type":"material","params":{"material":"../MAT/meshStandard1"},"inputs":["sphere1"]},"merge1":{"type":"merge","inputs":["material1","transform1"],"flags":{"display":true}},"sphere1":{"type":"sphere"},"transform1":{"type":"transform","params":{"t":[0,0,1.3804442933992227]},"inputs":["material2"]}},"flags":{"display":true},"selection":["material2"]},"COP":{"type":"copNetwork","nodes":{"envMap":{"type":"envMap","inputs":["imageEnv"]},"imageEnv":{"type":"image","params":{"url":"/tex/piz_compressed.exr?t=`js(\'Date.now()\')`"}},"imageUv":{"type":"image","params":{"url":"/tex/uv.jpg?t=`js(\'Date.now()\')`","tflipY":true}}},"selection":["imageEnv"]}},"params":{"backgroundMode":1,"bgColor":[0.6941176470588235,0.4470588235294118,0.4470588235294118]}},"ui":{"nodes":{"hemisphereLight1":{"pos":[150,100]},"spotLight1":{"pos":[150,200]},"perspectiveCamera1":{"pos":[-200,100],"nodes":{"events1":{"pos":[-200,50],"nodes":{"cameraOrbitControls1":{"pos":[150,50]}}}}},"geo1":{"pos":[50,-50],"nodes":{"MAT":{"pos":[-450,-50],"nodes":{"meshBasic1":{"pos":[-300,150]},"meshStandard1":{"pos":[-300,300]}}},"box1":{"pos":[-300,-150]},"material1":{"pos":[-200,0]},"material2":{"pos":[0,-50]},"merge1":{"pos":[-150,200]},"sphere1":{"pos":[-50,-200]},"transform1":{"pos":[0,50]}}},"COP":{"pos":[0,150],"nodes":{"envMap":{"pos":[50,200]},"imageEnv":{"pos":[50,100]},"imageUv":{"pos":[-100,100]}}}}}},"layout_data":{"multiple_panel":{"split_ratio":0.5,"split_panel0":{"split_ratio":0.5,"split_panel0":{"panelTypes":["viewer"],"currentPanelIndex":0,"panel_data":{"camera":"/perspectiveCamera1","linkIndex":1}},"split_panel1":{"panelTypes":["params"],"currentPanelIndex":0,"panel_data":{"active_folder":448,"linkIndex":1}},"split_mode":"vertical"},"split_panel1":{"panelTypes":["network","params","viewer"],"currentPanelIndex":0,"panel_data":{"camera":{"position":{"x":-203,"y":-5},"zoom":0.5},"history":{"2":{"position":{"x":-203,"y":-5},"zoom":0.5},"101":{"position":{"x":-79,"y":-3},"zoom":0.5}},"linkIndex":1}},"split_mode":"horizontal"},"currentNodes":["/","/","/","/","/","/","/","/"],"navigationHistory":{"nodePaths":{"1":["/"],"2":[],"3":[],"4":[],"5":[],"6":[],"7":[],"8":[]},"index":{"1":0,"2":-1,"3":-1,"4":-1,"5":-1,"6":-1,"7":-1,"8":-1}},"fullscreenPanelId":null},"nodes":["cop/envMap","cop/image","event/cameraOrbitControls","mat/meshBasic","mat/meshStandard","obj/copNetwork","obj/geo","obj/hemisphereLight","obj/perspectiveCamera","obj/spotLight","sop/box","sop/eventsNetwork","sop/material","sop/materialsNetwork","sop/merge","sop/sphere","sop/transform"],"operations":[],"assets":["/tex/uv.jpg","/tex/piz_compressed.exr"],"modules":["EXRLoader"],"assemblers":[],"integrations":[],"nodes_map":{"/hemisphereLight1":"obj/hemisphereLight","/spotLight1":"obj/spotLight","/perspectiveCamera1":"obj/perspectiveCamera","/perspectiveCamera1/events1":"sop/eventsNetwork","/perspectiveCamera1/events1/cameraOrbitControls1":"event/cameraOrbitControls","/geo1":"obj/geo","/geo1/MAT":"sop/materialsNetwork","/geo1/MAT/meshBasic1":"mat/meshBasic","/geo1/MAT/meshStandard1":"mat/meshStandard","/geo1/box1":"sop/box","/geo1/material1":"sop/material","/geo1/material2":"sop/material","/geo1/merge1":"sop/merge","/geo1/sphere1":"sop/sphere","/geo1/transform1":"sop/transform","/COP":"obj/copNetwork","/COP/envMap":"cop/envMap","/COP/imageEnv":"cop/image","/COP/imageUv":"cop/image"},"plugins_data":{"plugins":{},"nodes":{},"operations":{}},"poly_nodes":[]}')}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.c=t,n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);n(n.s=3607)})();